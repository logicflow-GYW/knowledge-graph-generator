/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var __defProp = Object.defineProperty;
var __getOwnPropDesc = Object.getOwnPropertyDescriptor;
var __getOwnPropNames = Object.getOwnPropertyNames;
var __hasOwnProp = Object.prototype.hasOwnProperty;
var __export = (target, all) => {
  for (var name in all)
    __defProp(target, name, { get: all[name], enumerable: true });
};
var __copyProps = (to, from, except, desc) => {
  if (from && typeof from === "object" || typeof from === "function") {
    for (let key of __getOwnPropNames(from))
      if (!__hasOwnProp.call(to, key) && key !== except)
        __defProp(to, key, { get: () => from[key], enumerable: !(desc = __getOwnPropDesc(from, key)) || desc.enumerable });
  }
  return to;
};
var __toCommonJS = (mod) => __copyProps(__defProp({}, "__esModule", { value: true }), mod);

// src/main.ts
var main_exports = {};
__export(main_exports, {
  default: () => KnowledgeGraphPlugin
});
module.exports = __toCommonJS(main_exports);
var import_obsidian5 = require("obsidian");

// src/settings.ts
var import_obsidian2 = require("obsidian");

// src/QueueModal.ts
var import_obsidian = require("obsidian");
var QueueManagementModal = class extends import_obsidian.Modal {
  constructor(app, plugin) {
    super(app);
    // 用于保存搜索词
    this.searchTerms = {
      gen: "",
      rev: "",
      rep: "",
      dis: ""
    };
    // 默认全部折叠
    this.collapseStates = {
      gen: false,
      rev: false,
      rep: false,
      dis: false
    };
    this.plugin = plugin;
    this.refreshContent = this.onOpen.bind(this);
  }
  onOpen() {
    const { contentEl } = this;
    this.app.workspace.off("kg-data-updated", this.refreshContent);
    contentEl.empty();
    contentEl.addClass("kg-modal");
    contentEl.createEl("h2", { text: "Queue management dashboard" });
    const status = this.plugin.data.status;
    const statusText = `Status: ${status.toUpperCase()} | ${this.plugin.statusBarEl.getText()}`;
    new import_obsidian.Setting(contentEl).setName(status === "running" ? "Engine running" : "Engine paused").setDesc(statusText).addButton(
      (button) => button.setButtonText(status === "running" ? "Pause engine" : "Start engine").setCta(status !== "running").onClick(() => {
        this.plugin.engine.toggleEngineState();
        this.onOpen();
      })
    );
    this.renderQueueSection(
      contentEl,
      "gen",
      "Pending generation",
      // UI Text: Sentence case
      this.plugin.data.generationQueue,
      this.renderGenerationItem.bind(this)
    );
    this.renderQueueSection(
      contentEl,
      "rev",
      "Pending review",
      // UI Text: Sentence case
      this.plugin.data.reviewQueue,
      this.renderReviewItem.bind(this)
    );
    this.renderQueueSection(
      contentEl,
      "rep",
      "Pending revision",
      // UI Text: Sentence case
      this.plugin.data.revisionQueue,
      this.renderRevisionItem.bind(this)
    );
    this.renderQueueSection(
      contentEl,
      "dis",
      "Discarded pile",
      // UI Text: Sentence case
      this.plugin.data.discardedPile,
      this.renderDiscardedItem.bind(this)
    );
    this.app.workspace.on("kg-data-updated", this.refreshContent);
  }
  onClose() {
    const { contentEl } = this;
    contentEl.empty();
    this.app.workspace.off("kg-data-updated", this.refreshContent);
  }
  /**
   * 渲染一个队列区域 (带搜索和展开/折叠)
   */
  renderQueueSection(containerEl, key, title, data, renderFn) {
    const displayLimit = 100;
    const filter = this.searchTerms[key];
    const filteredData = data.filter((item) => {
      if (!filter)
        return true;
      const needle = filter.toLowerCase();
      if (typeof item === "string") {
        return item.toLowerCase().includes(needle);
      }
      return item.idea.toLowerCase().includes(needle);
    });
    const total = data.length;
    const filteredTotal = filteredData.length;
    const titleText = `${title} (${filteredTotal}${total !== filteredTotal ? " / " + total : ""} items)`;
    const details = containerEl.createEl("details");
    details.open = this.collapseStates[key];
    const summary = details.createEl("summary", { text: titleText });
    summary.addClass("kg-modal-summary");
    details.addEventListener("toggle", () => {
      this.collapseStates[key] = details.open;
    });
    new import_obsidian.Setting(details).setDesc(`Search ${title}...`).addText((text) => {
      text.setPlaceholder("Enter keywords...").setValue(this.searchTerms[key]).onChange((value) => {
        this.searchTerms[key] = value;
        this.onOpen();
      });
    });
    const truncatedData = filteredData.slice(0, displayLimit);
    if (truncatedData.length === 0) {
      const desc = details.createEl("p", { text: "Queue is empty or no matches found.", cls: "setting-item-description" });
      desc.addClass("kg-queue-desc-empty");
      return;
    }
    const listContainer = details.createDiv("kg-list-container");
    truncatedData.forEach((item, index) => {
      renderFn(listContainer, item, index);
    });
    if (filteredData.length > displayLimit) {
      const truncatedInfo = details.createEl("p", {
        text: `... showing first ${displayLimit} items (total ${filteredData.length}), use search to find more.`,
        cls: "setting-item-description"
      });
      truncatedInfo.addClass("kg-queue-desc-truncated");
    }
  }
  // --- 单项渲染函数 ---
  renderGenerationItem(container, item) {
    const itemName = typeof item === "string" ? item : item.idea;
    new import_obsidian.Setting(container).setName(itemName).addButton(
      (btn) => btn.setIcon("trash").setTooltip("Delete concept").onClick(async () => {
        const queue = this.plugin.data.generationQueue;
        const index = queue.indexOf(itemName);
        if (index > -1) {
          queue.splice(index, 1);
          await this.plugin.savePluginData();
          this.plugin.engine.updateStatusBar();
          this.onOpen();
        }
      })
      // Promise handling is implicit in async onClick, generally accepted in Obsidian
    );
  }
  renderReviewItem(container, item) {
    const task = item;
    new import_obsidian.Setting(container).setName(`[Review] ${task.idea}`).addButton(
      (btn) => btn.setIcon("trash").setTooltip("Discard task").onClick(async () => {
        this.plugin.data.reviewQueue.splice(this.plugin.data.reviewQueue.indexOf(task), 1);
        this.plugin.data.discardedPile.push(task);
        await this.plugin.savePluginData();
        this.plugin.engine.updateStatusBar();
        this.onOpen();
      })
    );
  }
  renderRevisionItem(container, item) {
    const task = item;
    new import_obsidian.Setting(container).setName(`[Revision] ${task.idea}`).setDesc(`Reason: ${task.reason || "Unknown"}`).addButton(
      (btn) => btn.setIcon("trash").setTooltip("Discard task").onClick(async () => {
        this.plugin.data.revisionQueue.splice(this.plugin.data.revisionQueue.indexOf(task), 1);
        this.plugin.data.discardedPile.push(task);
        await this.plugin.savePluginData();
        this.plugin.engine.updateStatusBar();
        this.onOpen();
      })
    );
  }
  renderDiscardedItem(container, item) {
    const task = item;
    new import_obsidian.Setting(container).setName(`[Discarded] ${task.idea}`).setDesc(`Last reason: ${task.reason || "Unknown"}`).addButton(
      (btn) => btn.setIcon("refresh-cw").setTooltip("Re-queue (Generation)").onClick(async () => {
        this.plugin.data.discardedPile.splice(this.plugin.data.discardedPile.indexOf(task), 1);
        this.plugin.engine.addConceptsToQueue([task.idea]);
        this.onOpen();
      })
    );
  }
};

// src/settings.ts
var PROMPT_GENERATOR_DEFAULT = `# Role: \u77E5\u8BC6\u7CFB\u7EDF\u6784\u5EFA\u4E13\u5BB6...`;
var PROMPT_CRITIC_DEFAULT = `# Role: \u77E5\u8BC6\u56FE\u8C31\u8D28\u91CF\u5BA1\u6838\u5458...`;
var PROMPT_REVISER_DEFAULT = `# Role: \u8D44\u6DF1\u77E5\u8BC6\u7F16\u8F91\u4E0E\u5185\u5BB9\u4F18\u5316\u4E13\u5BB6...`;
var DEFAULT_SETTINGS = {
  // API
  openai_api_keys: "",
  openai_base_url: "https://api.openai.com/v1",
  openai_model: "gpt-4-turbo-preview",
  openai_backup_model: "",
  google_api_keys: "",
  google_model: "gemini-1.5-pro-latest",
  google_backup_model: "",
  failover_cooldown_seconds: 300,
  // 参数
  generation_temperature: 0.7,
  generation_max_tokens: 4096,
  // 路径
  output_dir: "KnowledgeGraphNotes",
  // 系统
  generation_batch_size: 5,
  request_delay: 5,
  // Critic
  critic_mode: "heuristic",
  critic_required_headers: "# \u{1F9E0}\n> \n## \u{1F4A1} \u6838\u5FC3\u601D\u60F3\n## \u{1F3AF} \u9002\u7528\u573A\u666F\n## \u{1F6E0}\uFE0F \u4F7F\u7528\u6B65\u9AA4/\u6784\u6210\u8981\u7D20\n## \u{1F680} \u6848\u4F8B\u5206\u6790\n## \u{1F44D} \u4F18\u70B9 & \u{1F44E} \u7F3A\u70B9\n## \u{1F517} \u5173\u8054\u6A21\u578B",
  critic_min_content_length: 400,
  // Reviser
  max_revision_retries: 2,
  // Prompts
  prompt_generator: PROMPT_GENERATOR_DEFAULT,
  prompt_critic: PROMPT_CRITIC_DEFAULT,
  prompt_reviser: PROMPT_REVISER_DEFAULT,
  // 播种箱
  seedConcepts: "",
  // 新概念提取
  extract_new_concepts: false
};
function getDefaultPrompts() {
  return {
    prompt_generator: PROMPT_GENERATOR_DEFAULT,
    prompt_critic: PROMPT_CRITIC_DEFAULT,
    prompt_reviser: PROMPT_REVISER_DEFAULT
  };
}
var KGsSettingTab = class extends import_obsidian2.PluginSettingTab {
  constructor(app, plugin) {
    super(app, plugin);
    this.plugin = plugin;
  }
  display() {
    const { containerEl } = this;
    containerEl.empty();
    new import_obsidian2.Setting(containerEl).setName("Knowledge Graph Generator settings").setHeading();
    new import_obsidian2.Setting(containerEl).setName("Engine dashboard").setDesc("Manage generation, review, and discarded tasks.").addButton(
      (button) => button.setButtonText("Open queue manager").setCta().onClick(() => {
        new QueueManagementModal(this.app, this.plugin).open();
      })
    );
    new import_obsidian2.Setting(containerEl).setName("API settings").setHeading();
    new import_obsidian2.Setting(containerEl).setName("OpenAI").setHeading();
    new import_obsidian2.Setting(containerEl).setName("OpenAI API keys").setDesc("One key per line.").addTextArea((text) => text.setPlaceholder("sk-...").setValue(this.plugin.settings.openai_api_keys).onChange(async (value) => {
      this.plugin.settings.openai_api_keys = value;
      await this.plugin.saveSettings();
    }));
    new import_obsidian2.Setting(containerEl).setName("OpenAI base URL").setDesc("Proxy URL if applicable.").addText((text) => text.setPlaceholder("https://api.openai.com/v1").setValue(this.plugin.settings.openai_base_url).onChange(async (value) => {
      this.plugin.settings.openai_base_url = value.trim();
      await this.plugin.saveSettings();
    }));
    new import_obsidian2.Setting(containerEl).setName("OpenAI model (primary)").setDesc("Primary model name.").addText((text) => text.setPlaceholder("gpt-4-turbo-preview").setValue(this.plugin.settings.openai_model).onChange(async (value) => {
      this.plugin.settings.openai_model = value.trim();
      await this.plugin.saveSettings();
    }));
    new import_obsidian2.Setting(containerEl).setName("OpenAI backup model").setDesc("Used when primary fails.").addText((text) => text.setPlaceholder("gpt-3.5-turbo").setValue(this.plugin.settings.openai_backup_model).onChange(async (value) => {
      this.plugin.settings.openai_backup_model = value.trim();
      await this.plugin.saveSettings();
    }));
    new import_obsidian2.Setting(containerEl).setName("Google Gemini").setHeading();
    new import_obsidian2.Setting(containerEl).setName("Google Gemini API keys").setDesc("One key per line.").addTextArea((text) => text.setPlaceholder("AIzaSy...").setValue(this.plugin.settings.google_api_keys).onChange(async (value) => {
      this.plugin.settings.google_api_keys = value;
      await this.plugin.saveSettings();
    }));
    new import_obsidian2.Setting(containerEl).setName("Google Gemini model (primary)").setDesc("Primary model name.").addText((text) => text.setPlaceholder("gemini-1.5-pro-latest").setValue(this.plugin.settings.google_model).onChange(async (value) => {
      this.plugin.settings.google_model = value.trim();
      await this.plugin.saveSettings();
    }));
    new import_obsidian2.Setting(containerEl).setName("Google Gemini backup model").setDesc("Used when primary fails.").addText((text) => text.setPlaceholder("gemini-1.0-pro").setValue(this.plugin.settings.google_backup_model).onChange(async (value) => {
      this.plugin.settings.google_backup_model = value.trim();
      await this.plugin.saveSettings();
    }));
    new import_obsidian2.Setting(containerEl).setName("Key cooldown (seconds)").setDesc("Wait time after key failure.").addText((text) => text.setValue(String(this.plugin.settings.failover_cooldown_seconds)).onChange(async (value) => {
      const num = parseInt(value, 10);
      if (!isNaN(num) && num >= 0) {
        this.plugin.settings.failover_cooldown_seconds = num;
        await this.plugin.saveSettings();
      }
    }));
    new import_obsidian2.Setting(containerEl).setName("LLM parameters").setHeading();
    new import_obsidian2.Setting(containerEl).setName("Generation temperature").setDesc("0.0 to 2.0 (Creative vs Deterministic).").addText((text) => text.setValue(String(this.plugin.settings.generation_temperature)).onChange(async (value) => {
      const num = parseFloat(value);
      if (!isNaN(num) && num >= 0 && num <= 2) {
        this.plugin.settings.generation_temperature = num;
        await this.plugin.saveSettings();
      }
    }));
    new import_obsidian2.Setting(containerEl).setName("Max tokens").setDesc("Maximum tokens per response.").addText((text) => text.setValue(String(this.plugin.settings.generation_max_tokens)).onChange(async (value) => {
      const num = parseInt(value, 10);
      if (!isNaN(num) && num > 0) {
        this.plugin.settings.generation_max_tokens = num;
        await this.plugin.saveSettings();
      }
    }));
    new import_obsidian2.Setting(containerEl).setName("Engine settings").setHeading();
    new import_obsidian2.Setting(containerEl).setName("Output folder").setDesc("Notes will be saved here.").addText((text) => text.setPlaceholder("KnowledgeGraphNotes").setValue(this.plugin.settings.output_dir).onChange(async (value) => {
      this.plugin.settings.output_dir = value.trim().replace(/\/$/, "");
      await this.plugin.saveSettings();
    }));
    new import_obsidian2.Setting(containerEl).setName("Generation batch size").setDesc("Number of tasks per cycle.").addText((text) => text.setValue(String(this.plugin.settings.generation_batch_size)).onChange(async (value) => {
      const num = parseInt(value, 10);
      if (!isNaN(num) && num > 0) {
        this.plugin.settings.generation_batch_size = num;
        await this.plugin.saveSettings();
      }
    }));
    new import_obsidian2.Setting(containerEl).setName("Request delay (seconds)").setDesc("Wait time between batches.").addText((text) => text.setValue(String(this.plugin.settings.request_delay)).onChange(async (value) => {
      const num = parseInt(value, 10);
      if (!isNaN(num) && num >= 0) {
        this.plugin.settings.request_delay = num;
        await this.plugin.saveSettings();
      }
    }));
    new import_obsidian2.Setting(containerEl).setName("Max revision retries").setDesc("Maximum attempts before discarding.").addText((text) => text.setValue(String(this.plugin.settings.max_revision_retries)).onChange(async (value) => {
      const num = parseInt(value, 10);
      if (!isNaN(num) && num >= 0) {
        this.plugin.settings.max_revision_retries = num;
        await this.plugin.saveSettings();
      }
    }));
    new import_obsidian2.Setting(containerEl).setName("Extract new concepts").setDesc("Automatically add [[Wikilinks]] from approved notes to generation queue.").addToggle(
      (toggle) => toggle.setValue(this.plugin.settings.extract_new_concepts).onChange(async (value) => {
        this.plugin.settings.extract_new_concepts = value;
        await this.plugin.saveSettings();
      })
    );
    new import_obsidian2.Setting(containerEl).setName("Critic mode").setDesc("Heuristic (fast, formatting check) or AI (smart, content check).").addDropdown((dropdown) => dropdown.addOption("heuristic", "Heuristic").addOption("ai", "Artificial Intelligence (AI)").setValue(this.plugin.settings.critic_mode).onChange(async (value) => {
      this.plugin.settings.critic_mode = value;
      await this.plugin.saveSettings();
      this.display();
    }));
    if (this.plugin.settings.critic_mode === "heuristic") {
      new import_obsidian2.Setting(containerEl).setName("Heuristic: required headers").setDesc("Notes must contain these headers (one per line).").addTextArea((text) => {
        text.setValue(this.plugin.settings.critic_required_headers).onChange(async (value) => {
          this.plugin.settings.critic_required_headers = value;
          await this.plugin.saveSettings();
        });
        text.inputEl.addClass("kg-textarea-short");
      });
      new import_obsidian2.Setting(containerEl).setName("Heuristic: min content length").setDesc("Minimum character count.").addText((text) => text.setValue(String(this.plugin.settings.critic_min_content_length)).onChange(async (value) => {
        const num = parseInt(value, 10);
        if (!isNaN(num) && num >= 0) {
          this.plugin.settings.critic_min_content_length = num;
          await this.plugin.saveSettings();
        }
      }));
    }
    new import_obsidian2.Setting(containerEl).setName("Concept seeding").setHeading();
    new import_obsidian2.Setting(containerEl).setName("Seed box").setDesc("Enter concepts here, one per line.").addTextArea((text) => {
      text.setPlaceholder("First Principles\nOccam's Razor\n...").setValue(this.plugin.settings.seedConcepts).onChange(async (value) => {
        this.plugin.settings.seedConcepts = value;
        await this.plugin.saveSettings();
      });
      text.inputEl.addClass("kg-textarea-medium");
    });
    new import_obsidian2.Setting(containerEl).addButton(
      (button) => button.setButtonText("Seed to queue").setCta().onClick(async () => {
        const rawText = this.plugin.settings.seedConcepts;
        if (!rawText.trim()) {
          new import_obsidian2.Notice("Seed box is empty.");
          return;
        }
        const conceptsToSeed = [...new Set(
          rawText.split("\n").map((line) => line.trim()).filter(Boolean)
        )];
        const addedCount = this.plugin.engine.addConceptsToQueue(conceptsToSeed);
        const ignoredCount = conceptsToSeed.length - addedCount;
        let noticeMessage = `Added ${addedCount} concepts.`;
        if (ignoredCount > 0) {
          noticeMessage += `
${ignoredCount} ignored (duplicate/existing).`;
        }
        new import_obsidian2.Notice(noticeMessage, 5e3);
        this.plugin.settings.seedConcepts = "";
        await this.plugin.saveSettings();
        this.display();
      })
    );
    new import_obsidian2.Setting(containerEl).setName("Prompts settings").setHeading();
    new import_obsidian2.Setting(containerEl).setName("Generator prompt").setDesc("Prompt for generating new content.").addTextArea((text) => {
      text.setValue(this.plugin.settings.prompt_generator).onChange(async (value) => {
        this.plugin.settings.prompt_generator = value;
        await this.plugin.saveSettings();
      });
      text.inputEl.addClass("kg-textarea-tall");
    });
    if (this.plugin.settings.critic_mode === "ai") {
      new import_obsidian2.Setting(containerEl).setName("Critic prompt").setDesc("Prompt for AI content review.").addTextArea((text) => {
        text.setValue(this.plugin.settings.prompt_critic).onChange(async (value) => {
          this.plugin.settings.prompt_critic = value;
          await this.plugin.saveSettings();
        });
        text.inputEl.addClass("kg-textarea-tall");
      });
    }
    new import_obsidian2.Setting(containerEl).setName("Reviser prompt").setDesc("Prompt for revising rejected content.").addTextArea((text) => {
      text.setValue(this.plugin.settings.prompt_reviser).onChange(async (value) => {
        this.plugin.settings.prompt_reviser = value;
        await this.plugin.saveSettings();
      });
      text.inputEl.addClass("kg-textarea-tall");
    });
  }
};

// src/engine.ts
var import_obsidian4 = require("obsidian");

// src/apiHandler.ts
var import_obsidian3 = require("obsidian");
var ApiKeyExhaustedError = class extends Error {
  constructor(message) {
    super(message);
    this.name = "ApiKeyExhaustedError";
  }
};
var AllModelsFailedError = class extends Error {
  constructor(message) {
    super(message);
    this.name = "AllModelsFailedError";
  }
};
var APIHandler = class {
  constructor(plugin) {
    this.openai_keys = [];
    this.google_keys = [];
    this.keyUsageOpenAI = /* @__PURE__ */ new Map();
    this.keyUsageGoogle = /* @__PURE__ */ new Map();
    this.hasNotifiedFailover = false;
    this.plugin = plugin;
    this.settings = plugin.settings;
    this.updateKeys();
  }
  updateKeys() {
    this.openai_keys = this.settings.openai_api_keys.split("\n").map((k) => k.trim()).filter(Boolean);
    this.google_keys = this.settings.google_api_keys.split("\n").map((k) => k.trim()).filter(Boolean);
    this.openai_keys.forEach((key) => {
      if (!this.keyUsageOpenAI.has(key)) {
        this.keyUsageOpenAI.set(key, { fails: 0, cooldown_until: 0 });
      }
    });
    this.google_keys.forEach((key) => {
      if (!this.keyUsageGoogle.has(key)) {
        this.keyUsageGoogle.set(key, { fails: 0, cooldown_until: 0 });
      }
    });
  }
  _selectKey(keys, provider) {
    const keyUsageMap = provider === "openai" ? this.keyUsageOpenAI : this.keyUsageGoogle;
    const currentTime = Date.now() / 1e3;
    for (const key of keys) {
      const usage = keyUsageMap.get(key);
      if (usage && currentTime >= usage.cooldown_until) {
        return key;
      }
    }
    return null;
  }
  async _makeOpenAIRequest(key, prompt, modelName) {
    const response = await (0, import_obsidian3.requestUrl)({
      url: `${this.settings.openai_base_url}/chat/completions`,
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "Authorization": `Bearer ${key}`
      },
      body: JSON.stringify({
        model: modelName,
        messages: [{ role: "user", content: prompt }],
        temperature: this.settings.generation_temperature,
        max_tokens: this.settings.generation_max_tokens
      })
    });
    return response.json.choices[0].message.content.trim();
  }
  async _makeGoogleAPIRequest(key, prompt, modelName) {
    const url = `https://generativelanguage.googleapis.com/v1beta/models/${modelName}:generateContent?key=${key}`;
    const response = await (0, import_obsidian3.requestUrl)({
      url,
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        contents: [{ parts: [{ text: prompt }] }],
        generationConfig: {
          temperature: this.settings.generation_temperature,
          maxOutputTokens: this.settings.generation_max_tokens
        }
      })
    });
    const data = response.json;
    if (!data.candidates || data.candidates.length === 0) {
      throw new Error("API response is missing candidates. Full response: " + JSON.stringify(data));
    }
    return data.candidates[0].content.parts[0].text.trim();
  }
  // 修改：将参数类型改为 unknown，并在内部断言，避免 "Unexpected any"
  _isQuotaError(error) {
    var _a;
    const err = error;
    const httpStatus = err.status;
    const errorMessage = ((_a = err.message) == null ? void 0 : _a.toLowerCase()) || "";
    if (httpStatus === 401 || httpStatus === 403 || httpStatus === 429) {
      return true;
    }
    if (errorMessage.includes("insufficient_quota") || errorMessage.includes("rate limit") || errorMessage.includes("quota") || errorMessage.includes("permission") || errorMessage.includes("429")) {
      return true;
    }
    return false;
  }
  _cooldownKey(key, provider) {
    const keyUsageMap = provider === "openai" ? this.keyUsageOpenAI : this.keyUsageGoogle;
    const keyUsage = keyUsageMap.get(key);
    if (keyUsage) {
      console.warn(`Key ...${key.slice(-4)} (${provider}) failed due to quota/auth error. Applying cooldown.`);
      keyUsage.cooldown_until = Date.now() / 1e3 + this.settings.failover_cooldown_seconds;
    }
  }
  _resetCooldown(key, provider) {
    const keyUsageMap = provider === "openai" ? this.keyUsageOpenAI : this.keyUsageGoogle;
    const keyUsage = keyUsageMap.get(key);
    if (keyUsage) {
      keyUsage.cooldown_until = 0;
    }
    this.hasNotifiedFailover = false;
  }
  async _callOpenAI(key, prompt) {
    const primaryModel = this.settings.openai_model;
    const backupModel = this.settings.openai_backup_model;
    try {
      const result = await this._makeOpenAIRequest(key, prompt, primaryModel);
      this._resetCooldown(key, "openai");
      return result;
    } catch (e) {
      const primaryError = e;
      const primaryMsg = e instanceof Error ? e.message : String(e);
      console.warn(`OpenAI primary model '${primaryModel}' failed for key ...${key.slice(-4)}:`, primaryMsg);
      if (backupModel) {
        try {
          const backupResult = await this._makeOpenAIRequest(key, prompt, backupModel);
          this._resetCooldown(key, "openai");
          return backupResult;
        } catch (e2) {
          const backupMsg = e2 instanceof Error ? e2.message : String(e2);
          console.error(`OpenAI backup model '${backupModel}' also failed for key ...${key.slice(-4)}:`, backupMsg);
          if (this._isQuotaError(primaryError) || this._isQuotaError(e2)) {
            this._cooldownKey(key, "openai");
          }
          throw new ApiKeyExhaustedError(`OpenAI key failed (both primary and backup models).`);
        }
      }
      if (this._isQuotaError(primaryError)) {
        this._cooldownKey(key, "openai");
      }
      throw new ApiKeyExhaustedError(`OpenAI key failed (primary model failed, no backup): ${primaryMsg}`);
    }
  }
  async _callGoogleAPI(key, prompt) {
    const primaryModel = this.settings.google_model;
    const backupModel = this.settings.google_backup_model;
    try {
      const result = await this._makeGoogleAPIRequest(key, prompt, primaryModel);
      this._resetCooldown(key, "google");
      return result;
    } catch (e) {
      const primaryError = e;
      const primaryMsg = e instanceof Error ? e.message : String(e);
      console.warn(`Google primary model '${primaryModel}' failed for key ...${key.slice(-4)}:`, primaryMsg);
      if (backupModel) {
        try {
          const backupResult = await this._makeGoogleAPIRequest(key, prompt, backupModel);
          this._resetCooldown(key, "google");
          return backupResult;
        } catch (e2) {
          const backupMsg = e2 instanceof Error ? e2.message : String(e2);
          console.error(`Google backup model '${backupModel}' also failed for key ...${key.slice(-4)}:`, backupMsg);
          if (this._isQuotaError(primaryError) || this._isQuotaError(e2)) {
            this._cooldownKey(key, "google");
          }
          throw new ApiKeyExhaustedError(`Google key failed (both primary and backup models).`);
        }
      }
      if (this._isQuotaError(primaryError)) {
        this._cooldownKey(key, "google");
      }
      throw new ApiKeyExhaustedError(`Google key failed (primary model failed, no backup): ${primaryMsg}`);
    }
  }
  async call(prompt) {
    this.updateKeys();
    let lastError = null;
    let openAIKeysAttempted = false;
    const openAIEnabled = this.openai_keys.length > 0 && !!(this.settings.openai_model || this.settings.openai_backup_model);
    const googleEnabled = this.google_keys.length > 0 && !!(this.settings.google_model || this.settings.google_backup_model);
    if (openAIEnabled) {
      openAIKeysAttempted = true;
      for (let i = 0; i < this.openai_keys.length; i++) {
        const key = this._selectKey(this.openai_keys, "openai");
        if (key) {
          try {
            console.debug(`Trying OpenAI key ...${key.slice(-4)}`);
            return await this._callOpenAI(key, prompt);
          } catch (e) {
            const err = e;
            lastError = err;
            new import_obsidian3.Notice(`OpenAI key ...${key.slice(-4)} failed. Trying next.`);
          }
        }
      }
    } else if (this.openai_keys.length > 0) {
      openAIKeysAttempted = true;
      lastError = new Error("OpenAI: Keys provided but no models defined.");
      console.warn(lastError.message);
    }
    if (googleEnabled) {
      if (openAIKeysAttempted && !this.hasNotifiedFailover) {
        new import_obsidian3.Notice("All OpenAI keys failed or unavailable. Switching to Google Gemini...");
        this.hasNotifiedFailover = true;
      }
      for (let i = 0; i < this.google_keys.length; i++) {
        const key = this._selectKey(this.google_keys, "google");
        if (key) {
          try {
            console.debug(`Trying Google Gemini key ...${key.slice(-4)}`);
            return await this._callGoogleAPI(key, prompt);
          } catch (e) {
            const err = e;
            lastError = err;
            new import_obsidian3.Notice(`Google Gemini key ...${key.slice(-4)} failed. Trying next.`);
          }
        }
      }
    } else if (this.google_keys.length > 0) {
      lastError = lastError || new Error("Google: Keys provided but no models defined.");
      console.warn(lastError.message);
    }
    if (!openAIEnabled && !googleEnabled && (this.openai_keys.length > 0 || this.google_keys.length > 0)) {
      new import_obsidian3.Notice("Please provide API keys and at least one model name in settings.");
      throw new AllModelsFailedError("Keys provided but no models defined.");
    }
    throw new AllModelsFailedError(`All API providers failed. Last error: ${lastError == null ? void 0 : lastError.message}`);
  }
};

// src/critic.ts
var Critic = class {
  constructor(plugin) {
    this.plugin = plugin;
    this.apiHandler = new APIHandler(plugin);
  }
  async judge(content) {
    if (this.plugin.settings.critic_mode === "ai") {
      return this._judgeByAI(content);
    }
    return this._judgeByHeuristic(content);
  }
  _judgeByHeuristic(content) {
    const reasons = [];
    const contentLower = content.toLowerCase();
    const requiredHeaders = this.plugin.settings.critic_required_headers.split("\n").map((h) => h.trim().toLowerCase()).filter(Boolean);
    const missingHeaders = requiredHeaders.filter((h) => !contentLower.includes(h));
    if (missingHeaders.length > 0) {
      reasons.push(`\u7F3A\u5C11\u5FC5\u9700\u7684\u6807\u9898: ${missingHeaders.join(", ")}`);
    }
    if (content.length < this.plugin.settings.critic_min_content_length) {
      reasons.push(`\u5185\u5BB9\u8FC7\u77ED (\u5F53\u524D: ${content.length}, \u8981\u6C42: ${this.plugin.settings.critic_min_content_length})`);
    }
    const refusalPatterns = ["\u4F5C\u4E3A\u4E00?\u4E2AAI", "\u4F5C\u4E3A\u8BED\u8A00\u6A21\u578B", "\u6211\u4E0D\u80FD", "\u6211\u65E0\u6CD5", "\u5F88\u62B1\u6B49"];
    for (const pattern of refusalPatterns) {
      if (new RegExp(pattern, "i").test(content)) {
        reasons.push(`\u5305\u542BAI\u62D2\u7EDD\u8BED (\u5339\u914D: '${pattern}')`);
        break;
      }
    }
    return {
      isApproved: reasons.length === 0,
      reason: reasons.length > 0 ? reasons.join("; ") : "\u901A\u8FC7\u6240\u6709\u542F\u53D1\u5F0F\u89C4\u5219\u68C0\u67E5\u3002"
    };
  }
  async _judgeByAI(content) {
    const prompt = this.plugin.settings.prompt_critic.replace("{content}", content);
    try {
      const response = await this.apiHandler.call(prompt);
      const decisionMatch = response.match(/DECISION:\s*(KEEP|DISCARD)/i);
      const reasonMatch = response.match(/\[REASON:\s*([^\]]+)\]/i);
      const isApproved = decisionMatch ? decisionMatch[1].toUpperCase() === "KEEP" : false;
      const reason = reasonMatch ? reasonMatch[1].trim() : isApproved ? "AI \u6279\u51C6" : "AI \u62D2\u7EDD\uFF0C\u672A\u63D0\u4F9B\u660E\u786E\u7406\u7531";
      return { isApproved, reason };
    } catch (error) {
      console.error("AI Critic call failed:", error);
      return { isApproved: false, reason: `AI \u5BA1\u6838\u5668\u8C03\u7528\u5931\u8D25: ${error.message}` };
    }
  }
};

// src/reviser.ts
var Reviser = class {
  constructor(plugin) {
    this.plugin = plugin;
  }
  createRevisionPrompt(idea, originalContent, rejectionReason) {
    let prompt = this.plugin.settings.prompt_reviser;
    prompt = prompt.replace("{concept}", idea);
    prompt = prompt.replace("{original_content}", originalContent);
    prompt = prompt.replace("{rejection_reason}", rejectionReason);
    return prompt;
  }
};

// src/utils.ts
function sanitizeFilename(name) {
  let cleanName = name.replace(/\s*\(.*\)/g, "").trim();
  cleanName = cleanName.replace(/[\\/*?:"<>|]/g, "");
  return cleanName.slice(0, 100);
}
function extractNewIdeas(content) {
  const matches = content.match(/\[\[([^\]]+)\]\]/g);
  if (!matches) {
    return [];
  }
  const ideas = matches.map((match) => {
    return match.slice(2, -2).split("|")[0].trim();
  });
  return [...new Set(ideas)];
}
function cleanMarkdownOutput(content) {
  const trimmed = content.trim();
  if (trimmed.startsWith("```markdown") && trimmed.endsWith("```")) {
    let cleaned = trimmed.substring("```markdown".length, trimmed.length - "```".length);
    return cleaned.trim();
  }
  return trimmed;
}

// src/engine.ts
var Engine = class {
  constructor(plugin) {
    this.isRunning = false;
    this.timerId = null;
    this.plugin = plugin;
    this.app = plugin.app;
    this.apiHandler = new APIHandler(plugin);
    this.critic = new Critic(plugin);
    this.reviser = new Reviser(plugin);
  }
  // --- Public Controls ---
  toggleEngineState() {
    if (this.isRunning) {
      this.stop();
    } else {
      this.start();
    }
  }
  addConceptToQueue(concept) {
    const added = this.addConceptsToQueue([concept]);
    if (added > 0) {
      new import_obsidian4.Notice(`'${concept}' added to queue.`);
      this.updateStatusBar();
      return true;
    }
    new import_obsidian4.Notice(`'${concept}' already exists or queued.`);
    return false;
  }
  addConceptsToQueue(concepts) {
    const currentQueue = new Set(this.plugin.data.generationQueue);
    const existingFiles = new Set(this.app.vault.getMarkdownFiles().map((f) => f.basename));
    let addedCount = 0;
    for (const concept of concepts) {
      const sanitized = sanitizeFilename(concept);
      if (!currentQueue.has(concept) && !existingFiles.has(sanitized)) {
        this.plugin.data.generationQueue.push(concept);
        currentQueue.add(concept);
        addedCount++;
      }
    }
    if (addedCount > 0) {
      this.plugin.savePluginData();
      this.updateStatusBar();
    }
    return addedCount;
  }
  // --- Core Loop ---
  // 修改：去除 async，处理 tick 的 promise
  start() {
    if (this.isRunning)
      return;
    this.isRunning = true;
    this.plugin.data.status = "running";
    new import_obsidian4.Notice("Knowledge Graph Engine started!");
    this.updateStatusBar();
    this.tick().catch((error) => {
      console.error("Tick error during start:", error);
      this.stop();
    });
  }
  stop() {
    if (!this.isRunning)
      return;
    this.isRunning = false;
    this.plugin.data.status = "paused";
    if (this.timerId) {
      clearTimeout(this.timerId);
      this.timerId = null;
    }
    new import_obsidian4.Notice("Knowledge Graph Engine paused.");
    this.updateStatusBar();
    this.plugin.savePluginData();
  }
  scheduleNextTick() {
    if (!this.isRunning)
      return;
    const delay = this.plugin.settings.request_delay * 1e3;
    this.timerId = setTimeout(() => {
      this.tick().catch((error) => {
        console.error("Tick error:", error);
      });
    }, delay);
  }
  async tick() {
    if (!this.isRunning)
      return;
    try {
      let taskProcessed = false;
      if (this.plugin.data.revisionQueue.length > 0) {
        taskProcessed = await this.runRevisionPhase();
      } else if (this.plugin.data.reviewQueue.length > 0) {
        taskProcessed = await this.runCriticPhase();
      } else if (this.plugin.data.generationQueue.length > 0) {
        taskProcessed = await this.runGenerationPhase();
      }
      if (!taskProcessed && this.plugin.data.generationQueue.length === 0 && this.plugin.data.reviewQueue.length === 0 && this.plugin.data.revisionQueue.length === 0) {
        new import_obsidian4.Notice("\u{1F389} All tasks completed! Engine stopped.");
        this.isRunning = false;
        this.plugin.data.status = "idle";
        this.updateStatusBar();
        await this.plugin.savePluginData();
        return;
      }
    } catch (error) {
      console.error("Engine fatal error:", error);
      new import_obsidian4.Notice("Engine encountered an error and paused. Check console.");
      this.stop();
      return;
    }
    this.scheduleNextTick();
  }
  // --- Phases ---
  async runGenerationPhase() {
    const queue = this.plugin.data.generationQueue;
    if (queue.length === 0)
      return false;
    const batchSize = this.plugin.settings.generation_batch_size;
    const batch = queue.splice(0, Math.min(queue.length, batchSize));
    this.updateStatusBar();
    await this.plugin.savePluginData();
    const tasks = batch.map((idea) => this.generationTask(idea));
    await Promise.allSettled(tasks);
    await this.plugin.savePluginData();
    return true;
  }
  async generationTask(idea) {
    const prompt = this.plugin.settings.prompt_generator.replace("{concept}", idea);
    try {
      const content = await this.apiHandler.call(prompt);
      const cleanedContent = cleanMarkdownOutput(content);
      this.plugin.data.reviewQueue.push({ idea, content: cleanedContent });
      console.debug(`\u2705 [Generation Success]: ${idea}`);
    } catch (e) {
      if (e instanceof AllModelsFailedError) {
        console.error(`\u274C [Generation Failed]: ${idea} - ${e.message}`);
        this.plugin.data.generationQueue.unshift(idea);
      }
    }
  }
  async runCriticPhase() {
    const queue = this.plugin.data.reviewQueue;
    if (queue.length === 0)
      return false;
    const batchSize = this.plugin.settings.generation_batch_size;
    const tasksToReview = queue.splice(0, Math.min(queue.length, batchSize));
    this.updateStatusBar();
    await this.plugin.savePluginData();
    let newIdeasFound = /* @__PURE__ */ new Set();
    for (const task of tasksToReview) {
      const { isApproved, reason } = await this.critic.judge(task.content);
      if (isApproved) {
        await this.saveNote(task.idea, task.content);
        if (this.plugin.settings.extract_new_concepts) {
          const ideas = extractNewIdeas(task.content);
          ideas.forEach((idea) => newIdeasFound.add(idea));
        }
        console.debug(`\u{1F44D} [Approved]: ${task.idea}`);
      } else {
        task.reason = reason;
        task.retries = (task.retries || 0) + 1;
        this.plugin.data.revisionQueue.push(task);
        console.warn(`\u{1F44E} [Rejected]: ${task.idea} - ${reason}`);
      }
    }
    if (newIdeasFound.size > 0) {
      this.addConceptsToQueue(Array.from(newIdeasFound));
    }
    await this.plugin.savePluginData();
    return true;
  }
  async runRevisionPhase() {
    const queue = this.plugin.data.revisionQueue;
    if (queue.length === 0)
      return false;
    const batchSize = this.plugin.settings.generation_batch_size;
    const tasksToRevise = queue.splice(0, Math.min(queue.length, batchSize));
    this.updateStatusBar();
    await this.plugin.savePluginData();
    for (const task of tasksToRevise) {
      if ((task.retries || 0) >= this.plugin.settings.max_revision_retries) {
        this.plugin.data.discardedPile.push(task);
        console.error(`\u{1F480} [Give up]: ${task.idea} max retries reached.`);
        continue;
      }
      await this.revisionTask(task);
    }
    await this.plugin.savePluginData();
    return true;
  }
  async revisionTask(task) {
    const prompt = this.reviser.createRevisionPrompt(task.idea, task.content, task.reason || "unknown");
    try {
      const newContent = await this.apiHandler.call(prompt);
      const cleanedContent = cleanMarkdownOutput(newContent);
      const revisedTask = { ...task, content: cleanedContent };
      this.plugin.data.reviewQueue.push(revisedTask);
      console.debug(`\u{1F504} [Revision Complete]: ${task.idea}`);
    } catch (e) {
      const errMsg = e instanceof Error ? e.message : String(e);
      console.error(`\u274C [Revision Failed]: ${task.idea} - ${errMsg}`);
      this.plugin.data.revisionQueue.unshift(task);
    }
  }
  // --- File & UI ---
  async saveNote(idea, content) {
    const filename = sanitizeFilename(idea);
    const folderPath = this.plugin.settings.output_dir;
    if (!(this.app.vault.getAbstractFileByPath(folderPath) instanceof import_obsidian4.TFolder)) {
      try {
        await this.app.vault.createFolder(folderPath);
      } catch (error) {
        console.error(`Create folder failed: ${folderPath}`, error);
        new import_obsidian4.Notice(`Cannot create folder: ${folderPath}`);
        return;
      }
    }
    const filePath = (0, import_obsidian4.normalizePath)(`${folderPath}/${filename}.md`);
    const file = this.app.vault.getAbstractFileByPath(filePath);
    try {
      if (file instanceof import_obsidian4.TFile) {
        await this.app.vault.modify(file, content);
        new import_obsidian4.Notice(`Note updated: ${filename}`);
      } else {
        await this.app.vault.create(filePath, content);
        new import_obsidian4.Notice(`Note created: ${filename}`);
      }
    } catch (error) {
      console.error(`Save note failed: ${filePath}`, error);
      new import_obsidian4.Notice(`Cannot save note: ${filename}`);
    }
  }
  updateStatusBar() {
    if (!this.plugin.statusBarEl)
      return;
    const { generationQueue, reviewQueue, revisionQueue } = this.plugin.data;
    const total = generationQueue.length + reviewQueue.length + revisionQueue.length;
    this.plugin.statusBarEl.setText(
      `KG: ${this.plugin.data.status} | G:${generationQueue.length} | C:${reviewQueue.length} | R:${revisionQueue.length} | Total:${total}`
    );
    this.app.workspace.trigger("kg-data-updated");
  }
};

// src/main.ts
var DEFAULT_PLUGIN_DATA = {
  status: "idle",
  generationQueue: [],
  reviewQueue: [],
  revisionQueue: [],
  discardedPile: []
};
var KnowledgeGraphPlugin = class extends import_obsidian5.Plugin {
  async onload() {
    await this.loadSettings();
    await this.loadPluginData();
    this.engine = new Engine(this);
    const ribbonIconEl = this.addRibbonIcon("brain-circuit", "Knowledge Graph Generator", (evt) => {
      this.engine.toggleEngineState();
    });
    ribbonIconEl.addClass("knowledge-graph-plugin-ribbon-class");
    this.statusBarEl = this.addStatusBarItem();
    this.engine.updateStatusBar();
    this.addSettingTab(new KGsSettingTab(this.app, this));
    this.addCommand({
      id: "toggle-knowledge-graph-engine",
      name: "Start/Pause Knowledge Graph generation",
      callback: () => {
        this.engine.toggleEngineState();
      }
    });
    this.addCommand({
      id: "add-current-note-to-queue",
      name: "Add current note title to generation queue",
      checkCallback: (checking) => {
        const file = this.app.workspace.getActiveFile();
        if (file) {
          if (!checking) {
            this.engine.addConceptToQueue(file.basename);
          }
          return true;
        }
        return false;
      }
    });
    console.debug("Knowledge Graph plugin loaded.");
  }
  onunload() {
    console.debug("Knowledge Graph plugin unloaded.");
  }
  async loadSettings() {
    const defaultPrompts = getDefaultPrompts();
    const savedData = await this.loadData();
    const savedSettings = savedData || {};
    this.settings = Object.assign({}, DEFAULT_SETTINGS, defaultPrompts, savedSettings);
  }
  async saveSettings() {
    const dataToSave = { ...this.settings, pluginState: this.data };
    await this.saveData(dataToSave);
  }
  async loadPluginData() {
    const savedData = await this.loadData();
    const savedState = (savedData == null ? void 0 : savedData.pluginState) || {};
    this.data = Object.assign({}, DEFAULT_PLUGIN_DATA, savedState);
  }
  async savePluginData() {
    await this.saveSettings();
  }
};
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsic3JjL21haW4udHMiLCAic3JjL3NldHRpbmdzLnRzIiwgInNyYy9RdWV1ZU1vZGFsLnRzIiwgInNyYy9lbmdpbmUudHMiLCAic3JjL2FwaUhhbmRsZXIudHMiLCAic3JjL2NyaXRpYy50cyIsICJzcmMvcmV2aXNlci50cyIsICJzcmMvdXRpbHMudHMiXSwKICAic291cmNlc0NvbnRlbnQiOiBbIi8vIHNyYy9tYWluLnRzXG5cbmltcG9ydCB7IFBsdWdpbiB9IGZyb20gJ29ic2lkaWFuJztcbmltcG9ydCB7IEtub3dsZWRnZUdyYXBoUGx1Z2luU2V0dGluZ3MsIFBsdWdpbkRhdGEgfSBmcm9tICcuL3R5cGVzJztcbmltcG9ydCB7IEtHc1NldHRpbmdUYWIsIERFRkFVTFRfU0VUVElOR1MsIGdldERlZmF1bHRQcm9tcHRzIH0gZnJvbSAnLi9zZXR0aW5ncyc7XG5pbXBvcnQgeyBFbmdpbmUgfSBmcm9tICcuL2VuZ2luZSc7XG5cbmNvbnN0IERFRkFVTFRfUExVR0lOX0RBVEE6IFBsdWdpbkRhdGEgPSB7XG4gICAgc3RhdHVzOiAnaWRsZScsXG4gICAgZ2VuZXJhdGlvblF1ZXVlOiBbXSxcbiAgICByZXZpZXdRdWV1ZTogW10sXG4gICAgcmV2aXNpb25RdWV1ZTogW10sXG4gICAgZGlzY2FyZGVkUGlsZTogW10sXG59O1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBLbm93bGVkZ2VHcmFwaFBsdWdpbiBleHRlbmRzIFBsdWdpbiB7XG4gICAgc2V0dGluZ3M6IEtub3dsZWRnZUdyYXBoUGx1Z2luU2V0dGluZ3M7XG4gICAgZGF0YTogUGx1Z2luRGF0YTtcbiAgICBlbmdpbmU6IEVuZ2luZTtcbiAgICBzdGF0dXNCYXJFbDogSFRNTEVsZW1lbnQ7XG5cbiAgICBhc3luYyBvbmxvYWQoKSB7XG4gICAgICAgIC8vIDEuIFx1OTk5Nlx1NTE0OFx1NTJBMFx1OEY3RFx1OEJCRVx1N0Y2RVxuICAgICAgICBhd2FpdCB0aGlzLmxvYWRTZXR0aW5ncygpO1xuXG4gICAgICAgIC8vIDIuIFx1NzEzNlx1NTQwRVx1NTJBMFx1OEY3RFx1NjNEMlx1NEVGNlx1NzJCNlx1NjAwMVxuICAgICAgICBhd2FpdCB0aGlzLmxvYWRQbHVnaW5EYXRhKCk7XG4gICAgICAgIFxuICAgICAgICB0aGlzLmVuZ2luZSA9IG5ldyBFbmdpbmUodGhpcyk7XG5cbiAgICAgICAgY29uc3QgcmliYm9uSWNvbkVsID0gdGhpcy5hZGRSaWJib25JY29uKCdicmFpbi1jaXJjdWl0JywgJ0tub3dsZWRnZSBHcmFwaCBHZW5lcmF0b3InLCAoZXZ0OiBNb3VzZUV2ZW50KSA9PiB7XG4gICAgICAgICAgICB0aGlzLmVuZ2luZS50b2dnbGVFbmdpbmVTdGF0ZSgpO1xuICAgICAgICB9KTtcbiAgICAgICAgcmliYm9uSWNvbkVsLmFkZENsYXNzKCdrbm93bGVkZ2UtZ3JhcGgtcGx1Z2luLXJpYmJvbi1jbGFzcycpO1xuXG4gICAgICAgIHRoaXMuc3RhdHVzQmFyRWwgPSB0aGlzLmFkZFN0YXR1c0Jhckl0ZW0oKTtcbiAgICAgICAgdGhpcy5lbmdpbmUudXBkYXRlU3RhdHVzQmFyKCk7XG5cbiAgICAgICAgdGhpcy5hZGRTZXR0aW5nVGFiKG5ldyBLR3NTZXR0aW5nVGFiKHRoaXMuYXBwLCB0aGlzKSk7XG5cbiAgICAgICAgdGhpcy5hZGRDb21tYW5kKHtcbiAgICAgICAgICAgIGlkOiAndG9nZ2xlLWtub3dsZWRnZS1ncmFwaC1lbmdpbmUnLFxuICAgICAgICAgICAgbmFtZTogJ1N0YXJ0L1BhdXNlIEtub3dsZWRnZSBHcmFwaCBnZW5lcmF0aW9uJyxcbiAgICAgICAgICAgIGNhbGxiYWNrOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5lbmdpbmUudG9nZ2xlRW5naW5lU3RhdGUoKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0pO1xuXG4gICAgICAgIHRoaXMuYWRkQ29tbWFuZCh7XG4gICAgICAgICAgICBpZDogJ2FkZC1jdXJyZW50LW5vdGUtdG8tcXVldWUnLFxuICAgICAgICAgICAgbmFtZTogJ0FkZCBjdXJyZW50IG5vdGUgdGl0bGUgdG8gZ2VuZXJhdGlvbiBxdWV1ZScsXG4gICAgICAgICAgICBjaGVja0NhbGxiYWNrOiAoY2hlY2tpbmc6IGJvb2xlYW4pID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBmaWxlID0gdGhpcy5hcHAud29ya3NwYWNlLmdldEFjdGl2ZUZpbGUoKTtcbiAgICAgICAgICAgICAgICBpZiAoZmlsZSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoIWNoZWNraW5nKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmVuZ2luZS5hZGRDb25jZXB0VG9RdWV1ZShmaWxlLmJhc2VuYW1lKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSk7XG4gICAgICAgIFxuICAgICAgICAvLyBcdTRGRUVcdTY1MzlcdUZGMUFjb25zb2xlLmxvZyAtPiBjb25zb2xlLmRlYnVnXG4gICAgICAgIGNvbnNvbGUuZGVidWcoJ0tub3dsZWRnZSBHcmFwaCBwbHVnaW4gbG9hZGVkLicpO1xuICAgIH1cblxuICAgIG9udW5sb2FkKCkge1xuICAgICAgICBjb25zb2xlLmRlYnVnKCdLbm93bGVkZ2UgR3JhcGggcGx1Z2luIHVubG9hZGVkLicpO1xuICAgIH1cblxuICAgIGFzeW5jIGxvYWRTZXR0aW5ncygpIHtcbiAgICAgICAgLy8gXHU0RkVFXHU2NTM5XHVGRjFBZ2V0RGVmYXVsdFByb21wdHMgXHU1REYyXHU3RUNGXHU2NjJGXHU1NDBDXHU2QjY1XHU1MUZEXHU2NTcwXHVGRjBDXHU1M0JCXHU2Mzg5IGF3YWl0XG4gICAgICAgIGNvbnN0IGRlZmF1bHRQcm9tcHRzID0gZ2V0RGVmYXVsdFByb21wdHMoKTtcbiAgICAgICAgY29uc3Qgc2F2ZWREYXRhID0gYXdhaXQgdGhpcy5sb2FkRGF0YSgpO1xuICAgICAgICBjb25zdCBzYXZlZFNldHRpbmdzID0gc2F2ZWREYXRhIHx8IHt9O1xuICAgICAgICBcbiAgICAgICAgdGhpcy5zZXR0aW5ncyA9IE9iamVjdC5hc3NpZ24oe30sIERFRkFVTFRfU0VUVElOR1MsIGRlZmF1bHRQcm9tcHRzLCBzYXZlZFNldHRpbmdzKTtcbiAgICB9XG5cbiAgICBhc3luYyBzYXZlU2V0dGluZ3MoKSB7XG4gICAgICAgIGNvbnN0IGRhdGFUb1NhdmUgPSB7IC4uLnRoaXMuc2V0dGluZ3MsIHBsdWdpblN0YXRlOiB0aGlzLmRhdGEgfTtcbiAgICAgICAgYXdhaXQgdGhpcy5zYXZlRGF0YShkYXRhVG9TYXZlKTtcbiAgICB9XG4gICAgXG4gICAgYXN5bmMgbG9hZFBsdWdpbkRhdGEoKSB7XG4gICAgICAgIGNvbnN0IHNhdmVkRGF0YSA9IGF3YWl0IHRoaXMubG9hZERhdGEoKTtcbiAgICAgICAgY29uc3Qgc2F2ZWRTdGF0ZSA9IHNhdmVkRGF0YT8ucGx1Z2luU3RhdGUgfHwge307XG4gICAgICAgIFxuICAgICAgICB0aGlzLmRhdGEgPSBPYmplY3QuYXNzaWduKHt9LCBERUZBVUxUX1BMVUdJTl9EQVRBLCBzYXZlZFN0YXRlKTtcbiAgICB9XG5cbiAgICBhc3luYyBzYXZlUGx1Z2luRGF0YSgpIHtcbiAgICAgICAgYXdhaXQgdGhpcy5zYXZlU2V0dGluZ3MoKTtcbiAgICB9XG59IiwgIi8vIHNyYy9zZXR0aW5ncy50c1xuXG5pbXBvcnQgeyBBcHAsIFBsdWdpblNldHRpbmdUYWIsIFNldHRpbmcsIE5vdGljZSB9IGZyb20gJ29ic2lkaWFuJztcbmltcG9ydCBLbm93bGVkZ2VHcmFwaFBsdWdpbiBmcm9tICcuL21haW4nO1xuaW1wb3J0IHsgS25vd2xlZGdlR3JhcGhQbHVnaW5TZXR0aW5ncyB9IGZyb20gJy4vdHlwZXMnO1xuaW1wb3J0IHsgUXVldWVNYW5hZ2VtZW50TW9kYWwgfSBmcm9tICcuL1F1ZXVlTW9kYWwnO1xuXG4vLyAtLS0gXHU5RUQ4XHU4QkE0IFByb21wdHMgLS0tXG5jb25zdCBQUk9NUFRfR0VORVJBVE9SX0RFRkFVTFQgPSBgIyBSb2xlOiBcdTc3RTVcdThCQzZcdTdDRkJcdTdFREZcdTY3ODRcdTVFRkFcdTRFMTNcdTVCQjYuLi5gOyAvLyAoXHU2QjY0XHU1OTA0XHU0RkREXHU2MzAxXHU1MzlGXHU2ODM3XHVGRjBDXHU3NzAxXHU3NTY1XHU5NTdGXHU2NTg3XHU2NzJDXHU0RUU1XHU4MjgyXHU3NzAxXHU3QTdBXHU5NUY0KVxuY29uc3QgUFJPTVBUX0NSSVRJQ19ERUZBVUxUID0gYCMgUm9sZTogXHU3N0U1XHU4QkM2XHU1NkZFXHU4QzMxXHU4RDI4XHU5MUNGXHU1QkExXHU2ODM4XHU1NDU4Li4uYDtcbmNvbnN0IFBST01QVF9SRVZJU0VSX0RFRkFVTFQgPSBgIyBSb2xlOiBcdThENDRcdTZERjFcdTc3RTVcdThCQzZcdTdGMTZcdThGOTFcdTRFMEVcdTUxODVcdTVCQjlcdTRGMThcdTUzMTZcdTRFMTNcdTVCQjYuLi5gO1xuXG4vLyAtLS0gXHU5RUQ4XHU4QkE0XHU4QkJFXHU3RjZFIC0tLVxuZXhwb3J0IGNvbnN0IERFRkFVTFRfU0VUVElOR1M6IEtub3dsZWRnZUdyYXBoUGx1Z2luU2V0dGluZ3MgPSB7XG4gICAgLy8gQVBJXG4gICAgb3BlbmFpX2FwaV9rZXlzOiBcIlwiLFxuICAgIG9wZW5haV9iYXNlX3VybDogXCJodHRwczovL2FwaS5vcGVuYWkuY29tL3YxXCIsXG4gICAgb3BlbmFpX21vZGVsOiBcImdwdC00LXR1cmJvLXByZXZpZXdcIixcbiAgICBvcGVuYWlfYmFja3VwX21vZGVsOiBcIlwiLFxuICAgIGdvb2dsZV9hcGlfa2V5czogXCJcIixcbiAgICBnb29nbGVfbW9kZWw6IFwiZ2VtaW5pLTEuNS1wcm8tbGF0ZXN0XCIsXG4gICAgZ29vZ2xlX2JhY2t1cF9tb2RlbDogXCJcIixcbiAgICBmYWlsb3Zlcl9jb29sZG93bl9zZWNvbmRzOiAzMDAsXG4gICAgXG4gICAgLy8gXHU1M0MyXHU2NTcwXG4gICAgZ2VuZXJhdGlvbl90ZW1wZXJhdHVyZTogMC43LFxuICAgIGdlbmVyYXRpb25fbWF4X3Rva2VuczogNDA5NixcbiAgICBcbiAgICAvLyBcdThERUZcdTVGODRcbiAgICBvdXRwdXRfZGlyOiBcIktub3dsZWRnZUdyYXBoTm90ZXNcIixcbiAgICBcbiAgICAvLyBcdTdDRkJcdTdFREZcbiAgICBnZW5lcmF0aW9uX2JhdGNoX3NpemU6IDUsXG4gICAgcmVxdWVzdF9kZWxheTogNSxcbiAgICBcbiAgICAvLyBDcml0aWNcbiAgICBjcml0aWNfbW9kZTogXCJoZXVyaXN0aWNcIixcbiAgICBjcml0aWNfcmVxdWlyZWRfaGVhZGVyczogXCIjIFx1RDgzRVx1RERFMFxcbj4gXFxuIyMgXHVEODNEXHVEQ0ExIFx1NjgzOFx1NUZDM1x1NjAxRFx1NjBGM1xcbiMjIFx1RDgzQ1x1REZBRiBcdTkwMDJcdTc1MjhcdTU3M0FcdTY2NkZcXG4jIyBcdUQ4M0RcdURFRTBcdUZFMEYgXHU0RjdGXHU3NTI4XHU2QjY1XHU5QUE0L1x1Njc4NFx1NjIxMFx1ODk4MVx1N0QyMFxcbiMjIFx1RDgzRFx1REU4MCBcdTY4NDhcdTRGOEJcdTUyMDZcdTY3OTBcXG4jIyBcdUQ4M0RcdURDNEQgXHU0RjE4XHU3MEI5ICYgXHVEODNEXHVEQzRFIFx1N0YzQVx1NzBCOVxcbiMjIFx1RDgzRFx1REQxNyBcdTUxNzNcdTgwNTRcdTZBMjFcdTU3OEJcIixcbiAgICBjcml0aWNfbWluX2NvbnRlbnRfbGVuZ3RoOiA0MDAsXG4gICAgXG4gICAgLy8gUmV2aXNlclxuICAgIG1heF9yZXZpc2lvbl9yZXRyaWVzOiAyLFxuICAgIFxuICAgIC8vIFByb21wdHNcbiAgICBwcm9tcHRfZ2VuZXJhdG9yOiBQUk9NUFRfR0VORVJBVE9SX0RFRkFVTFQsXG4gICAgcHJvbXB0X2NyaXRpYzogUFJPTVBUX0NSSVRJQ19ERUZBVUxULFxuICAgIHByb21wdF9yZXZpc2VyOiBQUk9NUFRfUkVWSVNFUl9ERUZBVUxULFxuICAgIFxuICAgIC8vIFx1NjRBRFx1NzlDRFx1N0JCMVxuICAgIHNlZWRDb25jZXB0czogXCJcIixcbiAgICBcbiAgICAvLyBcdTY1QjBcdTY5ODJcdTVGRjVcdTYzRDBcdTUzRDZcbiAgICBleHRyYWN0X25ld19jb25jZXB0czogZmFsc2Vcbn07XG5cbi8vIC0tLSBcdTlFRDhcdThCQTQgUHJvbXB0cyBcdTgzQjdcdTUzRDZcdTUxRkRcdTY1NzAgKFx1NzlGQlx1OTY2NCBhc3luYykgLS0tXG5leHBvcnQgZnVuY3Rpb24gZ2V0RGVmYXVsdFByb21wdHMoKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgICAgcHJvbXB0X2dlbmVyYXRvcjogUFJPTVBUX0dFTkVSQVRPUl9ERUZBVUxULFxuICAgICAgICBwcm9tcHRfY3JpdGljOiBQUk9NUFRfQ1JJVElDX0RFRkFVTFQsXG4gICAgICAgIHByb21wdF9yZXZpc2VyOiBQUk9NUFRfUkVWSVNFUl9ERUZBVUxUXG4gICAgfTtcbn1cblxuLy8gLS0tIFx1OEJCRVx1N0Y2RVx1OTAwOVx1OTg3OVx1NTM2MSAtLS1cbmV4cG9ydCBjbGFzcyBLR3NTZXR0aW5nVGFiIGV4dGVuZHMgUGx1Z2luU2V0dGluZ1RhYiB7XG4gICAgcGx1Z2luOiBLbm93bGVkZ2VHcmFwaFBsdWdpbjtcblxuICAgIGNvbnN0cnVjdG9yKGFwcDogQXBwLCBwbHVnaW46IEtub3dsZWRnZUdyYXBoUGx1Z2luKSB7XG4gICAgICAgIHN1cGVyKGFwcCwgcGx1Z2luKTtcbiAgICAgICAgdGhpcy5wbHVnaW4gPSBwbHVnaW47XG4gICAgfVxuXG4gICAgZGlzcGxheSgpOiB2b2lkIHtcbiAgICAgICAgY29uc3QgeyBjb250YWluZXJFbCB9ID0gdGhpcztcbiAgICAgICAgY29udGFpbmVyRWwuZW1wdHkoKTtcbiAgICAgICAgXG4gICAgICAgIC8vIFx1NEZFRVx1NjUzOVx1RkYxQVx1NEY3Rlx1NzUyOCBTZXR0aW5nLnNldEhlYWRpbmcoKVxuICAgICAgICBuZXcgU2V0dGluZyhjb250YWluZXJFbClcbiAgICAgICAgICAgIC5zZXROYW1lKFwiS25vd2xlZGdlIEdyYXBoIEdlbmVyYXRvciBzZXR0aW5nc1wiKVxuICAgICAgICAgICAgLnNldEhlYWRpbmcoKTtcblxuICAgICAgICAvLyAtLS0gXHU5NjFGXHU1MjE3XHU3QkExXHU3NDA2IC0tLVxuICAgICAgICBuZXcgU2V0dGluZyhjb250YWluZXJFbClcbiAgICAgICAgICAgIC5zZXROYW1lKFwiRW5naW5lIGRhc2hib2FyZFwiKVxuICAgICAgICAgICAgLnNldERlc2MoXCJNYW5hZ2UgZ2VuZXJhdGlvbiwgcmV2aWV3LCBhbmQgZGlzY2FyZGVkIHRhc2tzLlwiKVxuICAgICAgICAgICAgLmFkZEJ1dHRvbihidXR0b24gPT4gYnV0dG9uXG4gICAgICAgICAgICAgICAgLnNldEJ1dHRvblRleHQoXCJPcGVuIHF1ZXVlIG1hbmFnZXJcIilcbiAgICAgICAgICAgICAgICAuc2V0Q3RhKClcbiAgICAgICAgICAgICAgICAub25DbGljaygoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIG5ldyBRdWV1ZU1hbmFnZW1lbnRNb2RhbCh0aGlzLmFwcCwgdGhpcy5wbHVnaW4pLm9wZW4oKTtcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgKTtcblxuICAgICAgICAvLyAtLS0gQVBJIFx1OEJCRVx1N0Y2RSAtLS1cbiAgICAgICAgbmV3IFNldHRpbmcoY29udGFpbmVyRWwpLnNldE5hbWUoXCJBUEkgc2V0dGluZ3NcIikuc2V0SGVhZGluZygpO1xuXG4gICAgICAgIG5ldyBTZXR0aW5nKGNvbnRhaW5lckVsKS5zZXROYW1lKFwiT3BlbkFJXCIpLnNldEhlYWRpbmcoKTtcbiAgICAgICAgXG4gICAgICAgIG5ldyBTZXR0aW5nKGNvbnRhaW5lckVsKVxuICAgICAgICAgICAgLnNldE5hbWUoXCJPcGVuQUkgQVBJIGtleXNcIilcbiAgICAgICAgICAgIC5zZXREZXNjKFwiT25lIGtleSBwZXIgbGluZS5cIilcbiAgICAgICAgICAgIC5hZGRUZXh0QXJlYSh0ZXh0ID0+IHRleHRcbiAgICAgICAgICAgICAgICAuc2V0UGxhY2Vob2xkZXIoXCJzay0uLi5cIilcbiAgICAgICAgICAgICAgICAuc2V0VmFsdWUodGhpcy5wbHVnaW4uc2V0dGluZ3Mub3BlbmFpX2FwaV9rZXlzKVxuICAgICAgICAgICAgICAgIC5vbkNoYW5nZShhc3luYyAodmFsdWUpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3Mub3BlbmFpX2FwaV9rZXlzID0gdmFsdWU7XG4gICAgICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xuICAgICAgICAgICAgICAgIH0pKTtcblxuICAgICAgICBuZXcgU2V0dGluZyhjb250YWluZXJFbClcbiAgICAgICAgICAgIC5zZXROYW1lKFwiT3BlbkFJIGJhc2UgVVJMXCIpXG4gICAgICAgICAgICAuc2V0RGVzYyhcIlByb3h5IFVSTCBpZiBhcHBsaWNhYmxlLlwiKVxuICAgICAgICAgICAgLmFkZFRleHQodGV4dCA9PiB0ZXh0XG4gICAgICAgICAgICAgICAgLnNldFBsYWNlaG9sZGVyKFwiaHR0cHM6Ly9hcGkub3BlbmFpLmNvbS92MVwiKVxuICAgICAgICAgICAgICAgIC5zZXRWYWx1ZSh0aGlzLnBsdWdpbi5zZXR0aW5ncy5vcGVuYWlfYmFzZV91cmwpXG4gICAgICAgICAgICAgICAgLm9uQ2hhbmdlKGFzeW5jICh2YWx1ZSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5vcGVuYWlfYmFzZV91cmwgPSB2YWx1ZS50cmltKCk7XG4gICAgICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xuICAgICAgICAgICAgICAgIH0pKTtcbiAgICAgICAgXG4gICAgICAgIG5ldyBTZXR0aW5nKGNvbnRhaW5lckVsKVxuICAgICAgICAgICAgLnNldE5hbWUoXCJPcGVuQUkgbW9kZWwgKHByaW1hcnkpXCIpXG4gICAgICAgICAgICAuc2V0RGVzYyhcIlByaW1hcnkgbW9kZWwgbmFtZS5cIilcbiAgICAgICAgICAgIC5hZGRUZXh0KHRleHQgPT4gdGV4dFxuICAgICAgICAgICAgICAgIC5zZXRQbGFjZWhvbGRlcihcImdwdC00LXR1cmJvLXByZXZpZXdcIilcbiAgICAgICAgICAgICAgICAuc2V0VmFsdWUodGhpcy5wbHVnaW4uc2V0dGluZ3Mub3BlbmFpX21vZGVsKVxuICAgICAgICAgICAgICAgIC5vbkNoYW5nZShhc3luYyAodmFsdWUpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3Mub3BlbmFpX21vZGVsID0gdmFsdWUudHJpbSgpO1xuICAgICAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKTtcbiAgICAgICAgICAgICAgICB9KSk7XG4gICAgICAgIFxuICAgICAgICBuZXcgU2V0dGluZyhjb250YWluZXJFbClcbiAgICAgICAgICAgIC5zZXROYW1lKFwiT3BlbkFJIGJhY2t1cCBtb2RlbFwiKVxuICAgICAgICAgICAgLnNldERlc2MoXCJVc2VkIHdoZW4gcHJpbWFyeSBmYWlscy5cIilcbiAgICAgICAgICAgIC5hZGRUZXh0KHRleHQgPT4gdGV4dFxuICAgICAgICAgICAgICAgIC5zZXRQbGFjZWhvbGRlcihcImdwdC0zLjUtdHVyYm9cIilcbiAgICAgICAgICAgICAgICAuc2V0VmFsdWUodGhpcy5wbHVnaW4uc2V0dGluZ3Mub3BlbmFpX2JhY2t1cF9tb2RlbClcbiAgICAgICAgICAgICAgICAub25DaGFuZ2UoYXN5bmMgKHZhbHVlKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLm9wZW5haV9iYWNrdXBfbW9kZWwgPSB2YWx1ZS50cmltKCk7XG4gICAgICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xuICAgICAgICAgICAgICAgIH0pKTtcblxuICAgICAgICBuZXcgU2V0dGluZyhjb250YWluZXJFbCkuc2V0TmFtZShcIkdvb2dsZSBHZW1pbmlcIikuc2V0SGVhZGluZygpO1xuICAgICAgICBcbiAgICAgICAgbmV3IFNldHRpbmcoY29udGFpbmVyRWwpXG4gICAgICAgICAgICAuc2V0TmFtZShcIkdvb2dsZSBHZW1pbmkgQVBJIGtleXNcIilcbiAgICAgICAgICAgIC5zZXREZXNjKFwiT25lIGtleSBwZXIgbGluZS5cIilcbiAgICAgICAgICAgIC5hZGRUZXh0QXJlYSh0ZXh0ID0+IHRleHRcbiAgICAgICAgICAgICAgICAuc2V0UGxhY2Vob2xkZXIoXCJBSXphU3kuLi5cIilcbiAgICAgICAgICAgICAgICAuc2V0VmFsdWUodGhpcy5wbHVnaW4uc2V0dGluZ3MuZ29vZ2xlX2FwaV9rZXlzKVxuICAgICAgICAgICAgICAgIC5vbkNoYW5nZShhc3luYyAodmFsdWUpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MuZ29vZ2xlX2FwaV9rZXlzID0gdmFsdWU7XG4gICAgICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xuICAgICAgICAgICAgICAgIH0pKTtcblxuICAgICAgICBuZXcgU2V0dGluZyhjb250YWluZXJFbClcbiAgICAgICAgICAgIC5zZXROYW1lKFwiR29vZ2xlIEdlbWluaSBtb2RlbCAocHJpbWFyeSlcIilcbiAgICAgICAgICAgIC5zZXREZXNjKFwiUHJpbWFyeSBtb2RlbCBuYW1lLlwiKVxuICAgICAgICAgICAgLmFkZFRleHQodGV4dCA9PiB0ZXh0XG4gICAgICAgICAgICAgICAgLnNldFBsYWNlaG9sZGVyKFwiZ2VtaW5pLTEuNS1wcm8tbGF0ZXN0XCIpXG4gICAgICAgICAgICAgICAgLnNldFZhbHVlKHRoaXMucGx1Z2luLnNldHRpbmdzLmdvb2dsZV9tb2RlbClcbiAgICAgICAgICAgICAgICAub25DaGFuZ2UoYXN5bmMgKHZhbHVlKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLmdvb2dsZV9tb2RlbCA9IHZhbHVlLnRyaW0oKTtcbiAgICAgICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XG4gICAgICAgICAgICAgICAgfSkpO1xuXG4gICAgICAgIG5ldyBTZXR0aW5nKGNvbnRhaW5lckVsKVxuICAgICAgICAgICAgLnNldE5hbWUoXCJHb29nbGUgR2VtaW5pIGJhY2t1cCBtb2RlbFwiKVxuICAgICAgICAgICAgLnNldERlc2MoXCJVc2VkIHdoZW4gcHJpbWFyeSBmYWlscy5cIilcbiAgICAgICAgICAgIC5hZGRUZXh0KHRleHQgPT4gdGV4dFxuICAgICAgICAgICAgICAgIC5zZXRQbGFjZWhvbGRlcihcImdlbWluaS0xLjAtcHJvXCIpXG4gICAgICAgICAgICAgICAgLnNldFZhbHVlKHRoaXMucGx1Z2luLnNldHRpbmdzLmdvb2dsZV9iYWNrdXBfbW9kZWwpXG4gICAgICAgICAgICAgICAgLm9uQ2hhbmdlKGFzeW5jICh2YWx1ZSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5nb29nbGVfYmFja3VwX21vZGVsID0gdmFsdWUudHJpbSgpO1xuICAgICAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKTtcbiAgICAgICAgICAgICAgICB9KSk7XG5cbiAgICAgICAgbmV3IFNldHRpbmcoY29udGFpbmVyRWwpXG4gICAgICAgICAgICAuc2V0TmFtZShcIktleSBjb29sZG93biAoc2Vjb25kcylcIilcbiAgICAgICAgICAgIC5zZXREZXNjKFwiV2FpdCB0aW1lIGFmdGVyIGtleSBmYWlsdXJlLlwiKVxuICAgICAgICAgICAgLmFkZFRleHQodGV4dCA9PiB0ZXh0XG4gICAgICAgICAgICAgICAgLnNldFZhbHVlKFN0cmluZyh0aGlzLnBsdWdpbi5zZXR0aW5ncy5mYWlsb3Zlcl9jb29sZG93bl9zZWNvbmRzKSlcbiAgICAgICAgICAgICAgICAub25DaGFuZ2UoYXN5bmMgKHZhbHVlKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IG51bSA9IHBhcnNlSW50KHZhbHVlLCAxMCk7XG4gICAgICAgICAgICAgICAgICAgIGlmICghaXNOYU4obnVtKSAmJiBudW0gPj0gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MuZmFpbG92ZXJfY29vbGRvd25fc2Vjb25kcyA9IG51bTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSkpO1xuXG4gICAgICAgIC8vIC0tLSBMTE0gXHU1M0MyXHU2NTcwXHU4QkJFXHU3RjZFIC0tLVxuICAgICAgICBuZXcgU2V0dGluZyhjb250YWluZXJFbCkuc2V0TmFtZShcIkxMTSBwYXJhbWV0ZXJzXCIpLnNldEhlYWRpbmcoKTtcbiAgICAgICAgbmV3IFNldHRpbmcoY29udGFpbmVyRWwpXG4gICAgICAgICAgICAuc2V0TmFtZShcIkdlbmVyYXRpb24gdGVtcGVyYXR1cmVcIilcbiAgICAgICAgICAgIC5zZXREZXNjKFwiMC4wIHRvIDIuMCAoQ3JlYXRpdmUgdnMgRGV0ZXJtaW5pc3RpYykuXCIpXG4gICAgICAgICAgICAuYWRkVGV4dCh0ZXh0ID0+IHRleHRcbiAgICAgICAgICAgICAgICAuc2V0VmFsdWUoU3RyaW5nKHRoaXMucGx1Z2luLnNldHRpbmdzLmdlbmVyYXRpb25fdGVtcGVyYXR1cmUpKVxuICAgICAgICAgICAgICAgIC5vbkNoYW5nZShhc3luYyAodmFsdWUpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgbnVtID0gcGFyc2VGbG9hdCh2YWx1ZSk7XG4gICAgICAgICAgICAgICAgICAgIGlmICghaXNOYU4obnVtKSAmJiBudW0gPj0gMCAmJiBudW0gPD0gMikge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MuZ2VuZXJhdGlvbl90ZW1wZXJhdHVyZSA9IG51bTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSkpO1xuXG4gICAgICAgIG5ldyBTZXR0aW5nKGNvbnRhaW5lckVsKVxuICAgICAgICAgICAgLnNldE5hbWUoXCJNYXggdG9rZW5zXCIpXG4gICAgICAgICAgICAuc2V0RGVzYyhcIk1heGltdW0gdG9rZW5zIHBlciByZXNwb25zZS5cIilcbiAgICAgICAgICAgIC5hZGRUZXh0KHRleHQgPT4gdGV4dFxuICAgICAgICAgICAgICAgIC5zZXRWYWx1ZShTdHJpbmcodGhpcy5wbHVnaW4uc2V0dGluZ3MuZ2VuZXJhdGlvbl9tYXhfdG9rZW5zKSlcbiAgICAgICAgICAgICAgICAub25DaGFuZ2UoYXN5bmMgKHZhbHVlKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IG51bSA9IHBhcnNlSW50KHZhbHVlLCAxMCk7XG4gICAgICAgICAgICAgICAgICAgIGlmICghaXNOYU4obnVtKSAmJiBudW0gPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5nZW5lcmF0aW9uX21heF90b2tlbnMgPSBudW07XG4gICAgICAgICAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pKTtcblxuICAgICAgICAvLyAtLS0gXHU1RjE1XHU2NENFXHU4QkJFXHU3RjZFIC0tLVxuICAgICAgICBuZXcgU2V0dGluZyhjb250YWluZXJFbCkuc2V0TmFtZShcIkVuZ2luZSBzZXR0aW5nc1wiKS5zZXRIZWFkaW5nKCk7XG4gICAgICAgIG5ldyBTZXR0aW5nKGNvbnRhaW5lckVsKVxuICAgICAgICAgICAgLnNldE5hbWUoXCJPdXRwdXQgZm9sZGVyXCIpXG4gICAgICAgICAgICAuc2V0RGVzYyhcIk5vdGVzIHdpbGwgYmUgc2F2ZWQgaGVyZS5cIilcbiAgICAgICAgICAgIC5hZGRUZXh0KHRleHQgPT4gdGV4dFxuICAgICAgICAgICAgICAgIC5zZXRQbGFjZWhvbGRlcihcIktub3dsZWRnZUdyYXBoTm90ZXNcIilcbiAgICAgICAgICAgICAgICAuc2V0VmFsdWUodGhpcy5wbHVnaW4uc2V0dGluZ3Mub3V0cHV0X2RpcilcbiAgICAgICAgICAgICAgICAub25DaGFuZ2UoYXN5bmMgKHZhbHVlKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLm91dHB1dF9kaXIgPSB2YWx1ZS50cmltKCkucmVwbGFjZSgvXFwvJC8sIFwiXCIpOyBcbiAgICAgICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XG4gICAgICAgICAgICAgICAgfSkpO1xuXG4gICAgICAgIG5ldyBTZXR0aW5nKGNvbnRhaW5lckVsKVxuICAgICAgICAgICAgLnNldE5hbWUoXCJHZW5lcmF0aW9uIGJhdGNoIHNpemVcIilcbiAgICAgICAgICAgIC5zZXREZXNjKFwiTnVtYmVyIG9mIHRhc2tzIHBlciBjeWNsZS5cIilcbiAgICAgICAgICAgIC5hZGRUZXh0KHRleHQgPT4gdGV4dFxuICAgICAgICAgICAgICAgIC5zZXRWYWx1ZShTdHJpbmcodGhpcy5wbHVnaW4uc2V0dGluZ3MuZ2VuZXJhdGlvbl9iYXRjaF9zaXplKSlcbiAgICAgICAgICAgICAgICAub25DaGFuZ2UoYXN5bmMgKHZhbHVlKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IG51bSA9IHBhcnNlSW50KHZhbHVlLCAxMCk7XG4gICAgICAgICAgICAgICAgICAgIGlmICghaXNOYU4obnVtKSAmJiBudW0gPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5nZW5lcmF0aW9uX2JhdGNoX3NpemUgPSBudW07XG4gICAgICAgICAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pKTtcblxuICAgICAgICBuZXcgU2V0dGluZyhjb250YWluZXJFbClcbiAgICAgICAgICAgIC5zZXROYW1lKFwiUmVxdWVzdCBkZWxheSAoc2Vjb25kcylcIilcbiAgICAgICAgICAgIC5zZXREZXNjKFwiV2FpdCB0aW1lIGJldHdlZW4gYmF0Y2hlcy5cIilcbiAgICAgICAgICAgIC5hZGRUZXh0KHRleHQgPT4gdGV4dFxuICAgICAgICAgICAgICAgIC5zZXRWYWx1ZShTdHJpbmcodGhpcy5wbHVnaW4uc2V0dGluZ3MucmVxdWVzdF9kZWxheSkpXG4gICAgICAgICAgICAgICAgLm9uQ2hhbmdlKGFzeW5jICh2YWx1ZSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBudW0gPSBwYXJzZUludCh2YWx1ZSwgMTApO1xuICAgICAgICAgICAgICAgICAgICBpZiAoIWlzTmFOKG51bSkgJiYgbnVtID49IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLnJlcXVlc3RfZGVsYXkgPSBudW07XG4gICAgICAgICAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pKTtcbiAgICAgICAgXG4gICAgICAgIG5ldyBTZXR0aW5nKGNvbnRhaW5lckVsKVxuICAgICAgICAgICAgLnNldE5hbWUoXCJNYXggcmV2aXNpb24gcmV0cmllc1wiKVxuICAgICAgICAgICAgLnNldERlc2MoXCJNYXhpbXVtIGF0dGVtcHRzIGJlZm9yZSBkaXNjYXJkaW5nLlwiKVxuICAgICAgICAgICAgLmFkZFRleHQodGV4dCA9PiB0ZXh0XG4gICAgICAgICAgICAgICAgLnNldFZhbHVlKFN0cmluZyh0aGlzLnBsdWdpbi5zZXR0aW5ncy5tYXhfcmV2aXNpb25fcmV0cmllcykpXG4gICAgICAgICAgICAgICAgLm9uQ2hhbmdlKGFzeW5jICh2YWx1ZSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBudW0gPSBwYXJzZUludCh2YWx1ZSwgMTApO1xuICAgICAgICAgICAgICAgICAgICBpZiAoIWlzTmFOKG51bSkgJiYgbnVtID49IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLm1heF9yZXZpc2lvbl9yZXRyaWVzID0gbnVtO1xuICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KSk7XG4gICAgICAgIFxuICAgICAgICBuZXcgU2V0dGluZyhjb250YWluZXJFbClcbiAgICAgICAgICAgIC5zZXROYW1lKFwiRXh0cmFjdCBuZXcgY29uY2VwdHNcIilcbiAgICAgICAgICAgIC5zZXREZXNjKFwiQXV0b21hdGljYWxseSBhZGQgW1tXaWtpbGlua3NdXSBmcm9tIGFwcHJvdmVkIG5vdGVzIHRvIGdlbmVyYXRpb24gcXVldWUuXCIpXG4gICAgICAgICAgICAuYWRkVG9nZ2xlKHRvZ2dsZSA9PiB0b2dnbGVcbiAgICAgICAgICAgICAgICAuc2V0VmFsdWUodGhpcy5wbHVnaW4uc2V0dGluZ3MuZXh0cmFjdF9uZXdfY29uY2VwdHMpXG4gICAgICAgICAgICAgICAgLm9uQ2hhbmdlKGFzeW5jICh2YWx1ZSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5leHRyYWN0X25ld19jb25jZXB0cyA9IHZhbHVlO1xuICAgICAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKTtcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgKTtcblxuICAgICAgICAvLyAtLS0gQ3JpdGljIFx1OEJCRVx1N0Y2RSAtLS1cbiAgICAgICAgbmV3IFNldHRpbmcoY29udGFpbmVyRWwpXG4gICAgICAgICAgICAuc2V0TmFtZShcIkNyaXRpYyBtb2RlXCIpXG4gICAgICAgICAgICAuc2V0RGVzYyhcIkhldXJpc3RpYyAoZmFzdCwgZm9ybWF0dGluZyBjaGVjaykgb3IgQUkgKHNtYXJ0LCBjb250ZW50IGNoZWNrKS5cIilcbiAgICAgICAgICAgIC5hZGREcm9wZG93bihkcm9wZG93biA9PiBkcm9wZG93blxuICAgICAgICAgICAgICAgIC5hZGRPcHRpb24oXCJoZXVyaXN0aWNcIiwgXCJIZXVyaXN0aWNcIilcbiAgICAgICAgICAgICAgICAuYWRkT3B0aW9uKFwiYWlcIiwgXCJBcnRpZmljaWFsIEludGVsbGlnZW5jZSAoQUkpXCIpXG4gICAgICAgICAgICAgICAgLnNldFZhbHVlKHRoaXMucGx1Z2luLnNldHRpbmdzLmNyaXRpY19tb2RlKVxuICAgICAgICAgICAgICAgIC5vbkNoYW5nZShhc3luYyAodmFsdWU6ICdoZXVyaXN0aWMnIHwgJ2FpJykgPT4ge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5jcml0aWNfbW9kZSA9IHZhbHVlO1xuICAgICAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5kaXNwbGF5KCk7IFxuICAgICAgICAgICAgICAgIH0pKTtcblxuICAgICAgICBpZiAodGhpcy5wbHVnaW4uc2V0dGluZ3MuY3JpdGljX21vZGUgPT09IFwiaGV1cmlzdGljXCIpIHtcbiAgICAgICAgICAgIG5ldyBTZXR0aW5nKGNvbnRhaW5lckVsKVxuICAgICAgICAgICAgICAgIC5zZXROYW1lKFwiSGV1cmlzdGljOiByZXF1aXJlZCBoZWFkZXJzXCIpXG4gICAgICAgICAgICAgICAgLnNldERlc2MoXCJOb3RlcyBtdXN0IGNvbnRhaW4gdGhlc2UgaGVhZGVycyAob25lIHBlciBsaW5lKS5cIilcbiAgICAgICAgICAgICAgICAuYWRkVGV4dEFyZWEodGV4dCA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHRleHQuc2V0VmFsdWUodGhpcy5wbHVnaW4uc2V0dGluZ3MuY3JpdGljX3JlcXVpcmVkX2hlYWRlcnMpXG4gICAgICAgICAgICAgICAgICAgICAgICAub25DaGFuZ2UoYXN5bmMgKHZhbHVlKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MuY3JpdGljX3JlcXVpcmVkX2hlYWRlcnMgPSB2YWx1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB0ZXh0LmlucHV0RWwuYWRkQ2xhc3MoXCJrZy10ZXh0YXJlYS1zaG9ydFwiKTsgLy8gXHU0RjdGXHU3NTI4IENTUyBcdTdDN0JcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgbmV3IFNldHRpbmcoY29udGFpbmVyRWwpXG4gICAgICAgICAgICAgICAgLnNldE5hbWUoXCJIZXVyaXN0aWM6IG1pbiBjb250ZW50IGxlbmd0aFwiKVxuICAgICAgICAgICAgICAgIC5zZXREZXNjKFwiTWluaW11bSBjaGFyYWN0ZXIgY291bnQuXCIpXG4gICAgICAgICAgICAgICAgLmFkZFRleHQodGV4dCA9PiB0ZXh0XG4gICAgICAgICAgICAgICAgICAgIC5zZXRWYWx1ZShTdHJpbmcodGhpcy5wbHVnaW4uc2V0dGluZ3MuY3JpdGljX21pbl9jb250ZW50X2xlbmd0aCkpXG4gICAgICAgICAgICAgICAgICAgIC5vbkNoYW5nZShhc3luYyAodmFsdWUpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG51bSA9IHBhcnNlSW50KHZhbHVlLCAxMCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWlzTmFOKG51bSkgJiYgbnVtID49IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5jcml0aWNfbWluX2NvbnRlbnRfbGVuZ3RoID0gbnVtO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KSk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyAtLS0gXHU2OTgyXHU1RkY1XHU2NEFEXHU3OUNEIC0tLVxuICAgICAgICBuZXcgU2V0dGluZyhjb250YWluZXJFbCkuc2V0TmFtZShcIkNvbmNlcHQgc2VlZGluZ1wiKS5zZXRIZWFkaW5nKCk7XG4gICAgICAgIG5ldyBTZXR0aW5nKGNvbnRhaW5lckVsKVxuICAgICAgICAgICAgLnNldE5hbWUoXCJTZWVkIGJveFwiKVxuICAgICAgICAgICAgLnNldERlc2MoXCJFbnRlciBjb25jZXB0cyBoZXJlLCBvbmUgcGVyIGxpbmUuXCIpXG4gICAgICAgICAgICAuYWRkVGV4dEFyZWEodGV4dCA9PiB7XG4gICAgICAgICAgICAgICAgdGV4dC5zZXRQbGFjZWhvbGRlcihcIkZpcnN0IFByaW5jaXBsZXNcXG5PY2NhbSdzIFJhem9yXFxuLi4uXCIpXG4gICAgICAgICAgICAgICAgICAgIC5zZXRWYWx1ZSh0aGlzLnBsdWdpbi5zZXR0aW5ncy5zZWVkQ29uY2VwdHMpXG4gICAgICAgICAgICAgICAgICAgIC5vbkNoYW5nZShhc3luYyAodmFsdWUpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLnNlZWRDb25jZXB0cyA9IHZhbHVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHRleHQuaW5wdXRFbC5hZGRDbGFzcyhcImtnLXRleHRhcmVhLW1lZGl1bVwiKTsgLy8gXHU0RjdGXHU3NTI4IENTUyBcdTdDN0JcbiAgICAgICAgICAgIH0pO1xuICAgICAgICBcbiAgICAgICAgbmV3IFNldHRpbmcoY29udGFpbmVyRWwpXG4gICAgICAgICAgICAuYWRkQnV0dG9uKGJ1dHRvbiA9PiBidXR0b25cbiAgICAgICAgICAgICAgICAuc2V0QnV0dG9uVGV4dChcIlNlZWQgdG8gcXVldWVcIilcbiAgICAgICAgICAgICAgICAuc2V0Q3RhKClcbiAgICAgICAgICAgICAgICAub25DbGljayhhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHJhd1RleHQgPSB0aGlzLnBsdWdpbi5zZXR0aW5ncy5zZWVkQ29uY2VwdHM7XG4gICAgICAgICAgICAgICAgICAgIGlmICghcmF3VGV4dC50cmltKCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG5ldyBOb3RpY2UoXCJTZWVkIGJveCBpcyBlbXB0eS5cIik7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgY29uc3QgY29uY2VwdHNUb1NlZWQgPSBbLi4ubmV3IFNldChcbiAgICAgICAgICAgICAgICAgICAgICAgIHJhd1RleHQuc3BsaXQoXCJcXG5cIikubWFwKGxpbmUgPT4gbGluZS50cmltKCkpLmZpbHRlcihCb29sZWFuKVxuICAgICAgICAgICAgICAgICAgICApXTtcbiAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGFkZGVkQ291bnQgPSB0aGlzLnBsdWdpbi5lbmdpbmUuYWRkQ29uY2VwdHNUb1F1ZXVlKGNvbmNlcHRzVG9TZWVkKTtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgaWdub3JlZENvdW50ID0gY29uY2VwdHNUb1NlZWQubGVuZ3RoIC0gYWRkZWRDb3VudDtcblxuICAgICAgICAgICAgICAgICAgICBsZXQgbm90aWNlTWVzc2FnZSA9IGBBZGRlZCAke2FkZGVkQ291bnR9IGNvbmNlcHRzLmA7XG4gICAgICAgICAgICAgICAgICAgIGlmIChpZ25vcmVkQ291bnQgPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBub3RpY2VNZXNzYWdlICs9IGBcXG4ke2lnbm9yZWRDb3VudH0gaWdub3JlZCAoZHVwbGljYXRlL2V4aXN0aW5nKS5gO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIG5ldyBOb3RpY2Uobm90aWNlTWVzc2FnZSwgNTAwMCk7XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gXHU2RTA1XHU3QTdBXHU2NEFEXHU3OUNEXHU3QkIxXG4gICAgICAgICAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLnNlZWRDb25jZXB0cyA9IFwiXCI7XG4gICAgICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmRpc3BsYXkoKTsgXG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICk7XG5cbiAgICAgICAgLy8gLS0tIFByb21wdHMgXHU4QkJFXHU3RjZFIC0tLVxuICAgICAgICBuZXcgU2V0dGluZyhjb250YWluZXJFbCkuc2V0TmFtZShcIlByb21wdHMgc2V0dGluZ3NcIikuc2V0SGVhZGluZygpO1xuICAgICAgICBcbiAgICAgICAgbmV3IFNldHRpbmcoY29udGFpbmVyRWwpXG4gICAgICAgICAgICAuc2V0TmFtZShcIkdlbmVyYXRvciBwcm9tcHRcIilcbiAgICAgICAgICAgIC5zZXREZXNjKFwiUHJvbXB0IGZvciBnZW5lcmF0aW5nIG5ldyBjb250ZW50LlwiKVxuICAgICAgICAgICAgLmFkZFRleHRBcmVhKHRleHQgPT4ge1xuICAgICAgICAgICAgICAgIHRleHQuc2V0VmFsdWUodGhpcy5wbHVnaW4uc2V0dGluZ3MucHJvbXB0X2dlbmVyYXRvcilcbiAgICAgICAgICAgICAgICAgICAgLm9uQ2hhbmdlKGFzeW5jICh2YWx1ZSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MucHJvbXB0X2dlbmVyYXRvciA9IHZhbHVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHRleHQuaW5wdXRFbC5hZGRDbGFzcyhcImtnLXRleHRhcmVhLXRhbGxcIik7IC8vIFx1NEY3Rlx1NzUyOCBDU1MgXHU3QzdCXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICBpZiAodGhpcy5wbHVnaW4uc2V0dGluZ3MuY3JpdGljX21vZGUgPT09IFwiYWlcIikge1xuICAgICAgICAgICAgbmV3IFNldHRpbmcoY29udGFpbmVyRWwpXG4gICAgICAgICAgICAgICAgLnNldE5hbWUoXCJDcml0aWMgcHJvbXB0XCIpXG4gICAgICAgICAgICAgICAgLnNldERlc2MoXCJQcm9tcHQgZm9yIEFJIGNvbnRlbnQgcmV2aWV3LlwiKVxuICAgICAgICAgICAgICAgIC5hZGRUZXh0QXJlYSh0ZXh0ID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdGV4dC5zZXRWYWx1ZSh0aGlzLnBsdWdpbi5zZXR0aW5ncy5wcm9tcHRfY3JpdGljKVxuICAgICAgICAgICAgICAgICAgICAgICAgLm9uQ2hhbmdlKGFzeW5jICh2YWx1ZSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLnByb21wdF9jcml0aWMgPSB2YWx1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB0ZXh0LmlucHV0RWwuYWRkQ2xhc3MoXCJrZy10ZXh0YXJlYS10YWxsXCIpOyAvLyBcdTRGN0ZcdTc1MjggQ1NTIFx1N0M3QlxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICBuZXcgU2V0dGluZyhjb250YWluZXJFbClcbiAgICAgICAgICAgIC5zZXROYW1lKFwiUmV2aXNlciBwcm9tcHRcIilcbiAgICAgICAgICAgIC5zZXREZXNjKFwiUHJvbXB0IGZvciByZXZpc2luZyByZWplY3RlZCBjb250ZW50LlwiKVxuICAgICAgICAgICAgLmFkZFRleHRBcmVhKHRleHQgPT4ge1xuICAgICAgICAgICAgICAgIHRleHQuc2V0VmFsdWUodGhpcy5wbHVnaW4uc2V0dGluZ3MucHJvbXB0X3JldmlzZXIpXG4gICAgICAgICAgICAgICAgICAgIC5vbkNoYW5nZShhc3luYyAodmFsdWUpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLnByb21wdF9yZXZpc2VyID0gdmFsdWU7XG4gICAgICAgICAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgdGV4dC5pbnB1dEVsLmFkZENsYXNzKFwia2ctdGV4dGFyZWEtdGFsbFwiKTsgLy8gXHU0RjdGXHU3NTI4IENTUyBcdTdDN0JcbiAgICAgICAgICAgIH0pO1xuICAgIH1cbn0iLCAiLy8gc3JjL1F1ZXVlTW9kYWwudHNcblxuaW1wb3J0IHsgQXBwLCBNb2RhbCwgU2V0dGluZyB9IGZyb20gJ29ic2lkaWFuJztcbmltcG9ydCBLbm93bGVkZ2VHcmFwaFBsdWdpbiBmcm9tICcuL21haW4nO1xuaW1wb3J0IHsgVGFza0RhdGEgfSBmcm9tICcuL3R5cGVzJztcblxuZXhwb3J0IGNsYXNzIFF1ZXVlTWFuYWdlbWVudE1vZGFsIGV4dGVuZHMgTW9kYWwge1xuICAgIHBsdWdpbjogS25vd2xlZGdlR3JhcGhQbHVnaW47XG5cbiAgICAvLyBcdTc1MjhcdTRFOEVcdTRGRERcdTVCNThcdTY0MUNcdTdEMjJcdThCQ0RcbiAgICBwcml2YXRlIHNlYXJjaFRlcm1zOiB7IFtrZXk6IHN0cmluZ106IHN0cmluZyB9ID0ge1xuICAgICAgICBnZW46ICcnLFxuICAgICAgICByZXY6ICcnLFxuICAgICAgICByZXA6ICcnLFxuICAgICAgICBkaXM6ICcnLFxuICAgIH07XG4gICAgXG4gICAgLy8gXHU5RUQ4XHU4QkE0XHU1MTY4XHU5MEU4XHU2Mjk4XHU1M0UwXG4gICAgcHJpdmF0ZSBjb2xsYXBzZVN0YXRlczogeyBba2V5OiBzdHJpbmddOiBib29sZWFuIH0gPSB7XG4gICAgICAgIGdlbjogZmFsc2UsXG4gICAgICAgIHJldjogZmFsc2UsXG4gICAgICAgIHJlcDogZmFsc2UsXG4gICAgICAgIGRpczogZmFsc2UsXG4gICAgfTtcblxuICAgIC8vIFx1NzUyOFx1NEU4RVx1N0VEMVx1NUI5QVx1NzY4NFx1NTIzN1x1NjVCMFx1NTFGRFx1NjU3MFxuICAgIHByaXZhdGUgcmVmcmVzaENvbnRlbnQ6ICgpID0+IHZvaWQ7XG5cbiAgICBjb25zdHJ1Y3RvcihhcHA6IEFwcCwgcGx1Z2luOiBLbm93bGVkZ2VHcmFwaFBsdWdpbikge1xuICAgICAgICBzdXBlcihhcHApO1xuICAgICAgICB0aGlzLnBsdWdpbiA9IHBsdWdpbjtcbiAgICAgICAgLy8gXHU1MjFCXHU1RUZBXHU0RTAwXHU0RTJBXHU3RUQxXHU1QjlBXHU3Njg0XHU1MUZEXHU2NTcwXHU1RjE1XHU3NTI4XHVGRjBDXHU3NTI4XHU0RThFXHU1MjM3XHU2NUIwXG4gICAgICAgIHRoaXMucmVmcmVzaENvbnRlbnQgPSB0aGlzLm9uT3Blbi5iaW5kKHRoaXMpO1xuICAgIH1cblxuICAgIG9uT3BlbigpIHtcbiAgICAgICAgY29uc3QgeyBjb250ZW50RWwgfSA9IHRoaXM7XG5cbiAgICAgICAgLy8gXHU0RTNBXHU0RTg2XHU1Qjg5XHU1MTY4XHVGRjBDXHU1MTQ4XHU2Q0U4XHU5NTAwXHU2NUU3XHU3Njg0XHU3NkQxXHU1NDJDXHU1NjY4XG4gICAgICAgIHRoaXMuYXBwLndvcmtzcGFjZS5vZmYoXCJrZy1kYXRhLXVwZGF0ZWRcIiwgdGhpcy5yZWZyZXNoQ29udGVudCk7XG5cbiAgICAgICAgY29udGVudEVsLmVtcHR5KCk7XG4gICAgICAgIGNvbnRlbnRFbC5hZGRDbGFzcygna2ctbW9kYWwnKTsgXG4gICAgICAgIGNvbnRlbnRFbC5jcmVhdGVFbCgnaDInLCB7IHRleHQ6ICdRdWV1ZSBtYW5hZ2VtZW50IGRhc2hib2FyZCcgfSk7IC8vIFVJIFRleHQ6IFNlbnRlbmNlIGNhc2VcblxuICAgICAgICBjb25zdCBzdGF0dXMgPSB0aGlzLnBsdWdpbi5kYXRhLnN0YXR1cztcbiAgICAgICAgY29uc3Qgc3RhdHVzVGV4dCA9IGBTdGF0dXM6ICR7c3RhdHVzLnRvVXBwZXJDYXNlKCl9IHwgJHt0aGlzLnBsdWdpbi5zdGF0dXNCYXJFbC5nZXRUZXh0KCl9YDtcbiAgICAgICAgXG4gICAgICAgIC8vIDEuIFx1NzJCNlx1NjAwMVx1NTQ4Q1x1NTQyRlx1NTA1Q1x1NjMwOVx1OTRBRVxuICAgICAgICBuZXcgU2V0dGluZyhjb250ZW50RWwpXG4gICAgICAgICAgICAuc2V0TmFtZShzdGF0dXMgPT09ICdydW5uaW5nJyA/ICdFbmdpbmUgcnVubmluZycgOiAnRW5naW5lIHBhdXNlZCcpIC8vIFVJIFRleHQ6IFNlbnRlbmNlIGNhc2VcbiAgICAgICAgICAgIC5zZXREZXNjKHN0YXR1c1RleHQpXG4gICAgICAgICAgICAuYWRkQnV0dG9uKGJ1dHRvbiA9PiBidXR0b25cbiAgICAgICAgICAgICAgICAuc2V0QnV0dG9uVGV4dChzdGF0dXMgPT09ICdydW5uaW5nJyA/ICdQYXVzZSBlbmdpbmUnIDogJ1N0YXJ0IGVuZ2luZScpIC8vIFVJIFRleHQ6IFNlbnRlbmNlIGNhc2VcbiAgICAgICAgICAgICAgICAuc2V0Q3RhKHN0YXR1cyAhPT0gJ3J1bm5pbmcnKVxuICAgICAgICAgICAgICAgIC5vbkNsaWNrKCgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wbHVnaW4uZW5naW5lLnRvZ2dsZUVuZ2luZVN0YXRlKCk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMub25PcGVuKCk7IC8vIFx1NTIzN1x1NjVCMCBNb2RhbCBcdTUxODVcdTkwRThcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgKTtcblxuICAgICAgICAvLyAyLiBcdTZFMzJcdTY3RDNcdTU2REJcdTRFMkFcdTk2MUZcdTUyMTdcbiAgICAgICAgdGhpcy5yZW5kZXJRdWV1ZVNlY3Rpb24oXG4gICAgICAgICAgICBjb250ZW50RWwsIFxuICAgICAgICAgICAgJ2dlbicsIFxuICAgICAgICAgICAgJ1BlbmRpbmcgZ2VuZXJhdGlvbicsIC8vIFVJIFRleHQ6IFNlbnRlbmNlIGNhc2VcbiAgICAgICAgICAgIHRoaXMucGx1Z2luLmRhdGEuZ2VuZXJhdGlvblF1ZXVlLFxuICAgICAgICAgICAgdGhpcy5yZW5kZXJHZW5lcmF0aW9uSXRlbS5iaW5kKHRoaXMpXG4gICAgICAgICk7XG4gICAgICAgIFxuICAgICAgICB0aGlzLnJlbmRlclF1ZXVlU2VjdGlvbihcbiAgICAgICAgICAgIGNvbnRlbnRFbCxcbiAgICAgICAgICAgICdyZXYnLFxuICAgICAgICAgICAgJ1BlbmRpbmcgcmV2aWV3JywgLy8gVUkgVGV4dDogU2VudGVuY2UgY2FzZVxuICAgICAgICAgICAgdGhpcy5wbHVnaW4uZGF0YS5yZXZpZXdRdWV1ZSxcbiAgICAgICAgICAgIHRoaXMucmVuZGVyUmV2aWV3SXRlbS5iaW5kKHRoaXMpXG4gICAgICAgICk7XG4gICAgICAgIFxuICAgICAgICB0aGlzLnJlbmRlclF1ZXVlU2VjdGlvbihcbiAgICAgICAgICAgIGNvbnRlbnRFbCxcbiAgICAgICAgICAgICdyZXAnLFxuICAgICAgICAgICAgJ1BlbmRpbmcgcmV2aXNpb24nLCAvLyBVSSBUZXh0OiBTZW50ZW5jZSBjYXNlXG4gICAgICAgICAgICB0aGlzLnBsdWdpbi5kYXRhLnJldmlzaW9uUXVldWUsXG4gICAgICAgICAgICB0aGlzLnJlbmRlclJldmlzaW9uSXRlbS5iaW5kKHRoaXMpXG4gICAgICAgICk7XG4gICAgICAgIFxuICAgICAgICB0aGlzLnJlbmRlclF1ZXVlU2VjdGlvbihcbiAgICAgICAgICAgIGNvbnRlbnRFbCxcbiAgICAgICAgICAgICdkaXMnLFxuICAgICAgICAgICAgJ0Rpc2NhcmRlZCBwaWxlJywgLy8gVUkgVGV4dDogU2VudGVuY2UgY2FzZVxuICAgICAgICAgICAgdGhpcy5wbHVnaW4uZGF0YS5kaXNjYXJkZWRQaWxlLFxuICAgICAgICAgICAgdGhpcy5yZW5kZXJEaXNjYXJkZWRJdGVtLmJpbmQodGhpcylcbiAgICAgICAgKTtcblxuICAgICAgICAvLyBcdTU3Mjggb25PcGVuIFx1NzY4NFx1NjcyQlx1NUMzRSwgXHU2Q0U4XHU1MThDXHU2NUIwXHU3Njg0XHU3NkQxXHU1NDJDXHU1NjY4XG4gICAgICAgIHRoaXMuYXBwLndvcmtzcGFjZS5vbihcImtnLWRhdGEtdXBkYXRlZFwiLCB0aGlzLnJlZnJlc2hDb250ZW50KTtcbiAgICB9XG5cbiAgICBvbkNsb3NlKCkge1xuICAgICAgICBjb25zdCB7IGNvbnRlbnRFbCB9ID0gdGhpcztcbiAgICAgICAgY29udGVudEVsLmVtcHR5KCk7XG4gICAgICAgIFxuICAgICAgICAvLyBcdTU3MjggTW9kYWwgXHU1MTczXHU5NUVEXHU2NUY2LCBcdTVGQzVcdTk4N0JcdTZDRThcdTk1MDBcdTc2RDFcdTU0MkNcdTU2NjhcbiAgICAgICAgdGhpcy5hcHAud29ya3NwYWNlLm9mZihcImtnLWRhdGEtdXBkYXRlZFwiLCB0aGlzLnJlZnJlc2hDb250ZW50KTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBcdTZFMzJcdTY3RDNcdTRFMDBcdTRFMkFcdTk2MUZcdTUyMTdcdTUzM0FcdTU3REYgKFx1NUUyNlx1NjQxQ1x1N0QyMlx1NTQ4Q1x1NUM1NVx1NUYwMC9cdTYyOThcdTUzRTApXG4gICAgICovXG4gICAgcHJpdmF0ZSByZW5kZXJRdWV1ZVNlY3Rpb24oXG4gICAgICAgIGNvbnRhaW5lckVsOiBIVE1MRWxlbWVudCxcbiAgICAgICAga2V5OiAnZ2VuJyB8ICdyZXYnIHwgJ3JlcCcgfCAnZGlzJyxcbiAgICAgICAgdGl0bGU6IHN0cmluZyxcbiAgICAgICAgZGF0YTogKHN0cmluZyB8IFRhc2tEYXRhKVtdLFxuICAgICAgICByZW5kZXJGbjogKGNvbnRhaW5lcjogSFRNTEVsZW1lbnQsIGl0ZW06IHN0cmluZyB8IFRhc2tEYXRhLCBpbmRleDogbnVtYmVyKSA9PiB2b2lkXG4gICAgKSB7XG4gICAgICAgIGNvbnN0IGRpc3BsYXlMaW1pdCA9IDEwMDsgLy8gXHU2QkNGXHU2QjIxXHU2NzAwXHU1OTFBXHU2RTMyXHU2N0QzIDEwMCBcdTk4NzlcbiAgICAgICAgY29uc3QgZmlsdGVyID0gdGhpcy5zZWFyY2hUZXJtc1trZXldO1xuICAgICAgICBcbiAgICAgICAgLy8gMS4gXHU2MjY3XHU4ODRDXHU4RkM3XHU2RUU0XG4gICAgICAgIGNvbnN0IGZpbHRlcmVkRGF0YSA9IGRhdGEuZmlsdGVyKGl0ZW0gPT4ge1xuICAgICAgICAgICAgaWYgKCFmaWx0ZXIpIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgY29uc3QgbmVlZGxlID0gZmlsdGVyLnRvTG93ZXJDYXNlKCk7XG4gICAgICAgICAgICBpZiAodHlwZW9mIGl0ZW0gPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGl0ZW0udG9Mb3dlckNhc2UoKS5pbmNsdWRlcyhuZWVkbGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIChpdGVtIGFzIFRhc2tEYXRhKS5pZGVhLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMobmVlZGxlKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgY29uc3QgdG90YWwgPSBkYXRhLmxlbmd0aDtcbiAgICAgICAgY29uc3QgZmlsdGVyZWRUb3RhbCA9IGZpbHRlcmVkRGF0YS5sZW5ndGg7XG4gICAgICAgIGNvbnN0IHRpdGxlVGV4dCA9IGAke3RpdGxlfSAoJHtmaWx0ZXJlZFRvdGFsfSR7dG90YWwgIT09IGZpbHRlcmVkVG90YWwgPyAnIC8gJyArIHRvdGFsIDogJyd9IGl0ZW1zKWA7XG5cbiAgICAgICAgLy8gMi4gXHU0RjdGXHU3NTI4IDxkZXRhaWxzPiBcdTUxNDNcdTdEMjBcdTUyMUJcdTVFRkFcdTUzRUZcdTYyOThcdTUzRTBcdTUzM0FcdTU3REZcbiAgICAgICAgY29uc3QgZGV0YWlscyA9IGNvbnRhaW5lckVsLmNyZWF0ZUVsKCdkZXRhaWxzJyk7XG4gICAgICAgIGRldGFpbHMub3BlbiA9IHRoaXMuY29sbGFwc2VTdGF0ZXNba2V5XTsgLy8gXHU4QkJFXHU3RjZFXHU1MjFEXHU1OUNCXHU1QzU1XHU1RjAwL1x1NjI5OFx1NTNFMFx1NzJCNlx1NjAwMVxuXG4gICAgICAgIC8vIDMuIFx1NjgwN1x1OTg5OCAoXHU0RjdGXHU3NTI4IENTUyBcdTdDN0IpXG4gICAgICAgIGNvbnN0IHN1bW1hcnkgPSBkZXRhaWxzLmNyZWF0ZUVsKCdzdW1tYXJ5JywgeyB0ZXh0OiB0aXRsZVRleHQgfSk7XG4gICAgICAgIHN1bW1hcnkuYWRkQ2xhc3MoJ2tnLW1vZGFsLXN1bW1hcnknKTtcblxuICAgICAgICAvLyA0LiBcdTc2RDFcdTU0MkNcdTcwQjlcdTUxRkJcdTRFOEJcdTRFRjZcdUZGMENcdTRGRERcdTVCNThcdTcyQjZcdTYwMDFcbiAgICAgICAgZGV0YWlscy5hZGRFdmVudExpc3RlbmVyKCd0b2dnbGUnLCAoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLmNvbGxhcHNlU3RhdGVzW2tleV0gPSBkZXRhaWxzLm9wZW47XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIDUuIFx1NjQxQ1x1N0QyMlx1Njg0NiAoXHU2NTNFXHU1NzI4IGRldGFpbHMgXHU1MTg1XHU5MEU4KVxuICAgICAgICBuZXcgU2V0dGluZyhkZXRhaWxzKVxuICAgICAgICAgICAgLnNldERlc2MoYFNlYXJjaCAke3RpdGxlfS4uLmApIC8vIFVJIFRleHQ6IFNlbnRlbmNlIGNhc2VcbiAgICAgICAgICAgIC5hZGRUZXh0KHRleHQgPT4ge1xuICAgICAgICAgICAgICAgIHRleHQuc2V0UGxhY2Vob2xkZXIoJ0VudGVyIGtleXdvcmRzLi4uJylcbiAgICAgICAgICAgICAgICAgICAgLnNldFZhbHVlKHRoaXMuc2VhcmNoVGVybXNba2V5XSlcbiAgICAgICAgICAgICAgICAgICAgLm9uQ2hhbmdlKHZhbHVlID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2VhcmNoVGVybXNba2V5XSA9IHZhbHVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5vbk9wZW4oKTsgLy8gXHU1MjM3XHU2NUIwIE1vZGFsXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gNi4gXHU2MjJBXHU2NUFEXHU2NTcwXHU2MzZFXHU1RTc2XHU2RTMyXHU2N0QzXG4gICAgICAgIGNvbnN0IHRydW5jYXRlZERhdGEgPSBmaWx0ZXJlZERhdGEuc2xpY2UoMCwgZGlzcGxheUxpbWl0KTtcbiAgICAgICAgXG4gICAgICAgIGlmICh0cnVuY2F0ZWREYXRhLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgY29uc3QgZGVzYyA9IGRldGFpbHMuY3JlYXRlRWwoJ3AnLCB7IHRleHQ6ICdRdWV1ZSBpcyBlbXB0eSBvciBubyBtYXRjaGVzIGZvdW5kLicsIGNsczogJ3NldHRpbmctaXRlbS1kZXNjcmlwdGlvbicgfSk7XG4gICAgICAgICAgICBkZXNjLmFkZENsYXNzKCdrZy1xdWV1ZS1kZXNjLWVtcHR5Jyk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIC8vIDcuIFx1NTIxN1x1ODg2OFx1NUJCOVx1NTY2OCAoXHU2NTNFXHU1NzI4IGRldGFpbHMgXHU1MTg1XHU5MEU4XHVGRjBDXHU0RjdGXHU3NTI4IENTUyBcdTdDN0IpXG4gICAgICAgIGNvbnN0IGxpc3RDb250YWluZXIgPSBkZXRhaWxzLmNyZWF0ZURpdigna2ctbGlzdC1jb250YWluZXInKTtcblxuICAgICAgICB0cnVuY2F0ZWREYXRhLmZvckVhY2goKGl0ZW0sIGluZGV4KSA9PiB7XG4gICAgICAgICAgICByZW5kZXJGbihsaXN0Q29udGFpbmVyLCBpdGVtLCBpbmRleCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIDguIFx1NjYzRVx1NzkzQVx1NjIyQVx1NjVBRFx1NjNEMFx1NzkzQVxuICAgICAgICBpZiAoZmlsdGVyZWREYXRhLmxlbmd0aCA+IGRpc3BsYXlMaW1pdCkge1xuICAgICAgICAgICAgY29uc3QgdHJ1bmNhdGVkSW5mbyA9IGRldGFpbHMuY3JlYXRlRWwoJ3AnLCB7IFxuICAgICAgICAgICAgICAgIHRleHQ6IGAuLi4gc2hvd2luZyBmaXJzdCAke2Rpc3BsYXlMaW1pdH0gaXRlbXMgKHRvdGFsICR7ZmlsdGVyZWREYXRhLmxlbmd0aH0pLCB1c2Ugc2VhcmNoIHRvIGZpbmQgbW9yZS5gLFxuICAgICAgICAgICAgICAgIGNsczogJ3NldHRpbmctaXRlbS1kZXNjcmlwdGlvbidcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgdHJ1bmNhdGVkSW5mby5hZGRDbGFzcygna2ctcXVldWUtZGVzYy10cnVuY2F0ZWQnKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8vIC0tLSBcdTUzNTVcdTk4NzlcdTZFMzJcdTY3RDNcdTUxRkRcdTY1NzAgLS0tXG5cbiAgICBwcml2YXRlIHJlbmRlckdlbmVyYXRpb25JdGVtKGNvbnRhaW5lcjogSFRNTEVsZW1lbnQsIGl0ZW06IHN0cmluZyB8IFRhc2tEYXRhKSB7XG4gICAgICAgIC8vIGl0ZW0gXHU1NzI4IGdlbmVyYXRpb24gcXVldWUgXHU0RTJEXHU5MDFBXHU1RTM4XHU2NjJGIHN0cmluZ1xuICAgICAgICBjb25zdCBpdGVtTmFtZSA9IHR5cGVvZiBpdGVtID09PSAnc3RyaW5nJyA/IGl0ZW0gOiAoaXRlbSBhcyBUYXNrRGF0YSkuaWRlYTtcbiAgICAgICAgXG4gICAgICAgIG5ldyBTZXR0aW5nKGNvbnRhaW5lcilcbiAgICAgICAgICAgIC5zZXROYW1lKGl0ZW1OYW1lKVxuICAgICAgICAgICAgLmFkZEJ1dHRvbihidG4gPT4gYnRuXG4gICAgICAgICAgICAgICAgLnNldEljb24oJ3RyYXNoJylcbiAgICAgICAgICAgICAgICAuc2V0VG9vbHRpcCgnRGVsZXRlIGNvbmNlcHQnKVxuICAgICAgICAgICAgICAgIC5vbkNsaWNrKGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgcXVldWUgPSB0aGlzLnBsdWdpbi5kYXRhLmdlbmVyYXRpb25RdWV1ZTtcbiAgICAgICAgICAgICAgICAgICAgLy8gXHU0RkVFXHU1OTBEXHVGRjFBXHU3OUZCXHU5NjY0XHU0RTBEXHU1RkM1XHU4OTgxXHU3Njg0XHU2NUFEXHU4QTAwXHVGRjBDZ2VuZXJhdGlvblF1ZXVlIFx1NjYyRiBzdHJpbmdbXVxuICAgICAgICAgICAgICAgICAgICBjb25zdCBpbmRleCA9IHF1ZXVlLmluZGV4T2YoaXRlbU5hbWUpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoaW5kZXggPiAtMSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcXVldWUuc3BsaWNlKGluZGV4LCAxKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVQbHVnaW5EYXRhKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnBsdWdpbi5lbmdpbmUudXBkYXRlU3RhdHVzQmFyKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm9uT3BlbigpOyAvLyBcdTUyMzdcdTY1QjBcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pIC8vIFByb21pc2UgaGFuZGxpbmcgaXMgaW1wbGljaXQgaW4gYXN5bmMgb25DbGljaywgZ2VuZXJhbGx5IGFjY2VwdGVkIGluIE9ic2lkaWFuXG4gICAgICAgICAgICApO1xuICAgIH1cblxuICAgIHByaXZhdGUgcmVuZGVyUmV2aWV3SXRlbShjb250YWluZXI6IEhUTUxFbGVtZW50LCBpdGVtOiBzdHJpbmcgfCBUYXNrRGF0YSkge1xuICAgICAgICBjb25zdCB0YXNrID0gaXRlbSBhcyBUYXNrRGF0YTtcbiAgICAgICAgbmV3IFNldHRpbmcoY29udGFpbmVyKVxuICAgICAgICAgICAgLnNldE5hbWUoYFtSZXZpZXddICR7dGFzay5pZGVhfWApXG4gICAgICAgICAgICAuYWRkQnV0dG9uKGJ0biA9PiBidG5cbiAgICAgICAgICAgICAgICAuc2V0SWNvbigndHJhc2gnKVxuICAgICAgICAgICAgICAgIC5zZXRUb29sdGlwKCdEaXNjYXJkIHRhc2snKVxuICAgICAgICAgICAgICAgIC5vbkNsaWNrKGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wbHVnaW4uZGF0YS5yZXZpZXdRdWV1ZS5zcGxpY2UodGhpcy5wbHVnaW4uZGF0YS5yZXZpZXdRdWV1ZS5pbmRleE9mKHRhc2spLCAxKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wbHVnaW4uZGF0YS5kaXNjYXJkZWRQaWxlLnB1c2godGFzayk7XG4gICAgICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVQbHVnaW5EYXRhKCk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucGx1Z2luLmVuZ2luZS51cGRhdGVTdGF0dXNCYXIoKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5vbk9wZW4oKTtcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgKTtcbiAgICB9XG4gICAgXG4gICAgcHJpdmF0ZSByZW5kZXJSZXZpc2lvbkl0ZW0oY29udGFpbmVyOiBIVE1MRWxlbWVudCwgaXRlbTogc3RyaW5nIHwgVGFza0RhdGEpIHtcbiAgICAgICAgY29uc3QgdGFzayA9IGl0ZW0gYXMgVGFza0RhdGE7XG4gICAgICAgIG5ldyBTZXR0aW5nKGNvbnRhaW5lcilcbiAgICAgICAgICAgIC5zZXROYW1lKGBbUmV2aXNpb25dICR7dGFzay5pZGVhfWApXG4gICAgICAgICAgICAuc2V0RGVzYyhgUmVhc29uOiAke3Rhc2sucmVhc29uIHx8ICdVbmtub3duJ31gKVxuICAgICAgICAgICAgLmFkZEJ1dHRvbihidG4gPT4gYnRuXG4gICAgICAgICAgICAgICAgLnNldEljb24oJ3RyYXNoJylcbiAgICAgICAgICAgICAgICAuc2V0VG9vbHRpcCgnRGlzY2FyZCB0YXNrJylcbiAgICAgICAgICAgICAgICAub25DbGljayhhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucGx1Z2luLmRhdGEucmV2aXNpb25RdWV1ZS5zcGxpY2UodGhpcy5wbHVnaW4uZGF0YS5yZXZpc2lvblF1ZXVlLmluZGV4T2YodGFzayksIDEpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnBsdWdpbi5kYXRhLmRpc2NhcmRlZFBpbGUucHVzaCh0YXNrKTtcbiAgICAgICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVBsdWdpbkRhdGEoKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wbHVnaW4uZW5naW5lLnVwZGF0ZVN0YXR1c0JhcigpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLm9uT3BlbigpO1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICApO1xuICAgIH1cbiAgICBcbiAgICBwcml2YXRlIHJlbmRlckRpc2NhcmRlZEl0ZW0oY29udGFpbmVyOiBIVE1MRWxlbWVudCwgaXRlbTogc3RyaW5nIHwgVGFza0RhdGEpIHtcbiAgICAgICAgY29uc3QgdGFzayA9IGl0ZW0gYXMgVGFza0RhdGE7XG4gICAgICAgIG5ldyBTZXR0aW5nKGNvbnRhaW5lcilcbiAgICAgICAgICAgIC5zZXROYW1lKGBbRGlzY2FyZGVkXSAke3Rhc2suaWRlYX1gKVxuICAgICAgICAgICAgLnNldERlc2MoYExhc3QgcmVhc29uOiAke3Rhc2sucmVhc29uIHx8ICdVbmtub3duJ31gKVxuICAgICAgICAgICAgLmFkZEJ1dHRvbihidG4gPT4gYnRuXG4gICAgICAgICAgICAgICAgLnNldEljb24oJ3JlZnJlc2gtY3cnKVxuICAgICAgICAgICAgICAgIC5zZXRUb29sdGlwKCdSZS1xdWV1ZSAoR2VuZXJhdGlvbiknKVxuICAgICAgICAgICAgICAgIC5vbkNsaWNrKGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wbHVnaW4uZGF0YS5kaXNjYXJkZWRQaWxlLnNwbGljZSh0aGlzLnBsdWdpbi5kYXRhLmRpc2NhcmRlZFBpbGUuaW5kZXhPZih0YXNrKSwgMSk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucGx1Z2luLmVuZ2luZS5hZGRDb25jZXB0c1RvUXVldWUoW3Rhc2suaWRlYV0pOyAvLyBcdTRGN0ZcdTc1MjggZW5naW5lIFx1NzY4NFx1NjVCOVx1NkNENVxuICAgICAgICAgICAgICAgICAgICB0aGlzLm9uT3BlbigpO1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICApO1xuICAgIH1cbn0iLCAiLy8gc3JjL2VuZ2luZS50c1xuXG5pbXBvcnQgeyBOb3RpY2UsIFRGaWxlLCBURm9sZGVyLCBub3JtYWxpemVQYXRoLCBBcHAgfSBmcm9tIFwib2JzaWRpYW5cIjtcbmltcG9ydCBLbm93bGVkZ2VHcmFwaFBsdWdpbiBmcm9tIFwiLi9tYWluXCI7XG5pbXBvcnQgeyBBUElIYW5kbGVyLCBBbGxNb2RlbHNGYWlsZWRFcnJvciB9IGZyb20gXCIuL2FwaUhhbmRsZXJcIjtcbmltcG9ydCB7IENyaXRpYyB9IGZyb20gXCIuL2NyaXRpY1wiO1xuaW1wb3J0IHsgUmV2aXNlciB9IGZyb20gXCIuL3JldmlzZXJcIjtcbmltcG9ydCB7IHNhbml0aXplRmlsZW5hbWUsIGV4dHJhY3ROZXdJZGVhcywgY2xlYW5NYXJrZG93bk91dHB1dCB9IGZyb20gXCIuL3V0aWxzXCI7XG5pbXBvcnQgeyBUYXNrRGF0YSB9IGZyb20gXCIuL3R5cGVzXCI7XG5cbmV4cG9ydCBjbGFzcyBFbmdpbmUge1xuICAgIHBsdWdpbjogS25vd2xlZGdlR3JhcGhQbHVnaW47XG4gICAgYXBwOiBBcHA7XG4gICAgYXBpSGFuZGxlcjogQVBJSGFuZGxlcjtcbiAgICBjcml0aWM6IENyaXRpYztcbiAgICByZXZpc2VyOiBSZXZpc2VyO1xuICAgIHByaXZhdGUgaXNSdW5uaW5nOiBib29sZWFuID0gZmFsc2U7XG4gICAgcHJpdmF0ZSB0aW1lcklkOiBOb2RlSlMuVGltZW91dCB8IG51bGwgPSBudWxsO1xuXG4gICAgY29uc3RydWN0b3IocGx1Z2luOiBLbm93bGVkZ2VHcmFwaFBsdWdpbikge1xuICAgICAgICB0aGlzLnBsdWdpbiA9IHBsdWdpbjtcbiAgICAgICAgdGhpcy5hcHAgPSBwbHVnaW4uYXBwO1xuICAgICAgICB0aGlzLmFwaUhhbmRsZXIgPSBuZXcgQVBJSGFuZGxlcihwbHVnaW4pO1xuICAgICAgICB0aGlzLmNyaXRpYyA9IG5ldyBDcml0aWMocGx1Z2luKTtcbiAgICAgICAgdGhpcy5yZXZpc2VyID0gbmV3IFJldmlzZXIocGx1Z2luKTtcbiAgICB9XG5cbiAgICAvLyAtLS0gUHVibGljIENvbnRyb2xzIC0tLVxuICAgIHB1YmxpYyB0b2dnbGVFbmdpbmVTdGF0ZSgpOiB2b2lkIHtcbiAgICAgICAgaWYgKHRoaXMuaXNSdW5uaW5nKSB7XG4gICAgICAgICAgICB0aGlzLnN0b3AoKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuc3RhcnQoKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHB1YmxpYyBhZGRDb25jZXB0VG9RdWV1ZShjb25jZXB0OiBzdHJpbmcpOiBib29sZWFuIHtcbiAgICAgICAgY29uc3QgYWRkZWQgPSB0aGlzLmFkZENvbmNlcHRzVG9RdWV1ZShbY29uY2VwdF0pO1xuICAgICAgICBpZiAoYWRkZWQgPiAwKSB7XG4gICAgICAgICAgICBuZXcgTm90aWNlKGAnJHtjb25jZXB0fScgYWRkZWQgdG8gcXVldWUuYCk7XG4gICAgICAgICAgICB0aGlzLnVwZGF0ZVN0YXR1c0JhcigpO1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgbmV3IE5vdGljZShgJyR7Y29uY2VwdH0nIGFscmVhZHkgZXhpc3RzIG9yIHF1ZXVlZC5gKTtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIHB1YmxpYyBhZGRDb25jZXB0c1RvUXVldWUoY29uY2VwdHM6IHN0cmluZ1tdKTogbnVtYmVyIHtcbiAgICAgICAgY29uc3QgY3VycmVudFF1ZXVlID0gbmV3IFNldCh0aGlzLnBsdWdpbi5kYXRhLmdlbmVyYXRpb25RdWV1ZSk7XG4gICAgICAgIGNvbnN0IGV4aXN0aW5nRmlsZXMgPSBuZXcgU2V0KHRoaXMuYXBwLnZhdWx0LmdldE1hcmtkb3duRmlsZXMoKS5tYXAoZiA9PiBmLmJhc2VuYW1lKSk7XG5cbiAgICAgICAgbGV0IGFkZGVkQ291bnQgPSAwO1xuICAgICAgICBmb3IgKGNvbnN0IGNvbmNlcHQgb2YgY29uY2VwdHMpIHtcbiAgICAgICAgICAgIGNvbnN0IHNhbml0aXplZCA9IHNhbml0aXplRmlsZW5hbWUoY29uY2VwdCk7XG4gICAgICAgICAgICBpZiAoIWN1cnJlbnRRdWV1ZS5oYXMoY29uY2VwdCkgJiYgIWV4aXN0aW5nRmlsZXMuaGFzKHNhbml0aXplZCkpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnBsdWdpbi5kYXRhLmdlbmVyYXRpb25RdWV1ZS5wdXNoKGNvbmNlcHQpO1xuICAgICAgICAgICAgICAgIGN1cnJlbnRRdWV1ZS5hZGQoY29uY2VwdCk7IFxuICAgICAgICAgICAgICAgIGFkZGVkQ291bnQrKztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChhZGRlZENvdW50ID4gMCkge1xuICAgICAgICAgICAgdGhpcy5wbHVnaW4uc2F2ZVBsdWdpbkRhdGEoKTsgXG4gICAgICAgICAgICB0aGlzLnVwZGF0ZVN0YXR1c0JhcigpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBhZGRlZENvdW50O1xuICAgIH1cblxuICAgIC8vIC0tLSBDb3JlIExvb3AgLS0tXG4gICAgXG4gICAgLy8gXHU0RkVFXHU2NTM5XHVGRjFBXHU1M0JCXHU5NjY0IGFzeW5jXHVGRjBDXHU1OTA0XHU3NDA2IHRpY2sgXHU3Njg0IHByb21pc2VcbiAgICBwcml2YXRlIHN0YXJ0KCk6IHZvaWQge1xuICAgICAgICBpZiAodGhpcy5pc1J1bm5pbmcpIHJldHVybjtcbiAgICAgICAgdGhpcy5pc1J1bm5pbmcgPSB0cnVlO1xuICAgICAgICB0aGlzLnBsdWdpbi5kYXRhLnN0YXR1cyA9IFwicnVubmluZ1wiO1xuICAgICAgICBuZXcgTm90aWNlKFwiS25vd2xlZGdlIEdyYXBoIEVuZ2luZSBzdGFydGVkIVwiKTtcbiAgICAgICAgdGhpcy51cGRhdGVTdGF0dXNCYXIoKTtcbiAgICAgICAgXG4gICAgICAgIC8vIFx1NjYzRVx1NUYwRlx1NTkwNFx1NzQwNiBwcm9taXNlXG4gICAgICAgIHRoaXMudGljaygpLmNhdGNoKGVycm9yID0+IHtcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoXCJUaWNrIGVycm9yIGR1cmluZyBzdGFydDpcIiwgZXJyb3IpO1xuICAgICAgICAgICAgdGhpcy5zdG9wKCk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIHByaXZhdGUgc3RvcCgpOiB2b2lkIHtcbiAgICAgICAgaWYgKCF0aGlzLmlzUnVubmluZykgcmV0dXJuO1xuICAgICAgICB0aGlzLmlzUnVubmluZyA9IGZhbHNlO1xuICAgICAgICB0aGlzLnBsdWdpbi5kYXRhLnN0YXR1cyA9IFwicGF1c2VkXCI7XG4gICAgICAgIGlmICh0aGlzLnRpbWVySWQpIHtcbiAgICAgICAgICAgIGNsZWFyVGltZW91dCh0aGlzLnRpbWVySWQpO1xuICAgICAgICAgICAgdGhpcy50aW1lcklkID0gbnVsbDtcbiAgICAgICAgfVxuICAgICAgICBuZXcgTm90aWNlKFwiS25vd2xlZGdlIEdyYXBoIEVuZ2luZSBwYXVzZWQuXCIpO1xuICAgICAgICB0aGlzLnVwZGF0ZVN0YXR1c0JhcigpO1xuICAgICAgICB0aGlzLnBsdWdpbi5zYXZlUGx1Z2luRGF0YSgpOyBcbiAgICB9XG5cbiAgICBwcml2YXRlIHNjaGVkdWxlTmV4dFRpY2soKTogdm9pZCB7XG4gICAgICAgIGlmICghdGhpcy5pc1J1bm5pbmcpIHJldHVybjtcbiAgICAgICAgY29uc3QgZGVsYXkgPSB0aGlzLnBsdWdpbi5zZXR0aW5ncy5yZXF1ZXN0X2RlbGF5ICogMTAwMDtcbiAgICAgICAgdGhpcy50aW1lcklkID0gc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLnRpY2soKS5jYXRjaChlcnJvciA9PiB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihcIlRpY2sgZXJyb3I6XCIsIGVycm9yKTtcbiAgICAgICAgICAgICAgICAvLyBcdTkwNDdcdTUyMzBcdTRFMjVcdTkxQ0RcdTk1MTlcdThCRUZcdTUzRUZcdTRFRTVcdTkwMDlcdTYyRTlcdTUwNUNcdTZCNjJcdTYyMTZcdTdFRTdcdTdFRURcdUZGMENcdThGRDlcdTkxQ0NcdTRFQzVcdThCQjBcdTVGNTVcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LCBkZWxheSk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBhc3luYyB0aWNrKCk6IFByb21pc2U8dm9pZD4ge1xuICAgICAgICBpZiAoIXRoaXMuaXNSdW5uaW5nKSByZXR1cm47XG5cbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGxldCB0YXNrUHJvY2Vzc2VkID0gZmFsc2U7XG5cbiAgICAgICAgICAgIGlmICh0aGlzLnBsdWdpbi5kYXRhLnJldmlzaW9uUXVldWUubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgIHRhc2tQcm9jZXNzZWQgPSBhd2FpdCB0aGlzLnJ1blJldmlzaW9uUGhhc2UoKTtcbiAgICAgICAgICAgIH0gXG4gICAgICAgICAgICBlbHNlIGlmICh0aGlzLnBsdWdpbi5kYXRhLnJldmlld1F1ZXVlLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICB0YXNrUHJvY2Vzc2VkID0gYXdhaXQgdGhpcy5ydW5Dcml0aWNQaGFzZSgpO1xuICAgICAgICAgICAgfSBcbiAgICAgICAgICAgIGVsc2UgaWYgKHRoaXMucGx1Z2luLmRhdGEuZ2VuZXJhdGlvblF1ZXVlLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICB0YXNrUHJvY2Vzc2VkID0gYXdhaXQgdGhpcy5ydW5HZW5lcmF0aW9uUGhhc2UoKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKCF0YXNrUHJvY2Vzc2VkICYmXG4gICAgICAgICAgICAgICAgdGhpcy5wbHVnaW4uZGF0YS5nZW5lcmF0aW9uUXVldWUubGVuZ3RoID09PSAwICYmXG4gICAgICAgICAgICAgICAgdGhpcy5wbHVnaW4uZGF0YS5yZXZpZXdRdWV1ZS5sZW5ndGggPT09IDAgJiZcbiAgICAgICAgICAgICAgICB0aGlzLnBsdWdpbi5kYXRhLnJldmlzaW9uUXVldWUubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgbmV3IE5vdGljZShcIlx1RDgzQ1x1REY4OSBBbGwgdGFza3MgY29tcGxldGVkISBFbmdpbmUgc3RvcHBlZC5cIik7XG4gICAgICAgICAgICAgICAgdGhpcy5pc1J1bm5pbmcgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB0aGlzLnBsdWdpbi5kYXRhLnN0YXR1cyA9IFwiaWRsZVwiOyBcbiAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZVN0YXR1c0JhcigpO1xuICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVQbHVnaW5EYXRhKCk7IFxuICAgICAgICAgICAgICAgIHJldHVybjsgXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoXCJFbmdpbmUgZmF0YWwgZXJyb3I6XCIsIGVycm9yKTtcbiAgICAgICAgICAgIG5ldyBOb3RpY2UoXCJFbmdpbmUgZW5jb3VudGVyZWQgYW4gZXJyb3IgYW5kIHBhdXNlZC4gQ2hlY2sgY29uc29sZS5cIik7XG4gICAgICAgICAgICB0aGlzLnN0b3AoKTsgXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLnNjaGVkdWxlTmV4dFRpY2soKTtcbiAgICB9XG5cbiAgICAvLyAtLS0gUGhhc2VzIC0tLVxuICAgIHByaXZhdGUgYXN5bmMgcnVuR2VuZXJhdGlvblBoYXNlKCk6IFByb21pc2U8Ym9vbGVhbj4ge1xuICAgICAgICBjb25zdCBxdWV1ZSA9IHRoaXMucGx1Z2luLmRhdGEuZ2VuZXJhdGlvblF1ZXVlO1xuICAgICAgICBpZiAocXVldWUubGVuZ3RoID09PSAwKSByZXR1cm4gZmFsc2U7XG5cbiAgICAgICAgY29uc3QgYmF0Y2hTaXplID0gdGhpcy5wbHVnaW4uc2V0dGluZ3MuZ2VuZXJhdGlvbl9iYXRjaF9zaXplO1xuICAgICAgICBjb25zdCBiYXRjaCA9IHF1ZXVlLnNwbGljZSgwLCBNYXRoLm1pbihxdWV1ZS5sZW5ndGgsIGJhdGNoU2l6ZSkpO1xuXG4gICAgICAgIHRoaXMudXBkYXRlU3RhdHVzQmFyKCk7XG4gICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVQbHVnaW5EYXRhKCk7IFxuXG4gICAgICAgIGNvbnN0IHRhc2tzID0gYmF0Y2gubWFwKGlkZWEgPT4gdGhpcy5nZW5lcmF0aW9uVGFzayhpZGVhKSk7XG4gICAgICAgIGF3YWl0IFByb21pc2UuYWxsU2V0dGxlZCh0YXNrcyk7XG5cbiAgICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVBsdWdpbkRhdGEoKTsgXG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cblxuICAgIHByaXZhdGUgYXN5bmMgZ2VuZXJhdGlvblRhc2soaWRlYTogc3RyaW5nKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgICAgIGNvbnN0IHByb21wdCA9IHRoaXMucGx1Z2luLnNldHRpbmdzLnByb21wdF9nZW5lcmF0b3IucmVwbGFjZShcIntjb25jZXB0fVwiLCBpZGVhKTtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGNvbnN0IGNvbnRlbnQgPSBhd2FpdCB0aGlzLmFwaUhhbmRsZXIuY2FsbChwcm9tcHQpO1xuICAgICAgICAgICAgY29uc3QgY2xlYW5lZENvbnRlbnQgPSBjbGVhbk1hcmtkb3duT3V0cHV0KGNvbnRlbnQpO1xuICAgICAgICAgICAgdGhpcy5wbHVnaW4uZGF0YS5yZXZpZXdRdWV1ZS5wdXNoKHsgaWRlYSwgY29udGVudDogY2xlYW5lZENvbnRlbnQgfSk7XG4gICAgICAgICAgICAvLyBcdTRGRUVcdTY1MzlcdUZGMUFjb25zb2xlLmxvZyAtPiBjb25zb2xlLmRlYnVnXG4gICAgICAgICAgICBjb25zb2xlLmRlYnVnKGBcdTI3MDUgW0dlbmVyYXRpb24gU3VjY2Vzc106ICR7aWRlYX1gKTtcbiAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICAgaWYgKGUgaW5zdGFuY2VvZiBBbGxNb2RlbHNGYWlsZWRFcnJvcikge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoYFx1Mjc0QyBbR2VuZXJhdGlvbiBGYWlsZWRdOiAke2lkZWF9IC0gJHtlLm1lc3NhZ2V9YCk7XG4gICAgICAgICAgICAgICAgdGhpcy5wbHVnaW4uZGF0YS5nZW5lcmF0aW9uUXVldWUudW5zaGlmdChpZGVhKTsgXG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcml2YXRlIGFzeW5jIHJ1bkNyaXRpY1BoYXNlKCk6IFByb21pc2U8Ym9vbGVhbj4ge1xuICAgICAgICBjb25zdCBxdWV1ZSA9IHRoaXMucGx1Z2luLmRhdGEucmV2aWV3UXVldWU7XG4gICAgICAgIGlmIChxdWV1ZS5sZW5ndGggPT09IDApIHJldHVybiBmYWxzZTtcblxuICAgICAgICBjb25zdCBiYXRjaFNpemUgPSB0aGlzLnBsdWdpbi5zZXR0aW5ncy5nZW5lcmF0aW9uX2JhdGNoX3NpemU7XG4gICAgICAgIGNvbnN0IHRhc2tzVG9SZXZpZXcgPSBxdWV1ZS5zcGxpY2UoMCwgTWF0aC5taW4ocXVldWUubGVuZ3RoLCBiYXRjaFNpemUpKTtcblxuICAgICAgICB0aGlzLnVwZGF0ZVN0YXR1c0JhcigpO1xuICAgICAgICBhd2FpdCB0aGlzLnBsdWdpbi5zYXZlUGx1Z2luRGF0YSgpOyBcblxuICAgICAgICBsZXQgbmV3SWRlYXNGb3VuZDogU2V0PHN0cmluZz4gPSBuZXcgU2V0KCk7XG5cbiAgICAgICAgZm9yIChjb25zdCB0YXNrIG9mIHRhc2tzVG9SZXZpZXcpIHtcbiAgICAgICAgICAgIGNvbnN0IHsgaXNBcHByb3ZlZCwgcmVhc29uIH0gPSBhd2FpdCB0aGlzLmNyaXRpYy5qdWRnZSh0YXNrLmNvbnRlbnQpO1xuICAgICAgICAgICAgaWYgKGlzQXBwcm92ZWQpIHtcbiAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLnNhdmVOb3RlKHRhc2suaWRlYSwgdGFzay5jb250ZW50KTtcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5wbHVnaW4uc2V0dGluZ3MuZXh0cmFjdF9uZXdfY29uY2VwdHMpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgaWRlYXMgPSBleHRyYWN0TmV3SWRlYXModGFzay5jb250ZW50KTtcbiAgICAgICAgICAgICAgICAgICAgaWRlYXMuZm9yRWFjaChpZGVhID0+IG5ld0lkZWFzRm91bmQuYWRkKGlkZWEpKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAvLyBcdTRGRUVcdTY1MzlcdUZGMUFjb25zb2xlLmxvZyAtPiBjb25zb2xlLmRlYnVnXG4gICAgICAgICAgICAgICAgY29uc29sZS5kZWJ1ZyhgXHVEODNEXHVEQzREIFtBcHByb3ZlZF06ICR7dGFzay5pZGVhfWApO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0YXNrLnJlYXNvbiA9IHJlYXNvbjtcbiAgICAgICAgICAgICAgICB0YXNrLnJldHJpZXMgPSAodGFzay5yZXRyaWVzIHx8IDApICsgMTtcbiAgICAgICAgICAgICAgICB0aGlzLnBsdWdpbi5kYXRhLnJldmlzaW9uUXVldWUucHVzaCh0YXNrKTtcbiAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4oYFx1RDgzRFx1REM0RSBbUmVqZWN0ZWRdOiAke3Rhc2suaWRlYX0gLSAke3JlYXNvbn1gKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChuZXdJZGVhc0ZvdW5kLnNpemUgPiAwKSB7XG4gICAgICAgICAgICB0aGlzLmFkZENvbmNlcHRzVG9RdWV1ZShBcnJheS5mcm9tKG5ld0lkZWFzRm91bmQpKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVQbHVnaW5EYXRhKCk7IFxuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG5cbiAgICBwcml2YXRlIGFzeW5jIHJ1blJldmlzaW9uUGhhc2UoKTogUHJvbWlzZTxib29sZWFuPiB7XG4gICAgICAgIGNvbnN0IHF1ZXVlID0gdGhpcy5wbHVnaW4uZGF0YS5yZXZpc2lvblF1ZXVlO1xuICAgICAgICBpZiAocXVldWUubGVuZ3RoID09PSAwKSByZXR1cm4gZmFsc2U7XG5cbiAgICAgICAgY29uc3QgYmF0Y2hTaXplID0gdGhpcy5wbHVnaW4uc2V0dGluZ3MuZ2VuZXJhdGlvbl9iYXRjaF9zaXplO1xuICAgICAgICBjb25zdCB0YXNrc1RvUmV2aXNlID0gcXVldWUuc3BsaWNlKDAsIE1hdGgubWluKHF1ZXVlLmxlbmd0aCwgYmF0Y2hTaXplKSk7XG5cbiAgICAgICAgdGhpcy51cGRhdGVTdGF0dXNCYXIoKTtcbiAgICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVBsdWdpbkRhdGEoKTsgXG5cbiAgICAgICAgZm9yIChjb25zdCB0YXNrIG9mIHRhc2tzVG9SZXZpc2UpIHtcbiAgICAgICAgICAgIGlmICgodGFzay5yZXRyaWVzIHx8IDApID49IHRoaXMucGx1Z2luLnNldHRpbmdzLm1heF9yZXZpc2lvbl9yZXRyaWVzKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5wbHVnaW4uZGF0YS5kaXNjYXJkZWRQaWxlLnB1c2godGFzayk7IFxuICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoYFx1RDgzRFx1REM4MCBbR2l2ZSB1cF06ICR7dGFzay5pZGVhfSBtYXggcmV0cmllcyByZWFjaGVkLmApO1xuICAgICAgICAgICAgICAgIGNvbnRpbnVlOyBcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGF3YWl0IHRoaXMucmV2aXNpb25UYXNrKHRhc2spO1xuICAgICAgICB9XG5cbiAgICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVBsdWdpbkRhdGEoKTsgXG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cblxuICAgIHByaXZhdGUgYXN5bmMgcmV2aXNpb25UYXNrKHRhc2s6IFRhc2tEYXRhKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgICAgIGNvbnN0IHByb21wdCA9IHRoaXMucmV2aXNlci5jcmVhdGVSZXZpc2lvblByb21wdCh0YXNrLmlkZWEsIHRhc2suY29udGVudCwgdGFzay5yZWFzb24gfHwgXCJ1bmtub3duXCIpO1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgY29uc3QgbmV3Q29udGVudCA9IGF3YWl0IHRoaXMuYXBpSGFuZGxlci5jYWxsKHByb21wdCk7XG4gICAgICAgICAgICBjb25zdCBjbGVhbmVkQ29udGVudCA9IGNsZWFuTWFya2Rvd25PdXRwdXQobmV3Q29udGVudCk7XG4gICAgICAgICAgICBjb25zdCByZXZpc2VkVGFzazogVGFza0RhdGEgPSB7IC4uLnRhc2ssIGNvbnRlbnQ6IGNsZWFuZWRDb250ZW50IH07XG4gICAgICAgICAgICB0aGlzLnBsdWdpbi5kYXRhLnJldmlld1F1ZXVlLnB1c2gocmV2aXNlZFRhc2spOyBcbiAgICAgICAgICAgIC8vIFx1NEZFRVx1NjUzOVx1RkYxQWNvbnNvbGUubG9nIC0+IGNvbnNvbGUuZGVidWdcbiAgICAgICAgICAgIGNvbnNvbGUuZGVidWcoYFx1RDgzRFx1REQwNCBbUmV2aXNpb24gQ29tcGxldGVdOiAke3Rhc2suaWRlYX1gKTtcbiAgICAgICAgfSBjYXRjaCAoZTogdW5rbm93bikge1xuICAgICAgICAgICAgIC8vIFx1NEY3Rlx1NzUyOFx1N0M3Qlx1NTc4Qlx1NjZGNFx1NUI4OVx1NTE2OFx1NzY4NFx1NTE5OVx1NkNENVx1RkYwQ1x1NUY3Qlx1NUU5NVx1NkQ4OFx1OTY2NCBhbnlcbiAgICAgICAgICAgIGNvbnN0IGVyck1zZyA9IGUgaW5zdGFuY2VvZiBFcnJvciA/IGUubWVzc2FnZSA6IFN0cmluZyhlKTtcbiAgICAgICAgICAgIC8vIFx1MjcwNSBcdTRGRUVcdTZCNjNcdTcwQjlcdUZGMUFcdTRGN0ZcdTc1MjggZXJyTXNnIFx1ODAwQ1x1NEUwRFx1NjYyRiBlcnI/Lm1lc3NhZ2VcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoYFx1Mjc0QyBbUmV2aXNpb24gRmFpbGVkXTogJHt0YXNrLmlkZWF9IC0gJHtlcnJNc2d9YCk7XG4gICAgICAgICAgICB0aGlzLnBsdWdpbi5kYXRhLnJldmlzaW9uUXVldWUudW5zaGlmdCh0YXNrKTsgXG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvLyAtLS0gRmlsZSAmIFVJIC0tLVxuICAgIHByaXZhdGUgYXN5bmMgc2F2ZU5vdGUoaWRlYTogc3RyaW5nLCBjb250ZW50OiBzdHJpbmcpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICAgICAgY29uc3QgZmlsZW5hbWUgPSBzYW5pdGl6ZUZpbGVuYW1lKGlkZWEpO1xuICAgICAgICBjb25zdCBmb2xkZXJQYXRoID0gdGhpcy5wbHVnaW4uc2V0dGluZ3Mub3V0cHV0X2RpcjtcblxuICAgICAgICBpZiAoISh0aGlzLmFwcC52YXVsdC5nZXRBYnN0cmFjdEZpbGVCeVBhdGgoZm9sZGVyUGF0aCkgaW5zdGFuY2VvZiBURm9sZGVyKSkge1xuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLmFwcC52YXVsdC5jcmVhdGVGb2xkZXIoZm9sZGVyUGF0aCk7XG4gICAgICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoYENyZWF0ZSBmb2xkZXIgZmFpbGVkOiAke2ZvbGRlclBhdGh9YCwgZXJyb3IpO1xuICAgICAgICAgICAgICAgIG5ldyBOb3RpY2UoYENhbm5vdCBjcmVhdGUgZm9sZGVyOiAke2ZvbGRlclBhdGh9YCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuOyBcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgY29uc3QgZmlsZVBhdGggPSBub3JtYWxpemVQYXRoKGAke2ZvbGRlclBhdGh9LyR7ZmlsZW5hbWV9Lm1kYCk7XG4gICAgICAgIGNvbnN0IGZpbGUgPSB0aGlzLmFwcC52YXVsdC5nZXRBYnN0cmFjdEZpbGVCeVBhdGgoZmlsZVBhdGgpO1xuXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBpZiAoZmlsZSBpbnN0YW5jZW9mIFRGaWxlKSB7XG4gICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5hcHAudmF1bHQubW9kaWZ5KGZpbGUsIGNvbnRlbnQpO1xuICAgICAgICAgICAgICAgIG5ldyBOb3RpY2UoYE5vdGUgdXBkYXRlZDogJHtmaWxlbmFtZX1gKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5hcHAudmF1bHQuY3JlYXRlKGZpbGVQYXRoLCBjb250ZW50KTtcbiAgICAgICAgICAgICAgICBuZXcgTm90aWNlKGBOb3RlIGNyZWF0ZWQ6ICR7ZmlsZW5hbWV9YCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKGBTYXZlIG5vdGUgZmFpbGVkOiAke2ZpbGVQYXRofWAsIGVycm9yKTtcbiAgICAgICAgICAgIG5ldyBOb3RpY2UoYENhbm5vdCBzYXZlIG5vdGU6ICR7ZmlsZW5hbWV9YCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwdWJsaWMgdXBkYXRlU3RhdHVzQmFyKCk6IHZvaWQge1xuICAgICAgICBpZiAoIXRoaXMucGx1Z2luLnN0YXR1c0JhckVsKSByZXR1cm47XG4gICAgICAgIGNvbnN0IHsgZ2VuZXJhdGlvblF1ZXVlLCByZXZpZXdRdWV1ZSwgcmV2aXNpb25RdWV1ZSB9ID0gdGhpcy5wbHVnaW4uZGF0YTtcbiAgICAgICAgY29uc3QgdG90YWwgPSBnZW5lcmF0aW9uUXVldWUubGVuZ3RoICsgcmV2aWV3UXVldWUubGVuZ3RoICsgcmV2aXNpb25RdWV1ZS5sZW5ndGg7XG4gICAgICAgIFxuICAgICAgICB0aGlzLnBsdWdpbi5zdGF0dXNCYXJFbC5zZXRUZXh0KFxuICAgICAgICAgICAgYEtHOiAke3RoaXMucGx1Z2luLmRhdGEuc3RhdHVzfSB8IEc6JHtnZW5lcmF0aW9uUXVldWUubGVuZ3RofSB8IEM6JHtyZXZpZXdRdWV1ZS5sZW5ndGh9IHwgUjoke3JldmlzaW9uUXVldWUubGVuZ3RofSB8IFRvdGFsOiR7dG90YWx9YFxuICAgICAgICApO1xuICAgICAgICBcbiAgICAgICAgdGhpcy5hcHAud29ya3NwYWNlLnRyaWdnZXIoXCJrZy1kYXRhLXVwZGF0ZWRcIik7XG4gICAgfVxufSIsICIvLyBzcmMvYXBpSGFuZGxlci50c1xuXG5pbXBvcnQgeyByZXF1ZXN0VXJsLCBOb3RpY2UgfSBmcm9tICdvYnNpZGlhbic7XG5pbXBvcnQgS25vd2xlZGdlR3JhcGhQbHVnaW4gZnJvbSAnLi9tYWluJztcbmltcG9ydCB7IEtub3dsZWRnZUdyYXBoUGx1Z2luU2V0dGluZ3MsIEtleVVzYWdlU3RhdHVzIH0gZnJvbSAnLi90eXBlcyc7XG5cbmV4cG9ydCBjbGFzcyBBcGlLZXlFeGhhdXN0ZWRFcnJvciBleHRlbmRzIEVycm9yIHtcbiAgICBjb25zdHJ1Y3RvcihtZXNzYWdlOiBzdHJpbmcpIHtcbiAgICAgICAgc3VwZXIobWVzc2FnZSk7XG4gICAgICAgIHRoaXMubmFtZSA9IFwiQXBpS2V5RXhoYXVzdGVkRXJyb3JcIjtcbiAgICB9XG59XG5cbmV4cG9ydCBjbGFzcyBBbGxNb2RlbHNGYWlsZWRFcnJvciBleHRlbmRzIEVycm9yIHtcbiAgICBjb25zdHJ1Y3RvcihtZXNzYWdlOiBzdHJpbmcpIHtcbiAgICAgICAgc3VwZXIobWVzc2FnZSk7XG4gICAgICAgIHRoaXMubmFtZSA9IFwiQWxsTW9kZWxzRmFpbGVkRXJyb3JcIjtcbiAgICB9XG59XG5cbmV4cG9ydCBjbGFzcyBBUElIYW5kbGVyIHtcbiAgICBwcml2YXRlIHBsdWdpbjogS25vd2xlZGdlR3JhcGhQbHVnaW47XG4gICAgcHJpdmF0ZSBzZXR0aW5nczogS25vd2xlZGdlR3JhcGhQbHVnaW5TZXR0aW5ncztcbiAgICBcbiAgICBwcml2YXRlIG9wZW5haV9rZXlzOiBzdHJpbmdbXSA9IFtdO1xuICAgIHByaXZhdGUgZ29vZ2xlX2tleXM6IHN0cmluZ1tdID0gW107XG4gICAgXG4gICAgcHJpdmF0ZSBrZXlVc2FnZU9wZW5BSSA9IG5ldyBNYXA8c3RyaW5nLCBLZXlVc2FnZVN0YXR1cz4oKTtcbiAgICBwcml2YXRlIGtleVVzYWdlR29vZ2xlID0gbmV3IE1hcDxzdHJpbmcsIEtleVVzYWdlU3RhdHVzPigpO1xuICAgIFxuICAgIHByaXZhdGUgaGFzTm90aWZpZWRGYWlsb3ZlcjogYm9vbGVhbiA9IGZhbHNlO1xuXG4gICAgY29uc3RydWN0b3IocGx1Z2luOiBLbm93bGVkZ2VHcmFwaFBsdWdpbikge1xuICAgICAgICB0aGlzLnBsdWdpbiA9IHBsdWdpbjtcbiAgICAgICAgdGhpcy5zZXR0aW5ncyA9IHBsdWdpbi5zZXR0aW5ncztcbiAgICAgICAgdGhpcy51cGRhdGVLZXlzKCk7XG4gICAgfVxuXG4gICAgcHVibGljIHVwZGF0ZUtleXMoKTogdm9pZCB7XG4gICAgICAgIHRoaXMub3BlbmFpX2tleXMgPSB0aGlzLnNldHRpbmdzLm9wZW5haV9hcGlfa2V5cy5zcGxpdChcIlxcblwiKS5tYXAoKGspID0+IGsudHJpbSgpKS5maWx0ZXIoQm9vbGVhbik7XG4gICAgICAgIHRoaXMuZ29vZ2xlX2tleXMgPSB0aGlzLnNldHRpbmdzLmdvb2dsZV9hcGlfa2V5cy5zcGxpdChcIlxcblwiKS5tYXAoKGspID0+IGsudHJpbSgpKS5maWx0ZXIoQm9vbGVhbik7XG5cbiAgICAgICAgdGhpcy5vcGVuYWlfa2V5cy5mb3JFYWNoKChrZXkpID0+IHtcbiAgICAgICAgICAgIGlmICghdGhpcy5rZXlVc2FnZU9wZW5BSS5oYXMoa2V5KSkge1xuICAgICAgICAgICAgICAgIHRoaXMua2V5VXNhZ2VPcGVuQUkuc2V0KGtleSwgeyBmYWlsczogMCwgY29vbGRvd25fdW50aWw6IDAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLmdvb2dsZV9rZXlzLmZvckVhY2goKGtleSkgPT4ge1xuICAgICAgICAgICAgaWYgKCF0aGlzLmtleVVzYWdlR29vZ2xlLmhhcyhrZXkpKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5rZXlVc2FnZUdvb2dsZS5zZXQoa2V5LCB7IGZhaWxzOiAwLCBjb29sZG93bl91bnRpbDogMCB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBfc2VsZWN0S2V5KGtleXM6IHN0cmluZ1tdLCBwcm92aWRlcjogJ29wZW5haScgfCAnZ29vZ2xlJyk6IHN0cmluZyB8IG51bGwge1xuICAgICAgICBjb25zdCBrZXlVc2FnZU1hcCA9IHByb3ZpZGVyID09PSBcIm9wZW5haVwiID8gdGhpcy5rZXlVc2FnZU9wZW5BSSA6IHRoaXMua2V5VXNhZ2VHb29nbGU7XG4gICAgICAgIGNvbnN0IGN1cnJlbnRUaW1lID0gRGF0ZS5ub3coKSAvIDEwMDA7XG5cbiAgICAgICAgZm9yIChjb25zdCBrZXkgb2Yga2V5cykge1xuICAgICAgICAgICAgY29uc3QgdXNhZ2UgPSBrZXlVc2FnZU1hcC5nZXQoa2V5KTtcbiAgICAgICAgICAgIGlmICh1c2FnZSAmJiBjdXJyZW50VGltZSA+PSB1c2FnZS5jb29sZG93bl91bnRpbCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBrZXk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBhc3luYyBfbWFrZU9wZW5BSVJlcXVlc3Qoa2V5OiBzdHJpbmcsIHByb21wdDogc3RyaW5nLCBtb2RlbE5hbWU6IHN0cmluZyk6IFByb21pc2U8c3RyaW5nPiB7XG4gICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgcmVxdWVzdFVybCh7XG4gICAgICAgICAgICB1cmw6IGAke3RoaXMuc2V0dGluZ3Mub3BlbmFpX2Jhc2VfdXJsfS9jaGF0L2NvbXBsZXRpb25zYCxcbiAgICAgICAgICAgIG1ldGhvZDogXCJQT1NUXCIsXG4gICAgICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgICAgICAgXCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi9qc29uXCIsXG4gICAgICAgICAgICAgICAgXCJBdXRob3JpemF0aW9uXCI6IGBCZWFyZXIgJHtrZXl9YFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgICAgICAgICBtb2RlbDogbW9kZWxOYW1lLFxuICAgICAgICAgICAgICAgIG1lc3NhZ2VzOiBbeyByb2xlOiBcInVzZXJcIiwgY29udGVudDogcHJvbXB0IH1dLFxuICAgICAgICAgICAgICAgIHRlbXBlcmF0dXJlOiB0aGlzLnNldHRpbmdzLmdlbmVyYXRpb25fdGVtcGVyYXR1cmUsXG4gICAgICAgICAgICAgICAgbWF4X3Rva2VuczogdGhpcy5zZXR0aW5ncy5nZW5lcmF0aW9uX21heF90b2tlbnNcbiAgICAgICAgICAgIH0pXG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gcmVzcG9uc2UuanNvbi5jaG9pY2VzWzBdLm1lc3NhZ2UuY29udGVudC50cmltKCk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBhc3luYyBfbWFrZUdvb2dsZUFQSVJlcXVlc3Qoa2V5OiBzdHJpbmcsIHByb21wdDogc3RyaW5nLCBtb2RlbE5hbWU6IHN0cmluZyk6IFByb21pc2U8c3RyaW5nPiB7XG4gICAgICAgIGNvbnN0IHVybCA9IGBodHRwczovL2dlbmVyYXRpdmVsYW5ndWFnZS5nb29nbGVhcGlzLmNvbS92MWJldGEvbW9kZWxzLyR7bW9kZWxOYW1lfTpnZW5lcmF0ZUNvbnRlbnQ/a2V5PSR7a2V5fWA7XG4gICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgcmVxdWVzdFVybCh7XG4gICAgICAgICAgICB1cmwsXG4gICAgICAgICAgICBtZXRob2Q6IFwiUE9TVFwiLFxuICAgICAgICAgICAgaGVhZGVyczogeyBcIkNvbnRlbnQtVHlwZVwiOiBcImFwcGxpY2F0aW9uL2pzb25cIiB9LFxuICAgICAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICAgICAgICAgIGNvbnRlbnRzOiBbeyBwYXJ0czogW3sgdGV4dDogcHJvbXB0IH1dIH1dLFxuICAgICAgICAgICAgICAgIGdlbmVyYXRpb25Db25maWc6IHtcbiAgICAgICAgICAgICAgICAgICAgdGVtcGVyYXR1cmU6IHRoaXMuc2V0dGluZ3MuZ2VuZXJhdGlvbl90ZW1wZXJhdHVyZSxcbiAgICAgICAgICAgICAgICAgICAgbWF4T3V0cHV0VG9rZW5zOiB0aGlzLnNldHRpbmdzLmdlbmVyYXRpb25fbWF4X3Rva2Vuc1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pXG4gICAgICAgIH0pO1xuXG4gICAgICAgIGNvbnN0IGRhdGEgPSByZXNwb25zZS5qc29uO1xuICAgICAgICBpZiAoIWRhdGEuY2FuZGlkYXRlcyB8fCBkYXRhLmNhbmRpZGF0ZXMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJBUEkgcmVzcG9uc2UgaXMgbWlzc2luZyBjYW5kaWRhdGVzLiBGdWxsIHJlc3BvbnNlOiBcIiArIEpTT04uc3RyaW5naWZ5KGRhdGEpKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZGF0YS5jYW5kaWRhdGVzWzBdLmNvbnRlbnQucGFydHNbMF0udGV4dC50cmltKCk7XG4gICAgfVxuXG4gICAgLy8gXHU0RkVFXHU2NTM5XHVGRjFBXHU1QzA2XHU1M0MyXHU2NTcwXHU3QzdCXHU1NzhCXHU2NTM5XHU0RTNBIHVua25vd25cdUZGMENcdTVFNzZcdTU3MjhcdTUxODVcdTkwRThcdTY1QURcdThBMDBcdUZGMENcdTkwN0ZcdTUxNEQgXCJVbmV4cGVjdGVkIGFueVwiXG4gICAgcHJpdmF0ZSBfaXNRdW90YUVycm9yKGVycm9yOiB1bmtub3duKTogYm9vbGVhbiB7XG4gICAgICAgIGNvbnN0IGVyciA9IGVycm9yIGFzIHsgc3RhdHVzPzogbnVtYmVyOyBtZXNzYWdlPzogc3RyaW5nIH07IC8vIFx1NUM0MFx1OTBFOFx1N0M3Qlx1NTc4Qlx1NjVBRFx1OEEwMFxuICAgICAgICBjb25zdCBodHRwU3RhdHVzID0gZXJyLnN0YXR1cztcbiAgICAgICAgY29uc3QgZXJyb3JNZXNzYWdlID0gZXJyLm1lc3NhZ2U/LnRvTG93ZXJDYXNlKCkgfHwgXCJcIjtcbiAgICAgICAgXG4gICAgICAgIGlmIChodHRwU3RhdHVzID09PSA0MDEgfHwgaHR0cFN0YXR1cyA9PT0gNDAzIHx8IGh0dHBTdGF0dXMgPT09IDQyOSkge1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIGlmIChlcnJvck1lc3NhZ2UuaW5jbHVkZXMoXCJpbnN1ZmZpY2llbnRfcXVvdGFcIikgfHwgZXJyb3JNZXNzYWdlLmluY2x1ZGVzKFwicmF0ZSBsaW1pdFwiKSB8fCBlcnJvck1lc3NhZ2UuaW5jbHVkZXMoXCJxdW90YVwiKSB8fCBlcnJvck1lc3NhZ2UuaW5jbHVkZXMoXCJwZXJtaXNzaW9uXCIpIHx8IGVycm9yTWVzc2FnZS5pbmNsdWRlcyhcIjQyOVwiKSkge1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICBwcml2YXRlIF9jb29sZG93bktleShrZXk6IHN0cmluZywgcHJvdmlkZXI6ICdvcGVuYWknIHwgJ2dvb2dsZScpOiB2b2lkIHtcbiAgICAgICAgY29uc3Qga2V5VXNhZ2VNYXAgPSBwcm92aWRlciA9PT0gXCJvcGVuYWlcIiA/IHRoaXMua2V5VXNhZ2VPcGVuQUkgOiB0aGlzLmtleVVzYWdlR29vZ2xlO1xuICAgICAgICBjb25zdCBrZXlVc2FnZSA9IGtleVVzYWdlTWFwLmdldChrZXkpO1xuICAgICAgICBpZiAoa2V5VXNhZ2UpIHtcbiAgICAgICAgICAgIGNvbnNvbGUud2FybihgS2V5IC4uLiR7a2V5LnNsaWNlKC00KX0gKCR7cHJvdmlkZXJ9KSBmYWlsZWQgZHVlIHRvIHF1b3RhL2F1dGggZXJyb3IuIEFwcGx5aW5nIGNvb2xkb3duLmApO1xuICAgICAgICAgICAga2V5VXNhZ2UuY29vbGRvd25fdW50aWwgPSAoRGF0ZS5ub3coKSAvIDEwMDApICsgdGhpcy5zZXR0aW5ncy5mYWlsb3Zlcl9jb29sZG93bl9zZWNvbmRzO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBfcmVzZXRDb29sZG93bihrZXk6IHN0cmluZywgcHJvdmlkZXI6ICdvcGVuYWknIHwgJ2dvb2dsZScpOiB2b2lkIHtcbiAgICAgICAgY29uc3Qga2V5VXNhZ2VNYXAgPSBwcm92aWRlciA9PT0gXCJvcGVuYWlcIiA/IHRoaXMua2V5VXNhZ2VPcGVuQUkgOiB0aGlzLmtleVVzYWdlR29vZ2xlO1xuICAgICAgICBjb25zdCBrZXlVc2FnZSA9IGtleVVzYWdlTWFwLmdldChrZXkpO1xuICAgICAgICBpZiAoa2V5VXNhZ2UpIHtcbiAgICAgICAgICAgIGtleVVzYWdlLmNvb2xkb3duX3VudGlsID0gMDtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmhhc05vdGlmaWVkRmFpbG92ZXIgPSBmYWxzZTtcbiAgICB9XG5cbiAgICBwcml2YXRlIGFzeW5jIF9jYWxsT3BlbkFJKGtleTogc3RyaW5nLCBwcm9tcHQ6IHN0cmluZyk6IFByb21pc2U8c3RyaW5nPiB7XG4gICAgICAgIGNvbnN0IHByaW1hcnlNb2RlbCA9IHRoaXMuc2V0dGluZ3Mub3BlbmFpX21vZGVsO1xuICAgICAgICBjb25zdCBiYWNrdXBNb2RlbCA9IHRoaXMuc2V0dGluZ3Mub3BlbmFpX2JhY2t1cF9tb2RlbDtcbiAgICAgICAgXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB0aGlzLl9tYWtlT3BlbkFJUmVxdWVzdChrZXksIHByb21wdCwgcHJpbWFyeU1vZGVsKTtcbiAgICAgICAgICAgIHRoaXMuX3Jlc2V0Q29vbGRvd24oa2V5LCBcIm9wZW5haVwiKTtcbiAgICAgICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICAgIH0gY2F0Y2ggKGU6IHVua25vd24pIHtcbiAgICAgICAgICAgIGNvbnN0IHByaW1hcnlFcnJvciA9IGU7XG4gICAgICAgICAgICAvLyBcdTRGRUVcdTY1MzlcdUZGMUFcdTRGN0ZcdTc1MjhcdTdDN0JcdTU3OEJcdTVCODhcdTUzNkJcdTYyMTZcdTY1QURcdThBMDBcdTY3NjVcdTgzQjdcdTUzRDYgbWVzc2FnZVx1RkYwQ1x1OTA3Rlx1NTE0RCAoZSBhcyBhbnkpXG4gICAgICAgICAgICBjb25zdCBwcmltYXJ5TXNnID0gKGUgaW5zdGFuY2VvZiBFcnJvcikgPyBlLm1lc3NhZ2UgOiBTdHJpbmcoZSk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGNvbnNvbGUud2FybihgT3BlbkFJIHByaW1hcnkgbW9kZWwgJyR7cHJpbWFyeU1vZGVsfScgZmFpbGVkIGZvciBrZXkgLi4uJHtrZXkuc2xpY2UoLTQpfTpgLCBwcmltYXJ5TXNnKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgaWYgKGJhY2t1cE1vZGVsKSB7IFxuICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGJhY2t1cFJlc3VsdCA9IGF3YWl0IHRoaXMuX21ha2VPcGVuQUlSZXF1ZXN0KGtleSwgcHJvbXB0LCBiYWNrdXBNb2RlbCk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3Jlc2V0Q29vbGRvd24oa2V5LCBcIm9wZW5haVwiKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGJhY2t1cFJlc3VsdDsgXG4gICAgICAgICAgICAgICAgfSBjYXRjaCAoZTI6IHVua25vd24pIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgYmFja3VwTXNnID0gKGUyIGluc3RhbmNlb2YgRXJyb3IpID8gZTIubWVzc2FnZSA6IFN0cmluZyhlMik7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoYE9wZW5BSSBiYWNrdXAgbW9kZWwgJyR7YmFja3VwTW9kZWx9JyBhbHNvIGZhaWxlZCBmb3Iga2V5IC4uLiR7a2V5LnNsaWNlKC00KX06YCwgYmFja3VwTXNnKTtcbiAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLl9pc1F1b3RhRXJyb3IocHJpbWFyeUVycm9yKSB8fCB0aGlzLl9pc1F1b3RhRXJyb3IoZTIpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9jb29sZG93bktleShrZXksIFwib3BlbmFpXCIpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBBcGlLZXlFeGhhdXN0ZWRFcnJvcihgT3BlbkFJIGtleSBmYWlsZWQgKGJvdGggcHJpbWFyeSBhbmQgYmFja3VwIG1vZGVscykuYCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgXG4gICAgICAgICAgICBpZiAodGhpcy5faXNRdW90YUVycm9yKHByaW1hcnlFcnJvcikpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9jb29sZG93bktleShrZXksIFwib3BlbmFpXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhyb3cgbmV3IEFwaUtleUV4aGF1c3RlZEVycm9yKGBPcGVuQUkga2V5IGZhaWxlZCAocHJpbWFyeSBtb2RlbCBmYWlsZWQsIG5vIGJhY2t1cCk6ICR7cHJpbWFyeU1zZ31gKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHByaXZhdGUgYXN5bmMgX2NhbGxHb29nbGVBUEkoa2V5OiBzdHJpbmcsIHByb21wdDogc3RyaW5nKTogUHJvbWlzZTxzdHJpbmc+IHtcbiAgICAgICAgY29uc3QgcHJpbWFyeU1vZGVsID0gdGhpcy5zZXR0aW5ncy5nb29nbGVfbW9kZWw7XG4gICAgICAgIGNvbnN0IGJhY2t1cE1vZGVsID0gdGhpcy5zZXR0aW5ncy5nb29nbGVfYmFja3VwX21vZGVsO1xuICAgICAgICBcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMuX21ha2VHb29nbGVBUElSZXF1ZXN0KGtleSwgcHJvbXB0LCBwcmltYXJ5TW9kZWwpO1xuICAgICAgICAgICAgdGhpcy5fcmVzZXRDb29sZG93bihrZXksIFwiZ29vZ2xlXCIpO1xuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgICAgfSBjYXRjaCAoZTogdW5rbm93bikge1xuICAgICAgICAgICAgY29uc3QgcHJpbWFyeUVycm9yID0gZTtcbiAgICAgICAgICAgIGNvbnN0IHByaW1hcnlNc2cgPSAoZSBpbnN0YW5jZW9mIEVycm9yKSA/IGUubWVzc2FnZSA6IFN0cmluZyhlKTtcbiAgICAgICAgICAgIGNvbnNvbGUud2FybihgR29vZ2xlIHByaW1hcnkgbW9kZWwgJyR7cHJpbWFyeU1vZGVsfScgZmFpbGVkIGZvciBrZXkgLi4uJHtrZXkuc2xpY2UoLTQpfTpgLCBwcmltYXJ5TXNnKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgaWYgKGJhY2t1cE1vZGVsKSB7XG4gICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgYmFja3VwUmVzdWx0ID0gYXdhaXQgdGhpcy5fbWFrZUdvb2dsZUFQSVJlcXVlc3Qoa2V5LCBwcm9tcHQsIGJhY2t1cE1vZGVsKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fcmVzZXRDb29sZG93bihrZXksIFwiZ29vZ2xlXCIpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gYmFja3VwUmVzdWx0OyBcbiAgICAgICAgICAgICAgICB9IGNhdGNoIChlMjogdW5rbm93bikge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBiYWNrdXBNc2cgPSAoZTIgaW5zdGFuY2VvZiBFcnJvcikgPyBlMi5tZXNzYWdlIDogU3RyaW5nKGUyKTtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihgR29vZ2xlIGJhY2t1cCBtb2RlbCAnJHtiYWNrdXBNb2RlbH0nIGFsc28gZmFpbGVkIGZvciBrZXkgLi4uJHtrZXkuc2xpY2UoLTQpfTpgLCBiYWNrdXBNc2cpO1xuICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuX2lzUXVvdGFFcnJvcihwcmltYXJ5RXJyb3IpIHx8IHRoaXMuX2lzUXVvdGFFcnJvcihlMikpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2Nvb2xkb3duS2V5KGtleSwgXCJnb29nbGVcIik7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEFwaUtleUV4aGF1c3RlZEVycm9yKGBHb29nbGUga2V5IGZhaWxlZCAoYm90aCBwcmltYXJ5IGFuZCBiYWNrdXAgbW9kZWxzKS5gKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGlmICh0aGlzLl9pc1F1b3RhRXJyb3IocHJpbWFyeUVycm9yKSkge1xuICAgICAgICAgICAgICAgIHRoaXMuX2Nvb2xkb3duS2V5KGtleSwgXCJnb29nbGVcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aHJvdyBuZXcgQXBpS2V5RXhoYXVzdGVkRXJyb3IoYEdvb2dsZSBrZXkgZmFpbGVkIChwcmltYXJ5IG1vZGVsIGZhaWxlZCwgbm8gYmFja3VwKTogJHtwcmltYXJ5TXNnfWApO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHVibGljIGFzeW5jIGNhbGwocHJvbXB0OiBzdHJpbmcpOiBQcm9taXNlPHN0cmluZz4ge1xuICAgICAgICB0aGlzLnVwZGF0ZUtleXMoKTtcbiAgICAgICAgbGV0IGxhc3RFcnJvcjogRXJyb3IgfCBudWxsID0gbnVsbDtcbiAgICAgICAgbGV0IG9wZW5BSUtleXNBdHRlbXB0ZWQgPSBmYWxzZTtcblxuICAgICAgICBjb25zdCBvcGVuQUlFbmFibGVkID0gdGhpcy5vcGVuYWlfa2V5cy5sZW5ndGggPiAwICYmICEhKHRoaXMuc2V0dGluZ3Mub3BlbmFpX21vZGVsIHx8IHRoaXMuc2V0dGluZ3Mub3BlbmFpX2JhY2t1cF9tb2RlbCk7XG4gICAgICAgIGNvbnN0IGdvb2dsZUVuYWJsZWQgPSB0aGlzLmdvb2dsZV9rZXlzLmxlbmd0aCA+IDAgJiYgISEodGhpcy5zZXR0aW5ncy5nb29nbGVfbW9kZWwgfHwgdGhpcy5zZXR0aW5ncy5nb29nbGVfYmFja3VwX21vZGVsKTtcblxuICAgICAgICBpZiAob3BlbkFJRW5hYmxlZCkge1xuICAgICAgICAgICAgb3BlbkFJS2V5c0F0dGVtcHRlZCA9IHRydWU7XG4gICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMub3BlbmFpX2tleXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICBjb25zdCBrZXkgPSB0aGlzLl9zZWxlY3RLZXkodGhpcy5vcGVuYWlfa2V5cywgXCJvcGVuYWlcIik7XG4gICAgICAgICAgICAgICAgaWYgKGtleSkge1xuICAgICAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5kZWJ1ZyhgVHJ5aW5nIE9wZW5BSSBrZXkgLi4uJHtrZXkuc2xpY2UoLTQpfWApO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGF3YWl0IHRoaXMuX2NhbGxPcGVuQUkoa2V5LCBwcm9tcHQpO1xuICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChlOiB1bmtub3duKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBlcnIgPSBlIGFzIEVycm9yO1xuICAgICAgICAgICAgICAgICAgICAgICAgbGFzdEVycm9yID0gZXJyO1xuICAgICAgICAgICAgICAgICAgICAgICAgbmV3IE5vdGljZShgT3BlbkFJIGtleSAuLi4ke2tleS5zbGljZSgtNCl9IGZhaWxlZC4gVHJ5aW5nIG5leHQuYCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSBpZiAodGhpcy5vcGVuYWlfa2V5cy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICBvcGVuQUlLZXlzQXR0ZW1wdGVkID0gdHJ1ZTtcbiAgICAgICAgICAgIGxhc3RFcnJvciA9IG5ldyBFcnJvcihcIk9wZW5BSTogS2V5cyBwcm92aWRlZCBidXQgbm8gbW9kZWxzIGRlZmluZWQuXCIpO1xuICAgICAgICAgICAgY29uc29sZS53YXJuKGxhc3RFcnJvci5tZXNzYWdlKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChnb29nbGVFbmFibGVkKSB7XG4gICAgICAgICAgICBpZiAob3BlbkFJS2V5c0F0dGVtcHRlZCAmJiAhdGhpcy5oYXNOb3RpZmllZEZhaWxvdmVyKSB7XG4gICAgICAgICAgICAgICAgbmV3IE5vdGljZShcIkFsbCBPcGVuQUkga2V5cyBmYWlsZWQgb3IgdW5hdmFpbGFibGUuIFN3aXRjaGluZyB0byBHb29nbGUgR2VtaW5pLi4uXCIpO1xuICAgICAgICAgICAgICAgIHRoaXMuaGFzTm90aWZpZWRGYWlsb3ZlciA9IHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuZ29vZ2xlX2tleXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICBjb25zdCBrZXkgPSB0aGlzLl9zZWxlY3RLZXkodGhpcy5nb29nbGVfa2V5cywgXCJnb29nbGVcIik7XG4gICAgICAgICAgICAgICAgaWYgKGtleSkge1xuICAgICAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5kZWJ1ZyhgVHJ5aW5nIEdvb2dsZSBHZW1pbmkga2V5IC4uLiR7a2V5LnNsaWNlKC00KX1gKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBhd2FpdCB0aGlzLl9jYWxsR29vZ2xlQVBJKGtleSwgcHJvbXB0KTtcbiAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoZTogdW5rbm93bikge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZXJyID0gZSBhcyBFcnJvcjtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxhc3RFcnJvciA9IGVycjtcbiAgICAgICAgICAgICAgICAgICAgICAgIG5ldyBOb3RpY2UoYEdvb2dsZSBHZW1pbmkga2V5IC4uLiR7a2V5LnNsaWNlKC00KX0gZmFpbGVkLiBUcnlpbmcgbmV4dC5gKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIGlmICh0aGlzLmdvb2dsZV9rZXlzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIGxhc3RFcnJvciA9IGxhc3RFcnJvciB8fCBuZXcgRXJyb3IoXCJHb29nbGU6IEtleXMgcHJvdmlkZWQgYnV0IG5vIG1vZGVscyBkZWZpbmVkLlwiKTtcbiAgICAgICAgICAgIGNvbnNvbGUud2FybihsYXN0RXJyb3IubWVzc2FnZSk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoIW9wZW5BSUVuYWJsZWQgJiYgIWdvb2dsZUVuYWJsZWQgJiYgKHRoaXMub3BlbmFpX2tleXMubGVuZ3RoID4gMCB8fCB0aGlzLmdvb2dsZV9rZXlzLmxlbmd0aCA+IDApKSB7XG4gICAgICAgICAgICBuZXcgTm90aWNlKFwiUGxlYXNlIHByb3ZpZGUgQVBJIGtleXMgYW5kIGF0IGxlYXN0IG9uZSBtb2RlbCBuYW1lIGluIHNldHRpbmdzLlwiKTtcbiAgICAgICAgICAgIHRocm93IG5ldyBBbGxNb2RlbHNGYWlsZWRFcnJvcihcIktleXMgcHJvdmlkZWQgYnV0IG5vIG1vZGVscyBkZWZpbmVkLlwiKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRocm93IG5ldyBBbGxNb2RlbHNGYWlsZWRFcnJvcihgQWxsIEFQSSBwcm92aWRlcnMgZmFpbGVkLiBMYXN0IGVycm9yOiAke2xhc3RFcnJvcj8ubWVzc2FnZX1gKTtcbiAgICB9XG59IiwgIi8vIGNyaXRpYy50c1xuXG5pbXBvcnQgS25vd2xlZGdlR3JhcGhQbHVnaW4gZnJvbSAnLi9tYWluJztcbmltcG9ydCB7IEFQSUhhbmRsZXIgfSBmcm9tICcuL2FwaUhhbmRsZXInO1xuXG5leHBvcnQgY2xhc3MgQ3JpdGljIHtcbiAgICBwcml2YXRlIHBsdWdpbjogS25vd2xlZGdlR3JhcGhQbHVnaW47XG4gICAgcHJpdmF0ZSBhcGlIYW5kbGVyOiBBUElIYW5kbGVyO1xuXG4gICAgY29uc3RydWN0b3IocGx1Z2luOiBLbm93bGVkZ2VHcmFwaFBsdWdpbikge1xuICAgICAgICB0aGlzLnBsdWdpbiA9IHBsdWdpbjtcbiAgICAgICAgdGhpcy5hcGlIYW5kbGVyID0gbmV3IEFQSUhhbmRsZXIocGx1Z2luKTsgLy8gQ3JpdGljIGNhbiBoYXZlIGl0cyBvd24gaGFuZGxlciBpZiBuZWVkZWRcbiAgICB9XG5cbiAgICBwdWJsaWMgYXN5bmMganVkZ2UoY29udGVudDogc3RyaW5nKTogUHJvbWlzZTx7IGlzQXBwcm92ZWQ6IGJvb2xlYW4sIHJlYXNvbjogc3RyaW5nIH0+IHtcbiAgICAgICAgaWYgKHRoaXMucGx1Z2luLnNldHRpbmdzLmNyaXRpY19tb2RlID09PSAnYWknKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5fanVkZ2VCeUFJKGNvbnRlbnQpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzLl9qdWRnZUJ5SGV1cmlzdGljKGNvbnRlbnQpO1xuICAgIH1cblxuICAgIHByaXZhdGUgX2p1ZGdlQnlIZXVyaXN0aWMoY29udGVudDogc3RyaW5nKTogeyBpc0FwcHJvdmVkOiBib29sZWFuLCByZWFzb246IHN0cmluZyB9IHtcbiAgICAgICAgY29uc3QgcmVhc29uczogc3RyaW5nW10gPSBbXTtcbiAgICAgICAgY29uc3QgY29udGVudExvd2VyID0gY29udGVudC50b0xvd2VyQ2FzZSgpO1xuXG4gICAgICAgIC8vIDEuIENoZWNrIGZvciByZXF1aXJlZCBoZWFkZXJzXG4gICAgICAgIGNvbnN0IHJlcXVpcmVkSGVhZGVycyA9IHRoaXMucGx1Z2luLnNldHRpbmdzLmNyaXRpY19yZXF1aXJlZF9oZWFkZXJzXG4gICAgICAgICAgICAuc3BsaXQoJ1xcbicpLm1hcChoID0+IGgudHJpbSgpLnRvTG93ZXJDYXNlKCkpLmZpbHRlcihCb29sZWFuKTtcbiAgICAgICAgY29uc3QgbWlzc2luZ0hlYWRlcnMgPSByZXF1aXJlZEhlYWRlcnMuZmlsdGVyKGggPT4gIWNvbnRlbnRMb3dlci5pbmNsdWRlcyhoKSk7XG4gICAgICAgIGlmIChtaXNzaW5nSGVhZGVycy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICByZWFzb25zLnB1c2goYFx1N0YzQVx1NUMxMVx1NUZDNVx1OTcwMFx1NzY4NFx1NjgwN1x1OTg5ODogJHttaXNzaW5nSGVhZGVycy5qb2luKCcsICcpfWApO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gMi4gQ2hlY2sgZm9yIG1pbiBsZW5ndGhcbiAgICAgICAgaWYgKGNvbnRlbnQubGVuZ3RoIDwgdGhpcy5wbHVnaW4uc2V0dGluZ3MuY3JpdGljX21pbl9jb250ZW50X2xlbmd0aCkge1xuICAgICAgICAgICAgcmVhc29ucy5wdXNoKGBcdTUxODVcdTVCQjlcdThGQzdcdTc3RUQgKFx1NUY1M1x1NTI0RDogJHtjb250ZW50Lmxlbmd0aH0sIFx1ODk4MVx1NkM0MjogJHt0aGlzLnBsdWdpbi5zZXR0aW5ncy5jcml0aWNfbWluX2NvbnRlbnRfbGVuZ3RofSlgKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIDMuIENoZWNrIGZvciByZWZ1c2FsIHBhdHRlcm5zXG4gICAgICAgIGNvbnN0IHJlZnVzYWxQYXR0ZXJucyA9IFtcIlx1NEY1Q1x1NEUzQVx1NEUwMD9cdTRFMkFBSVwiLCBcIlx1NEY1Q1x1NEUzQVx1OEJFRFx1OEEwMFx1NkEyMVx1NTc4QlwiLCBcIlx1NjIxMVx1NEUwRFx1ODBGRFwiLCBcIlx1NjIxMVx1NjVFMFx1NkNENVwiLCBcIlx1NUY4OFx1NjJCMVx1NkI0OVwiXTtcbiAgICAgICAgZm9yIChjb25zdCBwYXR0ZXJuIG9mIHJlZnVzYWxQYXR0ZXJucykge1xuICAgICAgICAgICAgaWYgKG5ldyBSZWdFeHAocGF0dGVybiwgJ2knKS50ZXN0KGNvbnRlbnQpKSB7XG4gICAgICAgICAgICAgICAgcmVhc29ucy5wdXNoKGBcdTUzMDVcdTU0MkJBSVx1NjJEMlx1N0VERFx1OEJFRCAoXHU1MzM5XHU5MTREOiAnJHtwYXR0ZXJufScpYCk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBpc0FwcHJvdmVkOiByZWFzb25zLmxlbmd0aCA9PT0gMCxcbiAgICAgICAgICAgIHJlYXNvbjogcmVhc29ucy5sZW5ndGggPiAwID8gcmVhc29ucy5qb2luKCc7ICcpIDogXCJcdTkwMUFcdThGQzdcdTYyNDBcdTY3MDlcdTU0MkZcdTUzRDFcdTVGMEZcdTg5QzRcdTUyMTlcdTY4QzBcdTY3RTVcdTMwMDJcIlxuICAgICAgICB9O1xuICAgIH1cblxuICAgIHByaXZhdGUgYXN5bmMgX2p1ZGdlQnlBSShjb250ZW50OiBzdHJpbmcpOiBQcm9taXNlPHsgaXNBcHByb3ZlZDogYm9vbGVhbiwgcmVhc29uOiBzdHJpbmcgfT4ge1xuICAgICAgICBjb25zdCBwcm9tcHQgPSB0aGlzLnBsdWdpbi5zZXR0aW5ncy5wcm9tcHRfY3JpdGljLnJlcGxhY2UoJ3tjb250ZW50fScsIGNvbnRlbnQpO1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCB0aGlzLmFwaUhhbmRsZXIuY2FsbChwcm9tcHQpO1xuICAgICAgICAgICAgY29uc3QgZGVjaXNpb25NYXRjaCA9IHJlc3BvbnNlLm1hdGNoKC9ERUNJU0lPTjpcXHMqKEtFRVB8RElTQ0FSRCkvaSk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIC8vIFx1MzAxMFx1MzAxMFx1MzAxMCBcdTVERjJcdTRGRUVcdTU5MERcdUZGMUFcdTZERkJcdTUyQTAgL2kgXHU2ODA3XHU1RkQ3XHVGRjBDXHU0RjdGXHU1MTc2XHU0RTBEXHU1MzNBXHU1MjA2XHU1OTI3XHU1QzBGXHU1MTk5IFx1MzAxMVx1MzAxMVx1MzAxMVxuICAgICAgICAgICAgY29uc3QgcmVhc29uTWF0Y2ggPSByZXNwb25zZS5tYXRjaCgvXFxbUkVBU09OOlxccyooW15cXF1dKylcXF0vaSk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGNvbnN0IGlzQXBwcm92ZWQgPSBkZWNpc2lvbk1hdGNoID8gZGVjaXNpb25NYXRjaFsxXS50b1VwcGVyQ2FzZSgpID09PSAnS0VFUCcgOiBmYWxzZTtcbiAgICAgICAgICAgIGNvbnN0IHJlYXNvbiA9IHJlYXNvbk1hdGNoID8gcmVhc29uTWF0Y2hbMV0udHJpbSgpIDogKGlzQXBwcm92ZWQgPyBcIkFJIFx1NjI3OVx1NTFDNlwiIDogXCJBSSBcdTYyRDJcdTdFRERcdUZGMENcdTY3MkFcdTYzRDBcdTRGOUJcdTY2MEVcdTc4NkVcdTc0MDZcdTc1MzFcIik7XG5cbiAgICAgICAgICAgIHJldHVybiB7IGlzQXBwcm92ZWQsIHJlYXNvbiB9O1xuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcihcIkFJIENyaXRpYyBjYWxsIGZhaWxlZDpcIiwgZXJyb3IpO1xuICAgICAgICAgICAgcmV0dXJuIHsgaXNBcHByb3ZlZDogZmFsc2UsIHJlYXNvbjogYEFJIFx1NUJBMVx1NjgzOFx1NTY2OFx1OEMwM1x1NzUyOFx1NTkzMVx1OEQyNTogJHtlcnJvci5tZXNzYWdlfWAgfTtcbiAgICAgICAgfVxuICAgIH1cbn1cbiIsICIvLyByZXZpc2VyLnRzXG5cbmltcG9ydCBLbm93bGVkZ2VHcmFwaFBsdWdpbiBmcm9tICcuL21haW4nO1xuXG5leHBvcnQgY2xhc3MgUmV2aXNlciB7XG4gICAgcHJpdmF0ZSBwbHVnaW46IEtub3dsZWRnZUdyYXBoUGx1Z2luO1xuXG4gICAgY29uc3RydWN0b3IocGx1Z2luOiBLbm93bGVkZ2VHcmFwaFBsdWdpbikge1xuICAgICAgICB0aGlzLnBsdWdpbiA9IHBsdWdpbjtcbiAgICB9XG5cbiAgICBwdWJsaWMgY3JlYXRlUmV2aXNpb25Qcm9tcHQoaWRlYTogc3RyaW5nLCBvcmlnaW5hbENvbnRlbnQ6IHN0cmluZywgcmVqZWN0aW9uUmVhc29uOiBzdHJpbmcpOiBzdHJpbmcge1xuICAgICAgICBsZXQgcHJvbXB0ID0gdGhpcy5wbHVnaW4uc2V0dGluZ3MucHJvbXB0X3JldmlzZXI7XG4gICAgICAgIHByb21wdCA9IHByb21wdC5yZXBsYWNlKCd7Y29uY2VwdH0nLCBpZGVhKTtcbiAgICAgICAgcHJvbXB0ID0gcHJvbXB0LnJlcGxhY2UoJ3tvcmlnaW5hbF9jb250ZW50fScsIG9yaWdpbmFsQ29udGVudCk7XG4gICAgICAgIHByb21wdCA9IHByb21wdC5yZXBsYWNlKCd7cmVqZWN0aW9uX3JlYXNvbn0nLCByZWplY3Rpb25SZWFzb24pO1xuICAgICAgICByZXR1cm4gcHJvbXB0O1xuICAgIH1cbn1cbiIsICIvLyB1dGlscy50cyAoXHU1MzlGXHU1OUNCXHU3QTMzXHU1QjlBXHU3MjQ4KVxuXG5leHBvcnQgZnVuY3Rpb24gc2FuaXRpemVGaWxlbmFtZShuYW1lOiBzdHJpbmcpOiBzdHJpbmcge1xuICAgIC8vIFx1NzlGQlx1OTY2NFx1NjJFQ1x1NTNGN1x1NTNDQVx1NTE3Nlx1NTE4NVx1NUJCOVxuICAgIGxldCBjbGVhbk5hbWUgPSBuYW1lLnJlcGxhY2UoL1xccypcXCguKlxcKS9nLCAnJykudHJpbSgpO1xuICAgIC8vIFx1NzlGQlx1OTY2NFx1NjU4N1x1NEVGNlx1N0NGQlx1N0VERlx1NEUwRFx1NTE0MVx1OEJCOFx1NzY4NFx1NUI1N1x1N0IyNlxuICAgIGNsZWFuTmFtZSA9IGNsZWFuTmFtZS5yZXBsYWNlKC9bXFxcXC8qPzpcIjw+fF0vZywgXCJcIik7XG4gICAgLy8gXHU5NjUwXHU1MjM2XHU5NTdGXHU1RUE2XG4gICAgcmV0dXJuIGNsZWFuTmFtZS5zbGljZSgwLCAxMDApO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZXh0cmFjdE5ld0lkZWFzKGNvbnRlbnQ6IHN0cmluZyk6IHN0cmluZ1tdIHtcbiAgICBjb25zdCBtYXRjaGVzID0gY29udGVudC5tYXRjaCgvXFxbXFxbKFteXFxdXSspXFxdXFxdL2cpO1xuICAgIGlmICghbWF0Y2hlcykge1xuICAgICAgICByZXR1cm4gW107XG4gICAgfVxuICAgIC8vIFx1NEVDRSBbW0xpbmt8QWxpYXNdXSBcdTYyMTYgW1tMaW5rXV0gXHU0RTJEXHU2M0QwXHU1M0Q2IFwiTGlua1wiXG4gICAgY29uc3QgaWRlYXMgPSBtYXRjaGVzLm1hcChtYXRjaCA9PiB7XG4gICAgICAgIHJldHVybiBtYXRjaC5zbGljZSgyLCAtMikuc3BsaXQoJ3wnKVswXS50cmltKCk7XG4gICAgfSk7XG4gICAgcmV0dXJuIFsuLi5uZXcgU2V0KGlkZWFzKV07IC8vIFx1OEZENFx1NTZERVx1NTNCQlx1OTFDRFx1NTQwRVx1NzY4NFx1N0VEM1x1Njc5Q1xufVxuXG5leHBvcnQgZnVuY3Rpb24gY2xlYW5NYXJrZG93bk91dHB1dChjb250ZW50OiBzdHJpbmcpOiBzdHJpbmcge1xuICAgIGNvbnN0IHRyaW1tZWQgPSBjb250ZW50LnRyaW0oKTtcbiAgICBpZiAodHJpbW1lZC5zdGFydHNXaXRoKFwiYGBgbWFya2Rvd25cIikgJiYgdHJpbW1lZC5lbmRzV2l0aChcImBgYFwiKSkge1xuICAgICAgICBsZXQgY2xlYW5lZCA9IHRyaW1tZWQuc3Vic3RyaW5nKFwiYGBgbWFya2Rvd25cIi5sZW5ndGgsIHRyaW1tZWQubGVuZ3RoIC0gXCJgYGBcIi5sZW5ndGgpO1xuICAgICAgICByZXR1cm4gY2xlYW5lZC50cmltKCk7XG4gICAgfVxuICAgIHJldHVybiB0cmltbWVkO1xufVxuIl0sCiAgIm1hcHBpbmdzIjogIjs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUVBLElBQUFBLG1CQUF1Qjs7O0FDQXZCLElBQUFDLG1CQUF1RDs7O0FDQXZELHNCQUFvQztBQUk3QixJQUFNLHVCQUFOLGNBQW1DLHNCQUFNO0FBQUEsRUFzQjVDLFlBQVksS0FBVSxRQUE4QjtBQUNoRCxVQUFNLEdBQUc7QUFuQmI7QUFBQSxTQUFRLGNBQXlDO0FBQUEsTUFDN0MsS0FBSztBQUFBLE1BQ0wsS0FBSztBQUFBLE1BQ0wsS0FBSztBQUFBLE1BQ0wsS0FBSztBQUFBLElBQ1Q7QUFHQTtBQUFBLFNBQVEsaUJBQTZDO0FBQUEsTUFDakQsS0FBSztBQUFBLE1BQ0wsS0FBSztBQUFBLE1BQ0wsS0FBSztBQUFBLE1BQ0wsS0FBSztBQUFBLElBQ1Q7QUFPSSxTQUFLLFNBQVM7QUFFZCxTQUFLLGlCQUFpQixLQUFLLE9BQU8sS0FBSyxJQUFJO0FBQUEsRUFDL0M7QUFBQSxFQUVBLFNBQVM7QUFDTCxVQUFNLEVBQUUsVUFBVSxJQUFJO0FBR3RCLFNBQUssSUFBSSxVQUFVLElBQUksbUJBQW1CLEtBQUssY0FBYztBQUU3RCxjQUFVLE1BQU07QUFDaEIsY0FBVSxTQUFTLFVBQVU7QUFDN0IsY0FBVSxTQUFTLE1BQU0sRUFBRSxNQUFNLDZCQUE2QixDQUFDO0FBRS9ELFVBQU0sU0FBUyxLQUFLLE9BQU8sS0FBSztBQUNoQyxVQUFNLGFBQWEsV0FBVyxPQUFPLFlBQVksT0FBTyxLQUFLLE9BQU8sWUFBWSxRQUFRO0FBR3hGLFFBQUksd0JBQVEsU0FBUyxFQUNoQixRQUFRLFdBQVcsWUFBWSxtQkFBbUIsZUFBZSxFQUNqRSxRQUFRLFVBQVUsRUFDbEI7QUFBQSxNQUFVLFlBQVUsT0FDaEIsY0FBYyxXQUFXLFlBQVksaUJBQWlCLGNBQWMsRUFDcEUsT0FBTyxXQUFXLFNBQVMsRUFDM0IsUUFBUSxNQUFNO0FBQ1gsYUFBSyxPQUFPLE9BQU8sa0JBQWtCO0FBQ3JDLGFBQUssT0FBTztBQUFBLE1BQ2hCLENBQUM7QUFBQSxJQUNMO0FBR0osU0FBSztBQUFBLE1BQ0Q7QUFBQSxNQUNBO0FBQUEsTUFDQTtBQUFBO0FBQUEsTUFDQSxLQUFLLE9BQU8sS0FBSztBQUFBLE1BQ2pCLEtBQUsscUJBQXFCLEtBQUssSUFBSTtBQUFBLElBQ3ZDO0FBRUEsU0FBSztBQUFBLE1BQ0Q7QUFBQSxNQUNBO0FBQUEsTUFDQTtBQUFBO0FBQUEsTUFDQSxLQUFLLE9BQU8sS0FBSztBQUFBLE1BQ2pCLEtBQUssaUJBQWlCLEtBQUssSUFBSTtBQUFBLElBQ25DO0FBRUEsU0FBSztBQUFBLE1BQ0Q7QUFBQSxNQUNBO0FBQUEsTUFDQTtBQUFBO0FBQUEsTUFDQSxLQUFLLE9BQU8sS0FBSztBQUFBLE1BQ2pCLEtBQUssbUJBQW1CLEtBQUssSUFBSTtBQUFBLElBQ3JDO0FBRUEsU0FBSztBQUFBLE1BQ0Q7QUFBQSxNQUNBO0FBQUEsTUFDQTtBQUFBO0FBQUEsTUFDQSxLQUFLLE9BQU8sS0FBSztBQUFBLE1BQ2pCLEtBQUssb0JBQW9CLEtBQUssSUFBSTtBQUFBLElBQ3RDO0FBR0EsU0FBSyxJQUFJLFVBQVUsR0FBRyxtQkFBbUIsS0FBSyxjQUFjO0FBQUEsRUFDaEU7QUFBQSxFQUVBLFVBQVU7QUFDTixVQUFNLEVBQUUsVUFBVSxJQUFJO0FBQ3RCLGNBQVUsTUFBTTtBQUdoQixTQUFLLElBQUksVUFBVSxJQUFJLG1CQUFtQixLQUFLLGNBQWM7QUFBQSxFQUNqRTtBQUFBO0FBQUE7QUFBQTtBQUFBLEVBS1EsbUJBQ0osYUFDQSxLQUNBLE9BQ0EsTUFDQSxVQUNGO0FBQ0UsVUFBTSxlQUFlO0FBQ3JCLFVBQU0sU0FBUyxLQUFLLFlBQVksR0FBRztBQUduQyxVQUFNLGVBQWUsS0FBSyxPQUFPLFVBQVE7QUFDckMsVUFBSSxDQUFDO0FBQVEsZUFBTztBQUNwQixZQUFNLFNBQVMsT0FBTyxZQUFZO0FBQ2xDLFVBQUksT0FBTyxTQUFTLFVBQVU7QUFDMUIsZUFBTyxLQUFLLFlBQVksRUFBRSxTQUFTLE1BQU07QUFBQSxNQUM3QztBQUNBLGFBQVEsS0FBa0IsS0FBSyxZQUFZLEVBQUUsU0FBUyxNQUFNO0FBQUEsSUFDaEUsQ0FBQztBQUVELFVBQU0sUUFBUSxLQUFLO0FBQ25CLFVBQU0sZ0JBQWdCLGFBQWE7QUFDbkMsVUFBTSxZQUFZLEdBQUcsVUFBVSxnQkFBZ0IsVUFBVSxnQkFBZ0IsUUFBUSxRQUFRO0FBR3pGLFVBQU0sVUFBVSxZQUFZLFNBQVMsU0FBUztBQUM5QyxZQUFRLE9BQU8sS0FBSyxlQUFlLEdBQUc7QUFHdEMsVUFBTSxVQUFVLFFBQVEsU0FBUyxXQUFXLEVBQUUsTUFBTSxVQUFVLENBQUM7QUFDL0QsWUFBUSxTQUFTLGtCQUFrQjtBQUduQyxZQUFRLGlCQUFpQixVQUFVLE1BQU07QUFDckMsV0FBSyxlQUFlLEdBQUcsSUFBSSxRQUFRO0FBQUEsSUFDdkMsQ0FBQztBQUdELFFBQUksd0JBQVEsT0FBTyxFQUNkLFFBQVEsVUFBVSxVQUFVLEVBQzVCLFFBQVEsVUFBUTtBQUNiLFdBQUssZUFBZSxtQkFBbUIsRUFDbEMsU0FBUyxLQUFLLFlBQVksR0FBRyxDQUFDLEVBQzlCLFNBQVMsV0FBUztBQUNmLGFBQUssWUFBWSxHQUFHLElBQUk7QUFDeEIsYUFBSyxPQUFPO0FBQUEsTUFDaEIsQ0FBQztBQUFBLElBQ1QsQ0FBQztBQUdMLFVBQU0sZ0JBQWdCLGFBQWEsTUFBTSxHQUFHLFlBQVk7QUFFeEQsUUFBSSxjQUFjLFdBQVcsR0FBRztBQUM1QixZQUFNLE9BQU8sUUFBUSxTQUFTLEtBQUssRUFBRSxNQUFNLHVDQUF1QyxLQUFLLDJCQUEyQixDQUFDO0FBQ25ILFdBQUssU0FBUyxxQkFBcUI7QUFDbkM7QUFBQSxJQUNKO0FBR0EsVUFBTSxnQkFBZ0IsUUFBUSxVQUFVLG1CQUFtQjtBQUUzRCxrQkFBYyxRQUFRLENBQUMsTUFBTSxVQUFVO0FBQ25DLGVBQVMsZUFBZSxNQUFNLEtBQUs7QUFBQSxJQUN2QyxDQUFDO0FBR0QsUUFBSSxhQUFhLFNBQVMsY0FBYztBQUNwQyxZQUFNLGdCQUFnQixRQUFRLFNBQVMsS0FBSztBQUFBLFFBQ3hDLE1BQU0scUJBQXFCLDZCQUE2QixhQUFhO0FBQUEsUUFDckUsS0FBSztBQUFBLE1BQ1QsQ0FBQztBQUNELG9CQUFjLFNBQVMseUJBQXlCO0FBQUEsSUFDcEQ7QUFBQSxFQUNKO0FBQUE7QUFBQSxFQUlRLHFCQUFxQixXQUF3QixNQUF5QjtBQUUxRSxVQUFNLFdBQVcsT0FBTyxTQUFTLFdBQVcsT0FBUSxLQUFrQjtBQUV0RSxRQUFJLHdCQUFRLFNBQVMsRUFDaEIsUUFBUSxRQUFRLEVBQ2hCO0FBQUEsTUFBVSxTQUFPLElBQ2IsUUFBUSxPQUFPLEVBQ2YsV0FBVyxnQkFBZ0IsRUFDM0IsUUFBUSxZQUFZO0FBQ2pCLGNBQU0sUUFBUSxLQUFLLE9BQU8sS0FBSztBQUUvQixjQUFNLFFBQVEsTUFBTSxRQUFRLFFBQVE7QUFDcEMsWUFBSSxRQUFRLElBQUk7QUFDWixnQkFBTSxPQUFPLE9BQU8sQ0FBQztBQUNyQixnQkFBTSxLQUFLLE9BQU8sZUFBZTtBQUNqQyxlQUFLLE9BQU8sT0FBTyxnQkFBZ0I7QUFDbkMsZUFBSyxPQUFPO0FBQUEsUUFDaEI7QUFBQSxNQUNKLENBQUM7QUFBQTtBQUFBLElBQ0w7QUFBQSxFQUNSO0FBQUEsRUFFUSxpQkFBaUIsV0FBd0IsTUFBeUI7QUFDdEUsVUFBTSxPQUFPO0FBQ2IsUUFBSSx3QkFBUSxTQUFTLEVBQ2hCLFFBQVEsWUFBWSxLQUFLLE1BQU0sRUFDL0I7QUFBQSxNQUFVLFNBQU8sSUFDYixRQUFRLE9BQU8sRUFDZixXQUFXLGNBQWMsRUFDekIsUUFBUSxZQUFZO0FBQ2pCLGFBQUssT0FBTyxLQUFLLFlBQVksT0FBTyxLQUFLLE9BQU8sS0FBSyxZQUFZLFFBQVEsSUFBSSxHQUFHLENBQUM7QUFDakYsYUFBSyxPQUFPLEtBQUssY0FBYyxLQUFLLElBQUk7QUFDeEMsY0FBTSxLQUFLLE9BQU8sZUFBZTtBQUNqQyxhQUFLLE9BQU8sT0FBTyxnQkFBZ0I7QUFDbkMsYUFBSyxPQUFPO0FBQUEsTUFDaEIsQ0FBQztBQUFBLElBQ0w7QUFBQSxFQUNSO0FBQUEsRUFFUSxtQkFBbUIsV0FBd0IsTUFBeUI7QUFDeEUsVUFBTSxPQUFPO0FBQ2IsUUFBSSx3QkFBUSxTQUFTLEVBQ2hCLFFBQVEsY0FBYyxLQUFLLE1BQU0sRUFDakMsUUFBUSxXQUFXLEtBQUssVUFBVSxXQUFXLEVBQzdDO0FBQUEsTUFBVSxTQUFPLElBQ2IsUUFBUSxPQUFPLEVBQ2YsV0FBVyxjQUFjLEVBQ3pCLFFBQVEsWUFBWTtBQUNqQixhQUFLLE9BQU8sS0FBSyxjQUFjLE9BQU8sS0FBSyxPQUFPLEtBQUssY0FBYyxRQUFRLElBQUksR0FBRyxDQUFDO0FBQ3JGLGFBQUssT0FBTyxLQUFLLGNBQWMsS0FBSyxJQUFJO0FBQ3hDLGNBQU0sS0FBSyxPQUFPLGVBQWU7QUFDakMsYUFBSyxPQUFPLE9BQU8sZ0JBQWdCO0FBQ25DLGFBQUssT0FBTztBQUFBLE1BQ2hCLENBQUM7QUFBQSxJQUNMO0FBQUEsRUFDUjtBQUFBLEVBRVEsb0JBQW9CLFdBQXdCLE1BQXlCO0FBQ3pFLFVBQU0sT0FBTztBQUNiLFFBQUksd0JBQVEsU0FBUyxFQUNoQixRQUFRLGVBQWUsS0FBSyxNQUFNLEVBQ2xDLFFBQVEsZ0JBQWdCLEtBQUssVUFBVSxXQUFXLEVBQ2xEO0FBQUEsTUFBVSxTQUFPLElBQ2IsUUFBUSxZQUFZLEVBQ3BCLFdBQVcsdUJBQXVCLEVBQ2xDLFFBQVEsWUFBWTtBQUNqQixhQUFLLE9BQU8sS0FBSyxjQUFjLE9BQU8sS0FBSyxPQUFPLEtBQUssY0FBYyxRQUFRLElBQUksR0FBRyxDQUFDO0FBQ3JGLGFBQUssT0FBTyxPQUFPLG1CQUFtQixDQUFDLEtBQUssSUFBSSxDQUFDO0FBQ2pELGFBQUssT0FBTztBQUFBLE1BQ2hCLENBQUM7QUFBQSxJQUNMO0FBQUEsRUFDUjtBQUNKOzs7QUQzUEEsSUFBTSwyQkFBMkI7QUFDakMsSUFBTSx3QkFBd0I7QUFDOUIsSUFBTSx5QkFBeUI7QUFHeEIsSUFBTSxtQkFBaUQ7QUFBQTtBQUFBLEVBRTFELGlCQUFpQjtBQUFBLEVBQ2pCLGlCQUFpQjtBQUFBLEVBQ2pCLGNBQWM7QUFBQSxFQUNkLHFCQUFxQjtBQUFBLEVBQ3JCLGlCQUFpQjtBQUFBLEVBQ2pCLGNBQWM7QUFBQSxFQUNkLHFCQUFxQjtBQUFBLEVBQ3JCLDJCQUEyQjtBQUFBO0FBQUEsRUFHM0Isd0JBQXdCO0FBQUEsRUFDeEIsdUJBQXVCO0FBQUE7QUFBQSxFQUd2QixZQUFZO0FBQUE7QUFBQSxFQUdaLHVCQUF1QjtBQUFBLEVBQ3ZCLGVBQWU7QUFBQTtBQUFBLEVBR2YsYUFBYTtBQUFBLEVBQ2IseUJBQXlCO0FBQUEsRUFDekIsMkJBQTJCO0FBQUE7QUFBQSxFQUczQixzQkFBc0I7QUFBQTtBQUFBLEVBR3RCLGtCQUFrQjtBQUFBLEVBQ2xCLGVBQWU7QUFBQSxFQUNmLGdCQUFnQjtBQUFBO0FBQUEsRUFHaEIsY0FBYztBQUFBO0FBQUEsRUFHZCxzQkFBc0I7QUFDMUI7QUFHTyxTQUFTLG9CQUFvQjtBQUNoQyxTQUFPO0FBQUEsSUFDSCxrQkFBa0I7QUFBQSxJQUNsQixlQUFlO0FBQUEsSUFDZixnQkFBZ0I7QUFBQSxFQUNwQjtBQUNKO0FBR08sSUFBTSxnQkFBTixjQUE0QixrQ0FBaUI7QUFBQSxFQUdoRCxZQUFZLEtBQVUsUUFBOEI7QUFDaEQsVUFBTSxLQUFLLE1BQU07QUFDakIsU0FBSyxTQUFTO0FBQUEsRUFDbEI7QUFBQSxFQUVBLFVBQWdCO0FBQ1osVUFBTSxFQUFFLFlBQVksSUFBSTtBQUN4QixnQkFBWSxNQUFNO0FBR2xCLFFBQUkseUJBQVEsV0FBVyxFQUNsQixRQUFRLG9DQUFvQyxFQUM1QyxXQUFXO0FBR2hCLFFBQUkseUJBQVEsV0FBVyxFQUNsQixRQUFRLGtCQUFrQixFQUMxQixRQUFRLGlEQUFpRCxFQUN6RDtBQUFBLE1BQVUsWUFBVSxPQUNoQixjQUFjLG9CQUFvQixFQUNsQyxPQUFPLEVBQ1AsUUFBUSxNQUFNO0FBQ1gsWUFBSSxxQkFBcUIsS0FBSyxLQUFLLEtBQUssTUFBTSxFQUFFLEtBQUs7QUFBQSxNQUN6RCxDQUFDO0FBQUEsSUFDTDtBQUdKLFFBQUkseUJBQVEsV0FBVyxFQUFFLFFBQVEsY0FBYyxFQUFFLFdBQVc7QUFFNUQsUUFBSSx5QkFBUSxXQUFXLEVBQUUsUUFBUSxRQUFRLEVBQUUsV0FBVztBQUV0RCxRQUFJLHlCQUFRLFdBQVcsRUFDbEIsUUFBUSxpQkFBaUIsRUFDekIsUUFBUSxtQkFBbUIsRUFDM0IsWUFBWSxVQUFRLEtBQ2hCLGVBQWUsUUFBUSxFQUN2QixTQUFTLEtBQUssT0FBTyxTQUFTLGVBQWUsRUFDN0MsU0FBUyxPQUFPLFVBQVU7QUFDdkIsV0FBSyxPQUFPLFNBQVMsa0JBQWtCO0FBQ3ZDLFlBQU0sS0FBSyxPQUFPLGFBQWE7QUFBQSxJQUNuQyxDQUFDLENBQUM7QUFFVixRQUFJLHlCQUFRLFdBQVcsRUFDbEIsUUFBUSxpQkFBaUIsRUFDekIsUUFBUSwwQkFBMEIsRUFDbEMsUUFBUSxVQUFRLEtBQ1osZUFBZSwyQkFBMkIsRUFDMUMsU0FBUyxLQUFLLE9BQU8sU0FBUyxlQUFlLEVBQzdDLFNBQVMsT0FBTyxVQUFVO0FBQ3ZCLFdBQUssT0FBTyxTQUFTLGtCQUFrQixNQUFNLEtBQUs7QUFDbEQsWUFBTSxLQUFLLE9BQU8sYUFBYTtBQUFBLElBQ25DLENBQUMsQ0FBQztBQUVWLFFBQUkseUJBQVEsV0FBVyxFQUNsQixRQUFRLHdCQUF3QixFQUNoQyxRQUFRLHFCQUFxQixFQUM3QixRQUFRLFVBQVEsS0FDWixlQUFlLHFCQUFxQixFQUNwQyxTQUFTLEtBQUssT0FBTyxTQUFTLFlBQVksRUFDMUMsU0FBUyxPQUFPLFVBQVU7QUFDdkIsV0FBSyxPQUFPLFNBQVMsZUFBZSxNQUFNLEtBQUs7QUFDL0MsWUFBTSxLQUFLLE9BQU8sYUFBYTtBQUFBLElBQ25DLENBQUMsQ0FBQztBQUVWLFFBQUkseUJBQVEsV0FBVyxFQUNsQixRQUFRLHFCQUFxQixFQUM3QixRQUFRLDBCQUEwQixFQUNsQyxRQUFRLFVBQVEsS0FDWixlQUFlLGVBQWUsRUFDOUIsU0FBUyxLQUFLLE9BQU8sU0FBUyxtQkFBbUIsRUFDakQsU0FBUyxPQUFPLFVBQVU7QUFDdkIsV0FBSyxPQUFPLFNBQVMsc0JBQXNCLE1BQU0sS0FBSztBQUN0RCxZQUFNLEtBQUssT0FBTyxhQUFhO0FBQUEsSUFDbkMsQ0FBQyxDQUFDO0FBRVYsUUFBSSx5QkFBUSxXQUFXLEVBQUUsUUFBUSxlQUFlLEVBQUUsV0FBVztBQUU3RCxRQUFJLHlCQUFRLFdBQVcsRUFDbEIsUUFBUSx3QkFBd0IsRUFDaEMsUUFBUSxtQkFBbUIsRUFDM0IsWUFBWSxVQUFRLEtBQ2hCLGVBQWUsV0FBVyxFQUMxQixTQUFTLEtBQUssT0FBTyxTQUFTLGVBQWUsRUFDN0MsU0FBUyxPQUFPLFVBQVU7QUFDdkIsV0FBSyxPQUFPLFNBQVMsa0JBQWtCO0FBQ3ZDLFlBQU0sS0FBSyxPQUFPLGFBQWE7QUFBQSxJQUNuQyxDQUFDLENBQUM7QUFFVixRQUFJLHlCQUFRLFdBQVcsRUFDbEIsUUFBUSwrQkFBK0IsRUFDdkMsUUFBUSxxQkFBcUIsRUFDN0IsUUFBUSxVQUFRLEtBQ1osZUFBZSx1QkFBdUIsRUFDdEMsU0FBUyxLQUFLLE9BQU8sU0FBUyxZQUFZLEVBQzFDLFNBQVMsT0FBTyxVQUFVO0FBQ3ZCLFdBQUssT0FBTyxTQUFTLGVBQWUsTUFBTSxLQUFLO0FBQy9DLFlBQU0sS0FBSyxPQUFPLGFBQWE7QUFBQSxJQUNuQyxDQUFDLENBQUM7QUFFVixRQUFJLHlCQUFRLFdBQVcsRUFDbEIsUUFBUSw0QkFBNEIsRUFDcEMsUUFBUSwwQkFBMEIsRUFDbEMsUUFBUSxVQUFRLEtBQ1osZUFBZSxnQkFBZ0IsRUFDL0IsU0FBUyxLQUFLLE9BQU8sU0FBUyxtQkFBbUIsRUFDakQsU0FBUyxPQUFPLFVBQVU7QUFDdkIsV0FBSyxPQUFPLFNBQVMsc0JBQXNCLE1BQU0sS0FBSztBQUN0RCxZQUFNLEtBQUssT0FBTyxhQUFhO0FBQUEsSUFDbkMsQ0FBQyxDQUFDO0FBRVYsUUFBSSx5QkFBUSxXQUFXLEVBQ2xCLFFBQVEsd0JBQXdCLEVBQ2hDLFFBQVEsOEJBQThCLEVBQ3RDLFFBQVEsVUFBUSxLQUNaLFNBQVMsT0FBTyxLQUFLLE9BQU8sU0FBUyx5QkFBeUIsQ0FBQyxFQUMvRCxTQUFTLE9BQU8sVUFBVTtBQUN2QixZQUFNLE1BQU0sU0FBUyxPQUFPLEVBQUU7QUFDOUIsVUFBSSxDQUFDLE1BQU0sR0FBRyxLQUFLLE9BQU8sR0FBRztBQUN6QixhQUFLLE9BQU8sU0FBUyw0QkFBNEI7QUFDakQsY0FBTSxLQUFLLE9BQU8sYUFBYTtBQUFBLE1BQ25DO0FBQUEsSUFDSixDQUFDLENBQUM7QUFHVixRQUFJLHlCQUFRLFdBQVcsRUFBRSxRQUFRLGdCQUFnQixFQUFFLFdBQVc7QUFDOUQsUUFBSSx5QkFBUSxXQUFXLEVBQ2xCLFFBQVEsd0JBQXdCLEVBQ2hDLFFBQVEseUNBQXlDLEVBQ2pELFFBQVEsVUFBUSxLQUNaLFNBQVMsT0FBTyxLQUFLLE9BQU8sU0FBUyxzQkFBc0IsQ0FBQyxFQUM1RCxTQUFTLE9BQU8sVUFBVTtBQUN2QixZQUFNLE1BQU0sV0FBVyxLQUFLO0FBQzVCLFVBQUksQ0FBQyxNQUFNLEdBQUcsS0FBSyxPQUFPLEtBQUssT0FBTyxHQUFHO0FBQ3JDLGFBQUssT0FBTyxTQUFTLHlCQUF5QjtBQUM5QyxjQUFNLEtBQUssT0FBTyxhQUFhO0FBQUEsTUFDbkM7QUFBQSxJQUNKLENBQUMsQ0FBQztBQUVWLFFBQUkseUJBQVEsV0FBVyxFQUNsQixRQUFRLFlBQVksRUFDcEIsUUFBUSw4QkFBOEIsRUFDdEMsUUFBUSxVQUFRLEtBQ1osU0FBUyxPQUFPLEtBQUssT0FBTyxTQUFTLHFCQUFxQixDQUFDLEVBQzNELFNBQVMsT0FBTyxVQUFVO0FBQ3ZCLFlBQU0sTUFBTSxTQUFTLE9BQU8sRUFBRTtBQUM5QixVQUFJLENBQUMsTUFBTSxHQUFHLEtBQUssTUFBTSxHQUFHO0FBQ3hCLGFBQUssT0FBTyxTQUFTLHdCQUF3QjtBQUM3QyxjQUFNLEtBQUssT0FBTyxhQUFhO0FBQUEsTUFDbkM7QUFBQSxJQUNKLENBQUMsQ0FBQztBQUdWLFFBQUkseUJBQVEsV0FBVyxFQUFFLFFBQVEsaUJBQWlCLEVBQUUsV0FBVztBQUMvRCxRQUFJLHlCQUFRLFdBQVcsRUFDbEIsUUFBUSxlQUFlLEVBQ3ZCLFFBQVEsMkJBQTJCLEVBQ25DLFFBQVEsVUFBUSxLQUNaLGVBQWUscUJBQXFCLEVBQ3BDLFNBQVMsS0FBSyxPQUFPLFNBQVMsVUFBVSxFQUN4QyxTQUFTLE9BQU8sVUFBVTtBQUN2QixXQUFLLE9BQU8sU0FBUyxhQUFhLE1BQU0sS0FBSyxFQUFFLFFBQVEsT0FBTyxFQUFFO0FBQ2hFLFlBQU0sS0FBSyxPQUFPLGFBQWE7QUFBQSxJQUNuQyxDQUFDLENBQUM7QUFFVixRQUFJLHlCQUFRLFdBQVcsRUFDbEIsUUFBUSx1QkFBdUIsRUFDL0IsUUFBUSw0QkFBNEIsRUFDcEMsUUFBUSxVQUFRLEtBQ1osU0FBUyxPQUFPLEtBQUssT0FBTyxTQUFTLHFCQUFxQixDQUFDLEVBQzNELFNBQVMsT0FBTyxVQUFVO0FBQ3ZCLFlBQU0sTUFBTSxTQUFTLE9BQU8sRUFBRTtBQUM5QixVQUFJLENBQUMsTUFBTSxHQUFHLEtBQUssTUFBTSxHQUFHO0FBQ3hCLGFBQUssT0FBTyxTQUFTLHdCQUF3QjtBQUM3QyxjQUFNLEtBQUssT0FBTyxhQUFhO0FBQUEsTUFDbkM7QUFBQSxJQUNKLENBQUMsQ0FBQztBQUVWLFFBQUkseUJBQVEsV0FBVyxFQUNsQixRQUFRLHlCQUF5QixFQUNqQyxRQUFRLDRCQUE0QixFQUNwQyxRQUFRLFVBQVEsS0FDWixTQUFTLE9BQU8sS0FBSyxPQUFPLFNBQVMsYUFBYSxDQUFDLEVBQ25ELFNBQVMsT0FBTyxVQUFVO0FBQ3ZCLFlBQU0sTUFBTSxTQUFTLE9BQU8sRUFBRTtBQUM5QixVQUFJLENBQUMsTUFBTSxHQUFHLEtBQUssT0FBTyxHQUFHO0FBQ3pCLGFBQUssT0FBTyxTQUFTLGdCQUFnQjtBQUNyQyxjQUFNLEtBQUssT0FBTyxhQUFhO0FBQUEsTUFDbkM7QUFBQSxJQUNKLENBQUMsQ0FBQztBQUVWLFFBQUkseUJBQVEsV0FBVyxFQUNsQixRQUFRLHNCQUFzQixFQUM5QixRQUFRLHFDQUFxQyxFQUM3QyxRQUFRLFVBQVEsS0FDWixTQUFTLE9BQU8sS0FBSyxPQUFPLFNBQVMsb0JBQW9CLENBQUMsRUFDMUQsU0FBUyxPQUFPLFVBQVU7QUFDdkIsWUFBTSxNQUFNLFNBQVMsT0FBTyxFQUFFO0FBQzlCLFVBQUksQ0FBQyxNQUFNLEdBQUcsS0FBSyxPQUFPLEdBQUc7QUFDekIsYUFBSyxPQUFPLFNBQVMsdUJBQXVCO0FBQzVDLGNBQU0sS0FBSyxPQUFPLGFBQWE7QUFBQSxNQUNuQztBQUFBLElBQ0osQ0FBQyxDQUFDO0FBRVYsUUFBSSx5QkFBUSxXQUFXLEVBQ2xCLFFBQVEsc0JBQXNCLEVBQzlCLFFBQVEsMEVBQTBFLEVBQ2xGO0FBQUEsTUFBVSxZQUFVLE9BQ2hCLFNBQVMsS0FBSyxPQUFPLFNBQVMsb0JBQW9CLEVBQ2xELFNBQVMsT0FBTyxVQUFVO0FBQ3ZCLGFBQUssT0FBTyxTQUFTLHVCQUF1QjtBQUM1QyxjQUFNLEtBQUssT0FBTyxhQUFhO0FBQUEsTUFDbkMsQ0FBQztBQUFBLElBQ0w7QUFHSixRQUFJLHlCQUFRLFdBQVcsRUFDbEIsUUFBUSxhQUFhLEVBQ3JCLFFBQVEsa0VBQWtFLEVBQzFFLFlBQVksY0FBWSxTQUNwQixVQUFVLGFBQWEsV0FBVyxFQUNsQyxVQUFVLE1BQU0sOEJBQThCLEVBQzlDLFNBQVMsS0FBSyxPQUFPLFNBQVMsV0FBVyxFQUN6QyxTQUFTLE9BQU8sVUFBOEI7QUFDM0MsV0FBSyxPQUFPLFNBQVMsY0FBYztBQUNuQyxZQUFNLEtBQUssT0FBTyxhQUFhO0FBQy9CLFdBQUssUUFBUTtBQUFBLElBQ2pCLENBQUMsQ0FBQztBQUVWLFFBQUksS0FBSyxPQUFPLFNBQVMsZ0JBQWdCLGFBQWE7QUFDbEQsVUFBSSx5QkFBUSxXQUFXLEVBQ2xCLFFBQVEsNkJBQTZCLEVBQ3JDLFFBQVEsa0RBQWtELEVBQzFELFlBQVksVUFBUTtBQUNqQixhQUFLLFNBQVMsS0FBSyxPQUFPLFNBQVMsdUJBQXVCLEVBQ3JELFNBQVMsT0FBTyxVQUFVO0FBQ3ZCLGVBQUssT0FBTyxTQUFTLDBCQUEwQjtBQUMvQyxnQkFBTSxLQUFLLE9BQU8sYUFBYTtBQUFBLFFBQ25DLENBQUM7QUFDTCxhQUFLLFFBQVEsU0FBUyxtQkFBbUI7QUFBQSxNQUM3QyxDQUFDO0FBRUwsVUFBSSx5QkFBUSxXQUFXLEVBQ2xCLFFBQVEsK0JBQStCLEVBQ3ZDLFFBQVEsMEJBQTBCLEVBQ2xDLFFBQVEsVUFBUSxLQUNaLFNBQVMsT0FBTyxLQUFLLE9BQU8sU0FBUyx5QkFBeUIsQ0FBQyxFQUMvRCxTQUFTLE9BQU8sVUFBVTtBQUN2QixjQUFNLE1BQU0sU0FBUyxPQUFPLEVBQUU7QUFDOUIsWUFBSSxDQUFDLE1BQU0sR0FBRyxLQUFLLE9BQU8sR0FBRztBQUN6QixlQUFLLE9BQU8sU0FBUyw0QkFBNEI7QUFDakQsZ0JBQU0sS0FBSyxPQUFPLGFBQWE7QUFBQSxRQUNuQztBQUFBLE1BQ0osQ0FBQyxDQUFDO0FBQUEsSUFDZDtBQUdBLFFBQUkseUJBQVEsV0FBVyxFQUFFLFFBQVEsaUJBQWlCLEVBQUUsV0FBVztBQUMvRCxRQUFJLHlCQUFRLFdBQVcsRUFDbEIsUUFBUSxVQUFVLEVBQ2xCLFFBQVEsb0NBQW9DLEVBQzVDLFlBQVksVUFBUTtBQUNqQixXQUFLLGVBQWUsc0NBQXNDLEVBQ3JELFNBQVMsS0FBSyxPQUFPLFNBQVMsWUFBWSxFQUMxQyxTQUFTLE9BQU8sVUFBVTtBQUN2QixhQUFLLE9BQU8sU0FBUyxlQUFlO0FBQ3BDLGNBQU0sS0FBSyxPQUFPLGFBQWE7QUFBQSxNQUNuQyxDQUFDO0FBQ0wsV0FBSyxRQUFRLFNBQVMsb0JBQW9CO0FBQUEsSUFDOUMsQ0FBQztBQUVMLFFBQUkseUJBQVEsV0FBVyxFQUNsQjtBQUFBLE1BQVUsWUFBVSxPQUNoQixjQUFjLGVBQWUsRUFDN0IsT0FBTyxFQUNQLFFBQVEsWUFBWTtBQUNqQixjQUFNLFVBQVUsS0FBSyxPQUFPLFNBQVM7QUFDckMsWUFBSSxDQUFDLFFBQVEsS0FBSyxHQUFHO0FBQ2pCLGNBQUksd0JBQU8sb0JBQW9CO0FBQy9CO0FBQUEsUUFDSjtBQUNBLGNBQU0saUJBQWlCLENBQUMsR0FBRyxJQUFJO0FBQUEsVUFDM0IsUUFBUSxNQUFNLElBQUksRUFBRSxJQUFJLFVBQVEsS0FBSyxLQUFLLENBQUMsRUFBRSxPQUFPLE9BQU87QUFBQSxRQUMvRCxDQUFDO0FBRUQsY0FBTSxhQUFhLEtBQUssT0FBTyxPQUFPLG1CQUFtQixjQUFjO0FBQ3ZFLGNBQU0sZUFBZSxlQUFlLFNBQVM7QUFFN0MsWUFBSSxnQkFBZ0IsU0FBUztBQUM3QixZQUFJLGVBQWUsR0FBRztBQUNsQiwyQkFBaUI7QUFBQSxFQUFLO0FBQUEsUUFDMUI7QUFDQSxZQUFJLHdCQUFPLGVBQWUsR0FBSTtBQUc5QixhQUFLLE9BQU8sU0FBUyxlQUFlO0FBQ3BDLGNBQU0sS0FBSyxPQUFPLGFBQWE7QUFDL0IsYUFBSyxRQUFRO0FBQUEsTUFDakIsQ0FBQztBQUFBLElBQ0w7QUFHSixRQUFJLHlCQUFRLFdBQVcsRUFBRSxRQUFRLGtCQUFrQixFQUFFLFdBQVc7QUFFaEUsUUFBSSx5QkFBUSxXQUFXLEVBQ2xCLFFBQVEsa0JBQWtCLEVBQzFCLFFBQVEsb0NBQW9DLEVBQzVDLFlBQVksVUFBUTtBQUNqQixXQUFLLFNBQVMsS0FBSyxPQUFPLFNBQVMsZ0JBQWdCLEVBQzlDLFNBQVMsT0FBTyxVQUFVO0FBQ3ZCLGFBQUssT0FBTyxTQUFTLG1CQUFtQjtBQUN4QyxjQUFNLEtBQUssT0FBTyxhQUFhO0FBQUEsTUFDbkMsQ0FBQztBQUNMLFdBQUssUUFBUSxTQUFTLGtCQUFrQjtBQUFBLElBQzVDLENBQUM7QUFFTCxRQUFJLEtBQUssT0FBTyxTQUFTLGdCQUFnQixNQUFNO0FBQzNDLFVBQUkseUJBQVEsV0FBVyxFQUNsQixRQUFRLGVBQWUsRUFDdkIsUUFBUSwrQkFBK0IsRUFDdkMsWUFBWSxVQUFRO0FBQ2pCLGFBQUssU0FBUyxLQUFLLE9BQU8sU0FBUyxhQUFhLEVBQzNDLFNBQVMsT0FBTyxVQUFVO0FBQ3ZCLGVBQUssT0FBTyxTQUFTLGdCQUFnQjtBQUNyQyxnQkFBTSxLQUFLLE9BQU8sYUFBYTtBQUFBLFFBQ25DLENBQUM7QUFDTCxhQUFLLFFBQVEsU0FBUyxrQkFBa0I7QUFBQSxNQUM1QyxDQUFDO0FBQUEsSUFDVDtBQUVBLFFBQUkseUJBQVEsV0FBVyxFQUNsQixRQUFRLGdCQUFnQixFQUN4QixRQUFRLHVDQUF1QyxFQUMvQyxZQUFZLFVBQVE7QUFDakIsV0FBSyxTQUFTLEtBQUssT0FBTyxTQUFTLGNBQWMsRUFDNUMsU0FBUyxPQUFPLFVBQVU7QUFDdkIsYUFBSyxPQUFPLFNBQVMsaUJBQWlCO0FBQ3RDLGNBQU0sS0FBSyxPQUFPLGFBQWE7QUFBQSxNQUNuQyxDQUFDO0FBQ0wsV0FBSyxRQUFRLFNBQVMsa0JBQWtCO0FBQUEsSUFDNUMsQ0FBQztBQUFBLEVBQ1Q7QUFDSjs7O0FFdlpBLElBQUFDLG1CQUEyRDs7O0FDQTNELElBQUFDLG1CQUFtQztBQUk1QixJQUFNLHVCQUFOLGNBQW1DLE1BQU07QUFBQSxFQUM1QyxZQUFZLFNBQWlCO0FBQ3pCLFVBQU0sT0FBTztBQUNiLFNBQUssT0FBTztBQUFBLEVBQ2hCO0FBQ0o7QUFFTyxJQUFNLHVCQUFOLGNBQW1DLE1BQU07QUFBQSxFQUM1QyxZQUFZLFNBQWlCO0FBQ3pCLFVBQU0sT0FBTztBQUNiLFNBQUssT0FBTztBQUFBLEVBQ2hCO0FBQ0o7QUFFTyxJQUFNLGFBQU4sTUFBaUI7QUFBQSxFQVlwQixZQUFZLFFBQThCO0FBUjFDLFNBQVEsY0FBd0IsQ0FBQztBQUNqQyxTQUFRLGNBQXdCLENBQUM7QUFFakMsU0FBUSxpQkFBaUIsb0JBQUksSUFBNEI7QUFDekQsU0FBUSxpQkFBaUIsb0JBQUksSUFBNEI7QUFFekQsU0FBUSxzQkFBK0I7QUFHbkMsU0FBSyxTQUFTO0FBQ2QsU0FBSyxXQUFXLE9BQU87QUFDdkIsU0FBSyxXQUFXO0FBQUEsRUFDcEI7QUFBQSxFQUVPLGFBQW1CO0FBQ3RCLFNBQUssY0FBYyxLQUFLLFNBQVMsZ0JBQWdCLE1BQU0sSUFBSSxFQUFFLElBQUksQ0FBQyxNQUFNLEVBQUUsS0FBSyxDQUFDLEVBQUUsT0FBTyxPQUFPO0FBQ2hHLFNBQUssY0FBYyxLQUFLLFNBQVMsZ0JBQWdCLE1BQU0sSUFBSSxFQUFFLElBQUksQ0FBQyxNQUFNLEVBQUUsS0FBSyxDQUFDLEVBQUUsT0FBTyxPQUFPO0FBRWhHLFNBQUssWUFBWSxRQUFRLENBQUMsUUFBUTtBQUM5QixVQUFJLENBQUMsS0FBSyxlQUFlLElBQUksR0FBRyxHQUFHO0FBQy9CLGFBQUssZUFBZSxJQUFJLEtBQUssRUFBRSxPQUFPLEdBQUcsZ0JBQWdCLEVBQUUsQ0FBQztBQUFBLE1BQ2hFO0FBQUEsSUFDSixDQUFDO0FBQ0QsU0FBSyxZQUFZLFFBQVEsQ0FBQyxRQUFRO0FBQzlCLFVBQUksQ0FBQyxLQUFLLGVBQWUsSUFBSSxHQUFHLEdBQUc7QUFDL0IsYUFBSyxlQUFlLElBQUksS0FBSyxFQUFFLE9BQU8sR0FBRyxnQkFBZ0IsRUFBRSxDQUFDO0FBQUEsTUFDaEU7QUFBQSxJQUNKLENBQUM7QUFBQSxFQUNMO0FBQUEsRUFFUSxXQUFXLE1BQWdCLFVBQThDO0FBQzdFLFVBQU0sY0FBYyxhQUFhLFdBQVcsS0FBSyxpQkFBaUIsS0FBSztBQUN2RSxVQUFNLGNBQWMsS0FBSyxJQUFJLElBQUk7QUFFakMsZUFBVyxPQUFPLE1BQU07QUFDcEIsWUFBTSxRQUFRLFlBQVksSUFBSSxHQUFHO0FBQ2pDLFVBQUksU0FBUyxlQUFlLE1BQU0sZ0JBQWdCO0FBQzlDLGVBQU87QUFBQSxNQUNYO0FBQUEsSUFDSjtBQUNBLFdBQU87QUFBQSxFQUNYO0FBQUEsRUFFQSxNQUFjLG1CQUFtQixLQUFhLFFBQWdCLFdBQW9DO0FBQzlGLFVBQU0sV0FBVyxVQUFNLDZCQUFXO0FBQUEsTUFDOUIsS0FBSyxHQUFHLEtBQUssU0FBUztBQUFBLE1BQ3RCLFFBQVE7QUFBQSxNQUNSLFNBQVM7QUFBQSxRQUNMLGdCQUFnQjtBQUFBLFFBQ2hCLGlCQUFpQixVQUFVO0FBQUEsTUFDL0I7QUFBQSxNQUNBLE1BQU0sS0FBSyxVQUFVO0FBQUEsUUFDakIsT0FBTztBQUFBLFFBQ1AsVUFBVSxDQUFDLEVBQUUsTUFBTSxRQUFRLFNBQVMsT0FBTyxDQUFDO0FBQUEsUUFDNUMsYUFBYSxLQUFLLFNBQVM7QUFBQSxRQUMzQixZQUFZLEtBQUssU0FBUztBQUFBLE1BQzlCLENBQUM7QUFBQSxJQUNMLENBQUM7QUFDRCxXQUFPLFNBQVMsS0FBSyxRQUFRLENBQUMsRUFBRSxRQUFRLFFBQVEsS0FBSztBQUFBLEVBQ3pEO0FBQUEsRUFFQSxNQUFjLHNCQUFzQixLQUFhLFFBQWdCLFdBQW9DO0FBQ2pHLFVBQU0sTUFBTSwyREFBMkQsaUNBQWlDO0FBQ3hHLFVBQU0sV0FBVyxVQUFNLDZCQUFXO0FBQUEsTUFDOUI7QUFBQSxNQUNBLFFBQVE7QUFBQSxNQUNSLFNBQVMsRUFBRSxnQkFBZ0IsbUJBQW1CO0FBQUEsTUFDOUMsTUFBTSxLQUFLLFVBQVU7QUFBQSxRQUNqQixVQUFVLENBQUMsRUFBRSxPQUFPLENBQUMsRUFBRSxNQUFNLE9BQU8sQ0FBQyxFQUFFLENBQUM7QUFBQSxRQUN4QyxrQkFBa0I7QUFBQSxVQUNkLGFBQWEsS0FBSyxTQUFTO0FBQUEsVUFDM0IsaUJBQWlCLEtBQUssU0FBUztBQUFBLFFBQ25DO0FBQUEsTUFDSixDQUFDO0FBQUEsSUFDTCxDQUFDO0FBRUQsVUFBTSxPQUFPLFNBQVM7QUFDdEIsUUFBSSxDQUFDLEtBQUssY0FBYyxLQUFLLFdBQVcsV0FBVyxHQUFHO0FBQ2xELFlBQU0sSUFBSSxNQUFNLHdEQUF3RCxLQUFLLFVBQVUsSUFBSSxDQUFDO0FBQUEsSUFDaEc7QUFDQSxXQUFPLEtBQUssV0FBVyxDQUFDLEVBQUUsUUFBUSxNQUFNLENBQUMsRUFBRSxLQUFLLEtBQUs7QUFBQSxFQUN6RDtBQUFBO0FBQUEsRUFHUSxjQUFjLE9BQXlCO0FBNUduRDtBQTZHUSxVQUFNLE1BQU07QUFDWixVQUFNLGFBQWEsSUFBSTtBQUN2QixVQUFNLGlCQUFlLFNBQUksWUFBSixtQkFBYSxrQkFBaUI7QUFFbkQsUUFBSSxlQUFlLE9BQU8sZUFBZSxPQUFPLGVBQWUsS0FBSztBQUNoRSxhQUFPO0FBQUEsSUFDWDtBQUVBLFFBQUksYUFBYSxTQUFTLG9CQUFvQixLQUFLLGFBQWEsU0FBUyxZQUFZLEtBQUssYUFBYSxTQUFTLE9BQU8sS0FBSyxhQUFhLFNBQVMsWUFBWSxLQUFLLGFBQWEsU0FBUyxLQUFLLEdBQUc7QUFDN0wsYUFBTztBQUFBLElBQ1g7QUFFQSxXQUFPO0FBQUEsRUFDWDtBQUFBLEVBRVEsYUFBYSxLQUFhLFVBQXFDO0FBQ25FLFVBQU0sY0FBYyxhQUFhLFdBQVcsS0FBSyxpQkFBaUIsS0FBSztBQUN2RSxVQUFNLFdBQVcsWUFBWSxJQUFJLEdBQUc7QUFDcEMsUUFBSSxVQUFVO0FBQ1YsY0FBUSxLQUFLLFVBQVUsSUFBSSxNQUFNLEVBQUUsTUFBTSw4REFBOEQ7QUFDdkcsZUFBUyxpQkFBa0IsS0FBSyxJQUFJLElBQUksTUFBUSxLQUFLLFNBQVM7QUFBQSxJQUNsRTtBQUFBLEVBQ0o7QUFBQSxFQUVRLGVBQWUsS0FBYSxVQUFxQztBQUNyRSxVQUFNLGNBQWMsYUFBYSxXQUFXLEtBQUssaUJBQWlCLEtBQUs7QUFDdkUsVUFBTSxXQUFXLFlBQVksSUFBSSxHQUFHO0FBQ3BDLFFBQUksVUFBVTtBQUNWLGVBQVMsaUJBQWlCO0FBQUEsSUFDOUI7QUFDQSxTQUFLLHNCQUFzQjtBQUFBLEVBQy9CO0FBQUEsRUFFQSxNQUFjLFlBQVksS0FBYSxRQUFpQztBQUNwRSxVQUFNLGVBQWUsS0FBSyxTQUFTO0FBQ25DLFVBQU0sY0FBYyxLQUFLLFNBQVM7QUFFbEMsUUFBSTtBQUNBLFlBQU0sU0FBUyxNQUFNLEtBQUssbUJBQW1CLEtBQUssUUFBUSxZQUFZO0FBQ3RFLFdBQUssZUFBZSxLQUFLLFFBQVE7QUFDakMsYUFBTztBQUFBLElBQ1gsU0FBUyxHQUFQO0FBQ0UsWUFBTSxlQUFlO0FBRXJCLFlBQU0sYUFBYyxhQUFhLFFBQVMsRUFBRSxVQUFVLE9BQU8sQ0FBQztBQUU5RCxjQUFRLEtBQUsseUJBQXlCLG1DQUFtQyxJQUFJLE1BQU0sRUFBRSxNQUFNLFVBQVU7QUFFckcsVUFBSSxhQUFhO0FBQ2IsWUFBSTtBQUNBLGdCQUFNLGVBQWUsTUFBTSxLQUFLLG1CQUFtQixLQUFLLFFBQVEsV0FBVztBQUMzRSxlQUFLLGVBQWUsS0FBSyxRQUFRO0FBQ2pDLGlCQUFPO0FBQUEsUUFDWCxTQUFTLElBQVA7QUFDRSxnQkFBTSxZQUFhLGNBQWMsUUFBUyxHQUFHLFVBQVUsT0FBTyxFQUFFO0FBQ2hFLGtCQUFRLE1BQU0sd0JBQXdCLHVDQUF1QyxJQUFJLE1BQU0sRUFBRSxNQUFNLFNBQVM7QUFFeEcsY0FBSSxLQUFLLGNBQWMsWUFBWSxLQUFLLEtBQUssY0FBYyxFQUFFLEdBQUc7QUFDNUQsaUJBQUssYUFBYSxLQUFLLFFBQVE7QUFBQSxVQUNuQztBQUNBLGdCQUFNLElBQUkscUJBQXFCLHFEQUFxRDtBQUFBLFFBQ3hGO0FBQUEsTUFDSjtBQUVBLFVBQUksS0FBSyxjQUFjLFlBQVksR0FBRztBQUNsQyxhQUFLLGFBQWEsS0FBSyxRQUFRO0FBQUEsTUFDbkM7QUFDQSxZQUFNLElBQUkscUJBQXFCLHdEQUF3RCxZQUFZO0FBQUEsSUFDdkc7QUFBQSxFQUNKO0FBQUEsRUFFQSxNQUFjLGVBQWUsS0FBYSxRQUFpQztBQUN2RSxVQUFNLGVBQWUsS0FBSyxTQUFTO0FBQ25DLFVBQU0sY0FBYyxLQUFLLFNBQVM7QUFFbEMsUUFBSTtBQUNBLFlBQU0sU0FBUyxNQUFNLEtBQUssc0JBQXNCLEtBQUssUUFBUSxZQUFZO0FBQ3pFLFdBQUssZUFBZSxLQUFLLFFBQVE7QUFDakMsYUFBTztBQUFBLElBQ1gsU0FBUyxHQUFQO0FBQ0UsWUFBTSxlQUFlO0FBQ3JCLFlBQU0sYUFBYyxhQUFhLFFBQVMsRUFBRSxVQUFVLE9BQU8sQ0FBQztBQUM5RCxjQUFRLEtBQUsseUJBQXlCLG1DQUFtQyxJQUFJLE1BQU0sRUFBRSxNQUFNLFVBQVU7QUFFckcsVUFBSSxhQUFhO0FBQ2IsWUFBSTtBQUNBLGdCQUFNLGVBQWUsTUFBTSxLQUFLLHNCQUFzQixLQUFLLFFBQVEsV0FBVztBQUM5RSxlQUFLLGVBQWUsS0FBSyxRQUFRO0FBQ2pDLGlCQUFPO0FBQUEsUUFDWCxTQUFTLElBQVA7QUFDRSxnQkFBTSxZQUFhLGNBQWMsUUFBUyxHQUFHLFVBQVUsT0FBTyxFQUFFO0FBQ2hFLGtCQUFRLE1BQU0sd0JBQXdCLHVDQUF1QyxJQUFJLE1BQU0sRUFBRSxNQUFNLFNBQVM7QUFFeEcsY0FBSSxLQUFLLGNBQWMsWUFBWSxLQUFLLEtBQUssY0FBYyxFQUFFLEdBQUc7QUFDNUQsaUJBQUssYUFBYSxLQUFLLFFBQVE7QUFBQSxVQUNuQztBQUNBLGdCQUFNLElBQUkscUJBQXFCLHFEQUFxRDtBQUFBLFFBQ3hGO0FBQUEsTUFDSjtBQUVBLFVBQUksS0FBSyxjQUFjLFlBQVksR0FBRztBQUNsQyxhQUFLLGFBQWEsS0FBSyxRQUFRO0FBQUEsTUFDbkM7QUFDQSxZQUFNLElBQUkscUJBQXFCLHdEQUF3RCxZQUFZO0FBQUEsSUFDdkc7QUFBQSxFQUNKO0FBQUEsRUFFQSxNQUFhLEtBQUssUUFBaUM7QUFDL0MsU0FBSyxXQUFXO0FBQ2hCLFFBQUksWUFBMEI7QUFDOUIsUUFBSSxzQkFBc0I7QUFFMUIsVUFBTSxnQkFBZ0IsS0FBSyxZQUFZLFNBQVMsS0FBSyxDQUFDLEVBQUUsS0FBSyxTQUFTLGdCQUFnQixLQUFLLFNBQVM7QUFDcEcsVUFBTSxnQkFBZ0IsS0FBSyxZQUFZLFNBQVMsS0FBSyxDQUFDLEVBQUUsS0FBSyxTQUFTLGdCQUFnQixLQUFLLFNBQVM7QUFFcEcsUUFBSSxlQUFlO0FBQ2YsNEJBQXNCO0FBQ3RCLGVBQVMsSUFBSSxHQUFHLElBQUksS0FBSyxZQUFZLFFBQVEsS0FBSztBQUM5QyxjQUFNLE1BQU0sS0FBSyxXQUFXLEtBQUssYUFBYSxRQUFRO0FBQ3RELFlBQUksS0FBSztBQUNMLGNBQUk7QUFDQSxvQkFBUSxNQUFNLHdCQUF3QixJQUFJLE1BQU0sRUFBRSxHQUFHO0FBQ3JELG1CQUFPLE1BQU0sS0FBSyxZQUFZLEtBQUssTUFBTTtBQUFBLFVBQzdDLFNBQVMsR0FBUDtBQUNFLGtCQUFNLE1BQU07QUFDWix3QkFBWTtBQUNaLGdCQUFJLHdCQUFPLGlCQUFpQixJQUFJLE1BQU0sRUFBRSx3QkFBd0I7QUFBQSxVQUNwRTtBQUFBLFFBQ0o7QUFBQSxNQUNKO0FBQUEsSUFDSixXQUFXLEtBQUssWUFBWSxTQUFTLEdBQUc7QUFDcEMsNEJBQXNCO0FBQ3RCLGtCQUFZLElBQUksTUFBTSw4Q0FBOEM7QUFDcEUsY0FBUSxLQUFLLFVBQVUsT0FBTztBQUFBLElBQ2xDO0FBRUEsUUFBSSxlQUFlO0FBQ2YsVUFBSSx1QkFBdUIsQ0FBQyxLQUFLLHFCQUFxQjtBQUNsRCxZQUFJLHdCQUFPLHNFQUFzRTtBQUNqRixhQUFLLHNCQUFzQjtBQUFBLE1BQy9CO0FBQ0EsZUFBUyxJQUFJLEdBQUcsSUFBSSxLQUFLLFlBQVksUUFBUSxLQUFLO0FBQzlDLGNBQU0sTUFBTSxLQUFLLFdBQVcsS0FBSyxhQUFhLFFBQVE7QUFDdEQsWUFBSSxLQUFLO0FBQ0wsY0FBSTtBQUNBLG9CQUFRLE1BQU0sK0JBQStCLElBQUksTUFBTSxFQUFFLEdBQUc7QUFDNUQsbUJBQU8sTUFBTSxLQUFLLGVBQWUsS0FBSyxNQUFNO0FBQUEsVUFDaEQsU0FBUyxHQUFQO0FBQ0Usa0JBQU0sTUFBTTtBQUNaLHdCQUFZO0FBQ1osZ0JBQUksd0JBQU8sd0JBQXdCLElBQUksTUFBTSxFQUFFLHdCQUF3QjtBQUFBLFVBQzNFO0FBQUEsUUFDSjtBQUFBLE1BQ0o7QUFBQSxJQUNKLFdBQVcsS0FBSyxZQUFZLFNBQVMsR0FBRztBQUNwQyxrQkFBWSxhQUFhLElBQUksTUFBTSw4Q0FBOEM7QUFDakYsY0FBUSxLQUFLLFVBQVUsT0FBTztBQUFBLElBQ2xDO0FBRUEsUUFBSSxDQUFDLGlCQUFpQixDQUFDLGtCQUFrQixLQUFLLFlBQVksU0FBUyxLQUFLLEtBQUssWUFBWSxTQUFTLElBQUk7QUFDbEcsVUFBSSx3QkFBTyxrRUFBa0U7QUFDN0UsWUFBTSxJQUFJLHFCQUFxQixzQ0FBc0M7QUFBQSxJQUN6RTtBQUVBLFVBQU0sSUFBSSxxQkFBcUIseUNBQXlDLHVDQUFXLFNBQVM7QUFBQSxFQUNoRztBQUNKOzs7QUM5UU8sSUFBTSxTQUFOLE1BQWE7QUFBQSxFQUloQixZQUFZLFFBQThCO0FBQ3RDLFNBQUssU0FBUztBQUNkLFNBQUssYUFBYSxJQUFJLFdBQVcsTUFBTTtBQUFBLEVBQzNDO0FBQUEsRUFFQSxNQUFhLE1BQU0sU0FBbUU7QUFDbEYsUUFBSSxLQUFLLE9BQU8sU0FBUyxnQkFBZ0IsTUFBTTtBQUMzQyxhQUFPLEtBQUssV0FBVyxPQUFPO0FBQUEsSUFDbEM7QUFDQSxXQUFPLEtBQUssa0JBQWtCLE9BQU87QUFBQSxFQUN6QztBQUFBLEVBRVEsa0JBQWtCLFNBQTBEO0FBQ2hGLFVBQU0sVUFBb0IsQ0FBQztBQUMzQixVQUFNLGVBQWUsUUFBUSxZQUFZO0FBR3pDLFVBQU0sa0JBQWtCLEtBQUssT0FBTyxTQUFTLHdCQUN4QyxNQUFNLElBQUksRUFBRSxJQUFJLE9BQUssRUFBRSxLQUFLLEVBQUUsWUFBWSxDQUFDLEVBQUUsT0FBTyxPQUFPO0FBQ2hFLFVBQU0saUJBQWlCLGdCQUFnQixPQUFPLE9BQUssQ0FBQyxhQUFhLFNBQVMsQ0FBQyxDQUFDO0FBQzVFLFFBQUksZUFBZSxTQUFTLEdBQUc7QUFDM0IsY0FBUSxLQUFLLCtDQUFZLGVBQWUsS0FBSyxJQUFJLEdBQUc7QUFBQSxJQUN4RDtBQUdBLFFBQUksUUFBUSxTQUFTLEtBQUssT0FBTyxTQUFTLDJCQUEyQjtBQUNqRSxjQUFRLEtBQUssMkNBQWEsUUFBUSx5QkFBZSxLQUFLLE9BQU8sU0FBUyw0QkFBNEI7QUFBQSxJQUN0RztBQUdBLFVBQU0sa0JBQWtCLENBQUMsK0JBQVcsd0NBQVUsc0JBQU8sc0JBQU8sb0JBQUs7QUFDakUsZUFBVyxXQUFXLGlCQUFpQjtBQUNuQyxVQUFJLElBQUksT0FBTyxTQUFTLEdBQUcsRUFBRSxLQUFLLE9BQU8sR0FBRztBQUN4QyxnQkFBUSxLQUFLLG9EQUFpQixXQUFXO0FBQ3pDO0FBQUEsTUFDSjtBQUFBLElBQ0o7QUFFQSxXQUFPO0FBQUEsTUFDSCxZQUFZLFFBQVEsV0FBVztBQUFBLE1BQy9CLFFBQVEsUUFBUSxTQUFTLElBQUksUUFBUSxLQUFLLElBQUksSUFBSTtBQUFBLElBQ3REO0FBQUEsRUFDSjtBQUFBLEVBRUEsTUFBYyxXQUFXLFNBQW1FO0FBQ3hGLFVBQU0sU0FBUyxLQUFLLE9BQU8sU0FBUyxjQUFjLFFBQVEsYUFBYSxPQUFPO0FBQzlFLFFBQUk7QUFDQSxZQUFNLFdBQVcsTUFBTSxLQUFLLFdBQVcsS0FBSyxNQUFNO0FBQ2xELFlBQU0sZ0JBQWdCLFNBQVMsTUFBTSw2QkFBNkI7QUFHbEUsWUFBTSxjQUFjLFNBQVMsTUFBTSx5QkFBeUI7QUFFNUQsWUFBTSxhQUFhLGdCQUFnQixjQUFjLENBQUMsRUFBRSxZQUFZLE1BQU0sU0FBUztBQUMvRSxZQUFNLFNBQVMsY0FBYyxZQUFZLENBQUMsRUFBRSxLQUFLLElBQUssYUFBYSxvQkFBVTtBQUU3RSxhQUFPLEVBQUUsWUFBWSxPQUFPO0FBQUEsSUFDaEMsU0FBUyxPQUFQO0FBQ0UsY0FBUSxNQUFNLDBCQUEwQixLQUFLO0FBQzdDLGFBQU8sRUFBRSxZQUFZLE9BQU8sUUFBUSxrREFBZSxNQUFNLFVBQVU7QUFBQSxJQUN2RTtBQUFBLEVBQ0o7QUFDSjs7O0FDbkVPLElBQU0sVUFBTixNQUFjO0FBQUEsRUFHakIsWUFBWSxRQUE4QjtBQUN0QyxTQUFLLFNBQVM7QUFBQSxFQUNsQjtBQUFBLEVBRU8scUJBQXFCLE1BQWMsaUJBQXlCLGlCQUFpQztBQUNoRyxRQUFJLFNBQVMsS0FBSyxPQUFPLFNBQVM7QUFDbEMsYUFBUyxPQUFPLFFBQVEsYUFBYSxJQUFJO0FBQ3pDLGFBQVMsT0FBTyxRQUFRLHNCQUFzQixlQUFlO0FBQzdELGFBQVMsT0FBTyxRQUFRLHNCQUFzQixlQUFlO0FBQzdELFdBQU87QUFBQSxFQUNYO0FBQ0o7OztBQ2hCTyxTQUFTLGlCQUFpQixNQUFzQjtBQUVuRCxNQUFJLFlBQVksS0FBSyxRQUFRLGNBQWMsRUFBRSxFQUFFLEtBQUs7QUFFcEQsY0FBWSxVQUFVLFFBQVEsaUJBQWlCLEVBQUU7QUFFakQsU0FBTyxVQUFVLE1BQU0sR0FBRyxHQUFHO0FBQ2pDO0FBRU8sU0FBUyxnQkFBZ0IsU0FBMkI7QUFDdkQsUUFBTSxVQUFVLFFBQVEsTUFBTSxtQkFBbUI7QUFDakQsTUFBSSxDQUFDLFNBQVM7QUFDVixXQUFPLENBQUM7QUFBQSxFQUNaO0FBRUEsUUFBTSxRQUFRLFFBQVEsSUFBSSxXQUFTO0FBQy9CLFdBQU8sTUFBTSxNQUFNLEdBQUcsRUFBRSxFQUFFLE1BQU0sR0FBRyxFQUFFLENBQUMsRUFBRSxLQUFLO0FBQUEsRUFDakQsQ0FBQztBQUNELFNBQU8sQ0FBQyxHQUFHLElBQUksSUFBSSxLQUFLLENBQUM7QUFDN0I7QUFFTyxTQUFTLG9CQUFvQixTQUF5QjtBQUN6RCxRQUFNLFVBQVUsUUFBUSxLQUFLO0FBQzdCLE1BQUksUUFBUSxXQUFXLGFBQWEsS0FBSyxRQUFRLFNBQVMsS0FBSyxHQUFHO0FBQzlELFFBQUksVUFBVSxRQUFRLFVBQVUsY0FBYyxRQUFRLFFBQVEsU0FBUyxNQUFNLE1BQU07QUFDbkYsV0FBTyxRQUFRLEtBQUs7QUFBQSxFQUN4QjtBQUNBLFNBQU87QUFDWDs7O0FKcEJPLElBQU0sU0FBTixNQUFhO0FBQUEsRUFTaEIsWUFBWSxRQUE4QjtBQUgxQyxTQUFRLFlBQXFCO0FBQzdCLFNBQVEsVUFBaUM7QUFHckMsU0FBSyxTQUFTO0FBQ2QsU0FBSyxNQUFNLE9BQU87QUFDbEIsU0FBSyxhQUFhLElBQUksV0FBVyxNQUFNO0FBQ3ZDLFNBQUssU0FBUyxJQUFJLE9BQU8sTUFBTTtBQUMvQixTQUFLLFVBQVUsSUFBSSxRQUFRLE1BQU07QUFBQSxFQUNyQztBQUFBO0FBQUEsRUFHTyxvQkFBMEI7QUFDN0IsUUFBSSxLQUFLLFdBQVc7QUFDaEIsV0FBSyxLQUFLO0FBQUEsSUFDZCxPQUFPO0FBQ0gsV0FBSyxNQUFNO0FBQUEsSUFDZjtBQUFBLEVBQ0o7QUFBQSxFQUVPLGtCQUFrQixTQUEwQjtBQUMvQyxVQUFNLFFBQVEsS0FBSyxtQkFBbUIsQ0FBQyxPQUFPLENBQUM7QUFDL0MsUUFBSSxRQUFRLEdBQUc7QUFDWCxVQUFJLHdCQUFPLElBQUksMEJBQTBCO0FBQ3pDLFdBQUssZ0JBQWdCO0FBQ3JCLGFBQU87QUFBQSxJQUNYO0FBQ0EsUUFBSSx3QkFBTyxJQUFJLG9DQUFvQztBQUNuRCxXQUFPO0FBQUEsRUFDWDtBQUFBLEVBRU8sbUJBQW1CLFVBQTRCO0FBQ2xELFVBQU0sZUFBZSxJQUFJLElBQUksS0FBSyxPQUFPLEtBQUssZUFBZTtBQUM3RCxVQUFNLGdCQUFnQixJQUFJLElBQUksS0FBSyxJQUFJLE1BQU0saUJBQWlCLEVBQUUsSUFBSSxPQUFLLEVBQUUsUUFBUSxDQUFDO0FBRXBGLFFBQUksYUFBYTtBQUNqQixlQUFXLFdBQVcsVUFBVTtBQUM1QixZQUFNLFlBQVksaUJBQWlCLE9BQU87QUFDMUMsVUFBSSxDQUFDLGFBQWEsSUFBSSxPQUFPLEtBQUssQ0FBQyxjQUFjLElBQUksU0FBUyxHQUFHO0FBQzdELGFBQUssT0FBTyxLQUFLLGdCQUFnQixLQUFLLE9BQU87QUFDN0MscUJBQWEsSUFBSSxPQUFPO0FBQ3hCO0FBQUEsTUFDSjtBQUFBLElBQ0o7QUFFQSxRQUFJLGFBQWEsR0FBRztBQUNoQixXQUFLLE9BQU8sZUFBZTtBQUMzQixXQUFLLGdCQUFnQjtBQUFBLElBQ3pCO0FBQ0EsV0FBTztBQUFBLEVBQ1g7QUFBQTtBQUFBO0FBQUEsRUFLUSxRQUFjO0FBQ2xCLFFBQUksS0FBSztBQUFXO0FBQ3BCLFNBQUssWUFBWTtBQUNqQixTQUFLLE9BQU8sS0FBSyxTQUFTO0FBQzFCLFFBQUksd0JBQU8saUNBQWlDO0FBQzVDLFNBQUssZ0JBQWdCO0FBR3JCLFNBQUssS0FBSyxFQUFFLE1BQU0sV0FBUztBQUN2QixjQUFRLE1BQU0sNEJBQTRCLEtBQUs7QUFDL0MsV0FBSyxLQUFLO0FBQUEsSUFDZCxDQUFDO0FBQUEsRUFDTDtBQUFBLEVBRVEsT0FBYTtBQUNqQixRQUFJLENBQUMsS0FBSztBQUFXO0FBQ3JCLFNBQUssWUFBWTtBQUNqQixTQUFLLE9BQU8sS0FBSyxTQUFTO0FBQzFCLFFBQUksS0FBSyxTQUFTO0FBQ2QsbUJBQWEsS0FBSyxPQUFPO0FBQ3pCLFdBQUssVUFBVTtBQUFBLElBQ25CO0FBQ0EsUUFBSSx3QkFBTyxnQ0FBZ0M7QUFDM0MsU0FBSyxnQkFBZ0I7QUFDckIsU0FBSyxPQUFPLGVBQWU7QUFBQSxFQUMvQjtBQUFBLEVBRVEsbUJBQXlCO0FBQzdCLFFBQUksQ0FBQyxLQUFLO0FBQVc7QUFDckIsVUFBTSxRQUFRLEtBQUssT0FBTyxTQUFTLGdCQUFnQjtBQUNuRCxTQUFLLFVBQVUsV0FBVyxNQUFNO0FBQzVCLFdBQUssS0FBSyxFQUFFLE1BQU0sV0FBUztBQUN2QixnQkFBUSxNQUFNLGVBQWUsS0FBSztBQUFBLE1BRXRDLENBQUM7QUFBQSxJQUNMLEdBQUcsS0FBSztBQUFBLEVBQ1o7QUFBQSxFQUVBLE1BQWMsT0FBc0I7QUFDaEMsUUFBSSxDQUFDLEtBQUs7QUFBVztBQUVyQixRQUFJO0FBQ0EsVUFBSSxnQkFBZ0I7QUFFcEIsVUFBSSxLQUFLLE9BQU8sS0FBSyxjQUFjLFNBQVMsR0FBRztBQUMzQyx3QkFBZ0IsTUFBTSxLQUFLLGlCQUFpQjtBQUFBLE1BQ2hELFdBQ1MsS0FBSyxPQUFPLEtBQUssWUFBWSxTQUFTLEdBQUc7QUFDOUMsd0JBQWdCLE1BQU0sS0FBSyxlQUFlO0FBQUEsTUFDOUMsV0FDUyxLQUFLLE9BQU8sS0FBSyxnQkFBZ0IsU0FBUyxHQUFHO0FBQ2xELHdCQUFnQixNQUFNLEtBQUssbUJBQW1CO0FBQUEsTUFDbEQ7QUFFQSxVQUFJLENBQUMsaUJBQ0QsS0FBSyxPQUFPLEtBQUssZ0JBQWdCLFdBQVcsS0FDNUMsS0FBSyxPQUFPLEtBQUssWUFBWSxXQUFXLEtBQ3hDLEtBQUssT0FBTyxLQUFLLGNBQWMsV0FBVyxHQUFHO0FBRTdDLFlBQUksd0JBQU8sZ0RBQXlDO0FBQ3BELGFBQUssWUFBWTtBQUNqQixhQUFLLE9BQU8sS0FBSyxTQUFTO0FBQzFCLGFBQUssZ0JBQWdCO0FBQ3JCLGNBQU0sS0FBSyxPQUFPLGVBQWU7QUFDakM7QUFBQSxNQUNKO0FBQUEsSUFFSixTQUFTLE9BQVA7QUFDRSxjQUFRLE1BQU0sdUJBQXVCLEtBQUs7QUFDMUMsVUFBSSx3QkFBTyx3REFBd0Q7QUFDbkUsV0FBSyxLQUFLO0FBQ1Y7QUFBQSxJQUNKO0FBRUEsU0FBSyxpQkFBaUI7QUFBQSxFQUMxQjtBQUFBO0FBQUEsRUFHQSxNQUFjLHFCQUF1QztBQUNqRCxVQUFNLFFBQVEsS0FBSyxPQUFPLEtBQUs7QUFDL0IsUUFBSSxNQUFNLFdBQVc7QUFBRyxhQUFPO0FBRS9CLFVBQU0sWUFBWSxLQUFLLE9BQU8sU0FBUztBQUN2QyxVQUFNLFFBQVEsTUFBTSxPQUFPLEdBQUcsS0FBSyxJQUFJLE1BQU0sUUFBUSxTQUFTLENBQUM7QUFFL0QsU0FBSyxnQkFBZ0I7QUFDckIsVUFBTSxLQUFLLE9BQU8sZUFBZTtBQUVqQyxVQUFNLFFBQVEsTUFBTSxJQUFJLFVBQVEsS0FBSyxlQUFlLElBQUksQ0FBQztBQUN6RCxVQUFNLFFBQVEsV0FBVyxLQUFLO0FBRTlCLFVBQU0sS0FBSyxPQUFPLGVBQWU7QUFDakMsV0FBTztBQUFBLEVBQ1g7QUFBQSxFQUVBLE1BQWMsZUFBZSxNQUE2QjtBQUN0RCxVQUFNLFNBQVMsS0FBSyxPQUFPLFNBQVMsaUJBQWlCLFFBQVEsYUFBYSxJQUFJO0FBQzlFLFFBQUk7QUFDQSxZQUFNLFVBQVUsTUFBTSxLQUFLLFdBQVcsS0FBSyxNQUFNO0FBQ2pELFlBQU0saUJBQWlCLG9CQUFvQixPQUFPO0FBQ2xELFdBQUssT0FBTyxLQUFLLFlBQVksS0FBSyxFQUFFLE1BQU0sU0FBUyxlQUFlLENBQUM7QUFFbkUsY0FBUSxNQUFNLGdDQUEyQixNQUFNO0FBQUEsSUFDbkQsU0FBUyxHQUFQO0FBQ0UsVUFBSSxhQUFhLHNCQUFzQjtBQUNuQyxnQkFBUSxNQUFNLCtCQUEwQixVQUFVLEVBQUUsU0FBUztBQUM3RCxhQUFLLE9BQU8sS0FBSyxnQkFBZ0IsUUFBUSxJQUFJO0FBQUEsTUFDakQ7QUFBQSxJQUNKO0FBQUEsRUFDSjtBQUFBLEVBRUEsTUFBYyxpQkFBbUM7QUFDN0MsVUFBTSxRQUFRLEtBQUssT0FBTyxLQUFLO0FBQy9CLFFBQUksTUFBTSxXQUFXO0FBQUcsYUFBTztBQUUvQixVQUFNLFlBQVksS0FBSyxPQUFPLFNBQVM7QUFDdkMsVUFBTSxnQkFBZ0IsTUFBTSxPQUFPLEdBQUcsS0FBSyxJQUFJLE1BQU0sUUFBUSxTQUFTLENBQUM7QUFFdkUsU0FBSyxnQkFBZ0I7QUFDckIsVUFBTSxLQUFLLE9BQU8sZUFBZTtBQUVqQyxRQUFJLGdCQUE2QixvQkFBSSxJQUFJO0FBRXpDLGVBQVcsUUFBUSxlQUFlO0FBQzlCLFlBQU0sRUFBRSxZQUFZLE9BQU8sSUFBSSxNQUFNLEtBQUssT0FBTyxNQUFNLEtBQUssT0FBTztBQUNuRSxVQUFJLFlBQVk7QUFDWixjQUFNLEtBQUssU0FBUyxLQUFLLE1BQU0sS0FBSyxPQUFPO0FBRTNDLFlBQUksS0FBSyxPQUFPLFNBQVMsc0JBQXNCO0FBQzNDLGdCQUFNLFFBQVEsZ0JBQWdCLEtBQUssT0FBTztBQUMxQyxnQkFBTSxRQUFRLFVBQVEsY0FBYyxJQUFJLElBQUksQ0FBQztBQUFBLFFBQ2pEO0FBR0EsZ0JBQVEsTUFBTSx5QkFBa0IsS0FBSyxNQUFNO0FBQUEsTUFDL0MsT0FBTztBQUNILGFBQUssU0FBUztBQUNkLGFBQUssV0FBVyxLQUFLLFdBQVcsS0FBSztBQUNyQyxhQUFLLE9BQU8sS0FBSyxjQUFjLEtBQUssSUFBSTtBQUN4QyxnQkFBUSxLQUFLLHlCQUFrQixLQUFLLFVBQVUsUUFBUTtBQUFBLE1BQzFEO0FBQUEsSUFDSjtBQUVBLFFBQUksY0FBYyxPQUFPLEdBQUc7QUFDeEIsV0FBSyxtQkFBbUIsTUFBTSxLQUFLLGFBQWEsQ0FBQztBQUFBLElBQ3JEO0FBRUEsVUFBTSxLQUFLLE9BQU8sZUFBZTtBQUNqQyxXQUFPO0FBQUEsRUFDWDtBQUFBLEVBRUEsTUFBYyxtQkFBcUM7QUFDL0MsVUFBTSxRQUFRLEtBQUssT0FBTyxLQUFLO0FBQy9CLFFBQUksTUFBTSxXQUFXO0FBQUcsYUFBTztBQUUvQixVQUFNLFlBQVksS0FBSyxPQUFPLFNBQVM7QUFDdkMsVUFBTSxnQkFBZ0IsTUFBTSxPQUFPLEdBQUcsS0FBSyxJQUFJLE1BQU0sUUFBUSxTQUFTLENBQUM7QUFFdkUsU0FBSyxnQkFBZ0I7QUFDckIsVUFBTSxLQUFLLE9BQU8sZUFBZTtBQUVqQyxlQUFXLFFBQVEsZUFBZTtBQUM5QixXQUFLLEtBQUssV0FBVyxNQUFNLEtBQUssT0FBTyxTQUFTLHNCQUFzQjtBQUNsRSxhQUFLLE9BQU8sS0FBSyxjQUFjLEtBQUssSUFBSTtBQUN4QyxnQkFBUSxNQUFNLHdCQUFpQixLQUFLLDJCQUEyQjtBQUMvRDtBQUFBLE1BQ0o7QUFDQSxZQUFNLEtBQUssYUFBYSxJQUFJO0FBQUEsSUFDaEM7QUFFQSxVQUFNLEtBQUssT0FBTyxlQUFlO0FBQ2pDLFdBQU87QUFBQSxFQUNYO0FBQUEsRUFFQSxNQUFjLGFBQWEsTUFBK0I7QUFDdEQsVUFBTSxTQUFTLEtBQUssUUFBUSxxQkFBcUIsS0FBSyxNQUFNLEtBQUssU0FBUyxLQUFLLFVBQVUsU0FBUztBQUNsRyxRQUFJO0FBQ0EsWUFBTSxhQUFhLE1BQU0sS0FBSyxXQUFXLEtBQUssTUFBTTtBQUNwRCxZQUFNLGlCQUFpQixvQkFBb0IsVUFBVTtBQUNyRCxZQUFNLGNBQXdCLEVBQUUsR0FBRyxNQUFNLFNBQVMsZUFBZTtBQUNqRSxXQUFLLE9BQU8sS0FBSyxZQUFZLEtBQUssV0FBVztBQUU3QyxjQUFRLE1BQU0sa0NBQTJCLEtBQUssTUFBTTtBQUFBLElBQ3hELFNBQVMsR0FBUDtBQUVFLFlBQU0sU0FBUyxhQUFhLFFBQVEsRUFBRSxVQUFVLE9BQU8sQ0FBQztBQUV4RCxjQUFRLE1BQU0sNkJBQXdCLEtBQUssVUFBVSxRQUFRO0FBQzdELFdBQUssT0FBTyxLQUFLLGNBQWMsUUFBUSxJQUFJO0FBQUEsSUFDL0M7QUFBQSxFQUNKO0FBQUE7QUFBQSxFQUdBLE1BQWMsU0FBUyxNQUFjLFNBQWdDO0FBQ2pFLFVBQU0sV0FBVyxpQkFBaUIsSUFBSTtBQUN0QyxVQUFNLGFBQWEsS0FBSyxPQUFPLFNBQVM7QUFFeEMsUUFBSSxFQUFFLEtBQUssSUFBSSxNQUFNLHNCQUFzQixVQUFVLGFBQWEsMkJBQVU7QUFDeEUsVUFBSTtBQUNBLGNBQU0sS0FBSyxJQUFJLE1BQU0sYUFBYSxVQUFVO0FBQUEsTUFDaEQsU0FBUyxPQUFQO0FBQ0UsZ0JBQVEsTUFBTSx5QkFBeUIsY0FBYyxLQUFLO0FBQzFELFlBQUksd0JBQU8seUJBQXlCLFlBQVk7QUFDaEQ7QUFBQSxNQUNKO0FBQUEsSUFDSjtBQUVBLFVBQU0sZUFBVyxnQ0FBYyxHQUFHLGNBQWMsYUFBYTtBQUM3RCxVQUFNLE9BQU8sS0FBSyxJQUFJLE1BQU0sc0JBQXNCLFFBQVE7QUFFMUQsUUFBSTtBQUNBLFVBQUksZ0JBQWdCLHdCQUFPO0FBQ3ZCLGNBQU0sS0FBSyxJQUFJLE1BQU0sT0FBTyxNQUFNLE9BQU87QUFDekMsWUFBSSx3QkFBTyxpQkFBaUIsVUFBVTtBQUFBLE1BQzFDLE9BQU87QUFDSCxjQUFNLEtBQUssSUFBSSxNQUFNLE9BQU8sVUFBVSxPQUFPO0FBQzdDLFlBQUksd0JBQU8saUJBQWlCLFVBQVU7QUFBQSxNQUMxQztBQUFBLElBQ0osU0FBUyxPQUFQO0FBQ0UsY0FBUSxNQUFNLHFCQUFxQixZQUFZLEtBQUs7QUFDcEQsVUFBSSx3QkFBTyxxQkFBcUIsVUFBVTtBQUFBLElBQzlDO0FBQUEsRUFDSjtBQUFBLEVBRU8sa0JBQXdCO0FBQzNCLFFBQUksQ0FBQyxLQUFLLE9BQU87QUFBYTtBQUM5QixVQUFNLEVBQUUsaUJBQWlCLGFBQWEsY0FBYyxJQUFJLEtBQUssT0FBTztBQUNwRSxVQUFNLFFBQVEsZ0JBQWdCLFNBQVMsWUFBWSxTQUFTLGNBQWM7QUFFMUUsU0FBSyxPQUFPLFlBQVk7QUFBQSxNQUNwQixPQUFPLEtBQUssT0FBTyxLQUFLLGNBQWMsZ0JBQWdCLGNBQWMsWUFBWSxjQUFjLGNBQWMsa0JBQWtCO0FBQUEsSUFDbEk7QUFFQSxTQUFLLElBQUksVUFBVSxRQUFRLGlCQUFpQjtBQUFBLEVBQ2hEO0FBQ0o7OztBSDNTQSxJQUFNLHNCQUFrQztBQUFBLEVBQ3BDLFFBQVE7QUFBQSxFQUNSLGlCQUFpQixDQUFDO0FBQUEsRUFDbEIsYUFBYSxDQUFDO0FBQUEsRUFDZCxlQUFlLENBQUM7QUFBQSxFQUNoQixlQUFlLENBQUM7QUFDcEI7QUFFQSxJQUFxQix1QkFBckIsY0FBa0Qsd0JBQU87QUFBQSxFQU1yRCxNQUFNLFNBQVM7QUFFWCxVQUFNLEtBQUssYUFBYTtBQUd4QixVQUFNLEtBQUssZUFBZTtBQUUxQixTQUFLLFNBQVMsSUFBSSxPQUFPLElBQUk7QUFFN0IsVUFBTSxlQUFlLEtBQUssY0FBYyxpQkFBaUIsNkJBQTZCLENBQUMsUUFBb0I7QUFDdkcsV0FBSyxPQUFPLGtCQUFrQjtBQUFBLElBQ2xDLENBQUM7QUFDRCxpQkFBYSxTQUFTLHFDQUFxQztBQUUzRCxTQUFLLGNBQWMsS0FBSyxpQkFBaUI7QUFDekMsU0FBSyxPQUFPLGdCQUFnQjtBQUU1QixTQUFLLGNBQWMsSUFBSSxjQUFjLEtBQUssS0FBSyxJQUFJLENBQUM7QUFFcEQsU0FBSyxXQUFXO0FBQUEsTUFDWixJQUFJO0FBQUEsTUFDSixNQUFNO0FBQUEsTUFDTixVQUFVLE1BQU07QUFDWixhQUFLLE9BQU8sa0JBQWtCO0FBQUEsTUFDbEM7QUFBQSxJQUNKLENBQUM7QUFFRCxTQUFLLFdBQVc7QUFBQSxNQUNaLElBQUk7QUFBQSxNQUNKLE1BQU07QUFBQSxNQUNOLGVBQWUsQ0FBQyxhQUFzQjtBQUNsQyxjQUFNLE9BQU8sS0FBSyxJQUFJLFVBQVUsY0FBYztBQUM5QyxZQUFJLE1BQU07QUFDTixjQUFJLENBQUMsVUFBVTtBQUNYLGlCQUFLLE9BQU8sa0JBQWtCLEtBQUssUUFBUTtBQUFBLFVBQy9DO0FBQ0EsaUJBQU87QUFBQSxRQUNYO0FBQ0EsZUFBTztBQUFBLE1BQ1g7QUFBQSxJQUNKLENBQUM7QUFHRCxZQUFRLE1BQU0sZ0NBQWdDO0FBQUEsRUFDbEQ7QUFBQSxFQUVBLFdBQVc7QUFDUCxZQUFRLE1BQU0sa0NBQWtDO0FBQUEsRUFDcEQ7QUFBQSxFQUVBLE1BQU0sZUFBZTtBQUVqQixVQUFNLGlCQUFpQixrQkFBa0I7QUFDekMsVUFBTSxZQUFZLE1BQU0sS0FBSyxTQUFTO0FBQ3RDLFVBQU0sZ0JBQWdCLGFBQWEsQ0FBQztBQUVwQyxTQUFLLFdBQVcsT0FBTyxPQUFPLENBQUMsR0FBRyxrQkFBa0IsZ0JBQWdCLGFBQWE7QUFBQSxFQUNyRjtBQUFBLEVBRUEsTUFBTSxlQUFlO0FBQ2pCLFVBQU0sYUFBYSxFQUFFLEdBQUcsS0FBSyxVQUFVLGFBQWEsS0FBSyxLQUFLO0FBQzlELFVBQU0sS0FBSyxTQUFTLFVBQVU7QUFBQSxFQUNsQztBQUFBLEVBRUEsTUFBTSxpQkFBaUI7QUFDbkIsVUFBTSxZQUFZLE1BQU0sS0FBSyxTQUFTO0FBQ3RDLFVBQU0sY0FBYSx1Q0FBVyxnQkFBZSxDQUFDO0FBRTlDLFNBQUssT0FBTyxPQUFPLE9BQU8sQ0FBQyxHQUFHLHFCQUFxQixVQUFVO0FBQUEsRUFDakU7QUFBQSxFQUVBLE1BQU0saUJBQWlCO0FBQ25CLFVBQU0sS0FBSyxhQUFhO0FBQUEsRUFDNUI7QUFDSjsiLAogICJuYW1lcyI6IFsiaW1wb3J0X29ic2lkaWFuIiwgImltcG9ydF9vYnNpZGlhbiIsICJpbXBvcnRfb2JzaWRpYW4iLCAiaW1wb3J0X29ic2lkaWFuIl0KfQo=
