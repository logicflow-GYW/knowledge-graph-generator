# 提示词工程指南 (Prompt Engineering Guide)

> “Knowledge Graph Generator 不仅仅是一个工具，它是一个可编程的知识工厂。通过自定义提示词，您可以定义这个工厂的生产流水线。”

本指南旨在帮助高级用户理解本插件的核心工作流，并设计出属于自己的、风格独特的知识生成系统。

---

## 核心架构：三权分立

本插件采用独特的“三阶段”自动化工作流。要设计一套成功的提示词，您必须理解这三个 AI 角色之间的**协作协议**。

| 角色 | 内部代号 | 职责 | 关键能力 |
| :--- | :--- | :--- | :--- |
| **生成者** | `Generator` | **作家**：负责从零开始创作内容。 | 天马行空，但需遵守结构要求。 |
| **审核者** | `Critic` | **质检员**：负责检查内容是否达标。 | 铁面无私，只做判断，不做修改。 |
| **修正者** | `Reviser` | **编辑**：负责根据质检报告修改内容。 | 精准手术，解决特定问题。 |

### ⚠️ 黄金定律 (The Golden Rule)

**“您要求‘生成者’写什么结构，就必须要求‘审核者’检查什么结构。”**

这是最容易犯错的地方。如果您修改了生成提示词，要求输出“### 核心隐喻”，但在审核提示词中却让 AI 检查“### 核心比喻”，那么所有笔记都将无法通过审核，系统会陷入无限循环的修正重试中。

---

## 提示词设计详解

在 Obsidian 的插件设置页面，您可以完全自定义这三个角色的提示词（Prompt）。系统使用特定的占位符（变量）来在这三个角色间传递信息。

### 1. 生成提示词 (Generator Prompt)
* **作用**：定义笔记的风格、深度和结构。
* **可用变量**：
    * `{concept}`：当前需要生成的概念名称（例如：“第一性原理”）。
* **设计技巧**：
    * **强制结构化**：最好的方式是提供一个**“优秀范例”**，并要求 AI 严格模仿其结构（如特定的 Markdown 标题层级）。
    * **要求链接**：明确要求 AI 在文中引出其他概念时使用 `[[双向链接]]` 格式，这是图谱自动扩展的基础。

### 2. 审核提示词 (Critic Prompt)
* **作用**：决定一篇笔记是“保留 (KEEP)”还是“丢弃 (DISCARD)”。
* **启用条件**：仅当设置中的“审核模式”选为 **"人工智能 (AI)"** 时生效。
* **可用变量**：
    * `{content}`：生成者刚刚写好的完整笔记内容。
* **输出协议（至关重要）**：
    审核者的输出必须能被插件识别。它必须包含以下两个关键词之一：
    * `DECISION: KEEP` （通过）
    * `DECISION: DISCARD` （拒绝）
    同时，强烈建议在拒绝时提供明确理由，包裹在 `[REASON: ...]` 中，以便传给修正者。

### 3. 修正提示词 (Reviser Prompt)
* **作用**：当审核不通过时，给予第二次机会进行补救。
* **可用变量**：
    * `{concept}`：概念名称。
    * `{original_content}`：那篇被拒绝的原始笔记草稿。
    * `{rejection_reason}`：审核者给出的具体拒绝理由（即上面的 `[REASON: ...]` 内容）。
* **设计技巧**：
    * **角色设定**：告诉它“你是一个资深编辑，你的任务不是重写，而是修正”。
    * **利用理由**：明确要求它“根据 `{rejection_reason}` 进行针对性修改”。如果审核员说“缺少案例”，它就应该补上案例。

---

## 调试指南：如果系统卡住了

如果您自定义提示词后，发现任务总是卡在“待修正 (Revision)”队列，或者最终都进了“已丢弃 (Discarded)”堆，请按以下步骤自检：

1.  **检查“黄金定律”**：审核者要求的标题，生成者真的写对了吗？（哪怕差一个字都不行，AI 有时很死板）。
2.  **检查审核者输出**：在开发者控制台（Ctrl+Shift+I）中查看日志。审核者是否正确输出了 `DECISION: KEEP/DISCARD`？如果没有，插件可能无法判断其意图。
3.  **检查修正者能力**：修正者是否收到了清晰的 `{rejection_reason}`？如果审核者只是笼统地说“质量不行”，修正者可能不知道如何下手改进。

---

> **致高级玩家**：
> 欢迎探索不同的“知识风格”。您可以设计一套“苏格拉底式”的提示词，让生成者不断提问；也可以设计一套“费曼学习法”提示词，让它用最直白的语言解释深奥概念。
>
> 可能性是无限的。
