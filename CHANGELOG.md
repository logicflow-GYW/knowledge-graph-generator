# 更新日志 (Changelog)

所有本插件的重要变更都将记录在此。

---

## [1.6.0] - 2025-11-08

### ✨ 新功能 (Features)

* **API 备用模型支持 (Backup Models):**
    * 现在可以在设置中为 OpenAI 和 Google Gemini 分别指定一个“备用模型”。
    * 当主模型（例如 `gpt-4-turbo`）因为额度耗尽或速率限制而失败时，插件会**自动尝试使用您设置的备用模型**（例如 `gpt-3.5-turbo`）来完成该任务，然后再对该 API 密钥进行冷却或切换。这极大地增强了插件长时间自动运行的稳定性。
* **新概念自动提取 (知识循环):**
    * 在“引擎设置”中新增了“自动提取新概念”开关（默认关闭）。
    * 开启后，当一篇笔记被“审核”阶段批准时，插件会自动解析该笔记内容中的所有 `[[Wikilinks]]`。
    * 这些被提取的链接（如果尚不存在）将被作为新概念，自动添加回“待生成队列”，从而实现知识图谱的自我循环与扩展。

### 🚀 优化 (Improvements)

* **API 错误处理重构:**
    * 对内部 API 处理器 (API Handler) 进行了重构，将 API 请求、额度/权限错误检查 (isQuotaError) 和密钥冷却 (Cooldown) 逻辑拆分到更清晰的辅助函数中，以更稳定地支持新的“备用模型”故障切换功能。

---

## [1.5.4] - 2025-11-08

### ✨ 新功能 (Features)

* **自动提取新概念：** 在设置中新增了“自动提取新概念”的开关（默认关闭）。
* **功能说明：** 开启后，插件将在笔记通过“审核 (Critic)” 阶段时，自动解析笔记内容中的 `[[Wikilinks]]`，并将这些链接作为新概念添加到“待生成队列”中，实现了知识图谱的自动“播种”和扩展。

---

## [1.5.3] - 2025-11-08

### 🚀 优化 (Improvements)

* **API 故障切换通知：** 当所有 OpenAI Key 均失败时，插件现在将弹出一个**明确的通知**（例如“正在切换到 Google Gemini...”），而不是静默切换。此通知只会显示一次，以避免重复打扰。
* **队列仪表盘优化：** “队列管理仪表盘”现在打开时默认将所有队列（待生成、待审核等）**全部折叠**，使界面更加干净整洁，尤其便于管理大量任务。
* **设置描述更新：** 在设置面板中为“最大并发数”添加了注释，明确告知用户 V2.2 引擎暂不支持并发设置，避免用户困惑。

### 🐞 修复 (Fixed)

* **数据稳定性重构：** 彻底重构了数据保存逻辑。现在，插件的配置 (`settings`) 和运行时的队列数据 (`data`) 将作为一个单独的对象被**原子性地保存**。这极大地提高了数据一致性，能有效防止在插件或 Obsidian 意外退出时导致的数据损坏或丢失问题。

---

## [1.5.2] - 2025-11-08

### 🚀 优化 (Improvements)

* **队列仪表盘优化：** “队列管理仪表盘”现在打开时默认将所有队列（待生成、待审核等）折叠，使界面更加干净整洁。
* **API 故障切换：** 优化了 API 故障切换通知逻辑。现在只有在**首次**从一个 API供应商 (如 OpenAI) 切换到另一个 (如 Gemini) 时才会弹出通知，避免了在 API 密钥轮换时造成重复打扰。

### 🐞 修复 (Fixed)

* 提升了插件运行的整体健壮性
  
---

## [1.5.1] - 2025-11-08

### 🚀 优化 (Improvements)

* **队列仪表盘优化：** “队列管理仪表盘”现在打开时默认将所有队列（待生成、待审核等）折叠，使界面更加干净整洁。
* **API 故障切换：** 优化了 API 故障切换通知逻辑。现在只有在**首次**从一个 API供应商 (如 OpenAI) 切换到另一个 (如 Gemini) 时才会弹出通知，避免了在 API 密钥轮换时造成重复打扰。

### 🐞 修复 (Fixed)

* 提升了插件运行的整体健壮性。
